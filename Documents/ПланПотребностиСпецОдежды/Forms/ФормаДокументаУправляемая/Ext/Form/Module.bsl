
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Ключ.Пустая() Тогда
		ЗаполнениеДокументов.ЗаполнитьШапкуДокумента(Объект, ОбщегоНазначенияБКВызовСервераПовтИсп.ПолучитьВалютуРегламентированногоУчета());
		РаботаСДиалогами.УстановитьЗаголовокФормыДокумента("", Объект.Ссылка, ЭтаФорма);
		Объект.Дата = ТекущаяДата();
	КонецЕсли;	
		
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьИзДругогоУчастка(Команда)
	
	Если Объект.Список.Количество() > 0 Тогда
		
		ФмВыб = ПолучитьФорму("Документ.ПланПотребностиСпецОдежды.Форма.ВыборПодразделенияИДолжности");
		ФмВыб.Должность = ДолжностьДругогоУчастка;
		ФмВыб.Подразделение = ПодразделениеДругогоУчастка;
		Рез = ФмВыб.ОткрытьМодально();
		Если Рез=Неопределено Тогда
			Возврат;
		КонецЕсли;
		ДолжностьДругогоУчастка = Рез.Должность;
		ПодразделениеДругогоУчастка = Рез.Подразделение;
		
		Если ПодразделениеДругогоУчастка.Пустая() Тогда
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Поле = "ПодразделениеДругогоУчастка";
			Сообщение.Текст = "Укажите подразделение!";
			Сообщение.Сообщить();
			Возврат;
		КонецЕсли;
		
		Если ДолжностьДругогоУчастка.Пустая() Тогда
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Поле = "ДолжностьДругогоУчастка";
			Сообщение.Текст = "Укажите должность!";
			Сообщение.Сообщить();
			Возврат;
		КонецЕсли;
		
		ПоказатьВопрос(Новый ОписаниеОповещения("ПослеПодтвержденияПерезаполнитьТабличнуюЧасть", ЭтотОбъект), "Табличная часть будет очищена, продолжить?", РежимДиалогаВопрос.ДаНет, 10, КодВозвратаДиалога.Нет, "Внимание!", КодВозвратаДиалога.Нет);
	Иначе
		
		Если ПодразделениеДругогоУчастка.Пустая() Тогда
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Поле = "ПодразделениеДругогоУчастка";
			Сообщение.Текст = "Укажите подразделение!";
			Сообщение.Сообщить();
			Возврат;
		КонецЕсли;
		
		Если ДолжностьДругогоУчастка.Пустая() Тогда
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Поле = "ДолжностьДругогоУчастка";
			Сообщение.Текст = "Укажите должность!";
			Сообщение.Сообщить();
			Возврат;
		КонецЕсли;
		
		ЗаполнитьИзДругогоУчасткаНаСервере();
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПослеПодтвержденияПерезаполнитьТабличнуюЧасть(Результат, Параметры) Экспорт

	Если Результат = КодВозвратаДиалога.Да Тогда
		ЗаполнитьИзДругогоУчасткаНаСервере();
	КонецЕсли;

КонецПроцедуры

&НаСервере
Процедура ЗаполнитьИзДругогоУчасткаНаСервере()
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Дата", КонецДня(?(Объект.Ссылка.Пустая(), ТекущаяДата(), Объект.Дата)));
	Запрос.УстановитьПараметр("Регистратор", Объект.Ссылка);
	Запрос.УстановитьПараметр("Должность", ДолжностьДругогоУчастка);
	Запрос.УстановитьПараметр("Подразделение", ПодразделениеДругогоУчастка);
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ПотребностьСпецОдеждыСрезПоследних.ТРУ КАК ТРУ,
	|	ПотребностьСпецОдеждыСрезПоследних.Количество,
	|	ПотребностьСпецОдеждыСрезПоследних.СрокСлужбы
	|ИЗ
	|	РегистрСведений.ПотребностьСпецОдежды.СрезПоследних(
	|			&Дата,
	|			Регистратор <> &Регистратор
	|				И Должность = &Должность
	|				И Подразделение = &Подразделение) КАК ПотребностьСпецОдеждыСрезПоследних
	|ГДЕ
	|	(НЕ ПотребностьСпецОдеждыСрезПоследних.Количество = 0)
	|
	|УПОРЯДОЧИТЬ ПО
	|	ТРУ
	|АВТОУПОРЯДОЧИВАНИЕ";
	
	Объект.Список.Загрузить(Запрос.Выполнить().Выгрузить());
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаНачатьЗаполнение(Команда)
	
	Элементы.ГруппаРеквизитыЗаполнения.Видимость = Истина;
	Элементы.КомандаНачатьЗаполнение.Видимость = Ложь;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ЗаполнитьКод();	
КонецПроцедуры

&НаКлиенте
Процедура СписокПриИзменении(Элемент)
	//ЗаполнитьКод();
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьКод()
	
	Для каждого Строка Из Объект.Список Цикл
		 Строка.Код = Строка.Тру.Код;
	КонецЦикла; 	
	
КонецПроцедуры  


&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	ПередЗаписьюСервер();
КонецПроцедуры

&НаСервере
Процедура ПередЗаписьюСервер()
	Объект.Автор = Пользователи.ТекущийПользователь();
КонецПроцедуры
  