#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
	
#Область ОбработчикиСобытий

Процедура ОбработкаПроведения(Отказ, Режим)
	
	// ПОДГОТОВКА ПРОВЕДЕНИЯ ПО ДАННЫМ ДОКУМЕНТА
	ПроведениеСервер.ПодготовитьНаборыЗаписейКПроведению(ЭтотОбъект);
	Если РучнаяКорректировка Тогда
		Возврат;
	КонецЕсли;
	
	ПараметрыПроведения = Документы.си_УстановкаНормВыдачиСпецодеждыИИнвентаря.ПодготовитьПараметрыПроведения(Ссылка, Отказ);
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	си_УчетСпецодеждыУправлениеПроведениемДокументовСервер.СформироватьДвиженияПоРегистрам(ПараметрыПроведения.Реквизиты, ПараметрыПроведения.НормыВыдачи, Движения, Отказ,"НормыВыдачи",,,"си_НормыОбеспеченностиСпецодеждойИИнвентарем",);
	
КонецПроцедуры

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
		
	общ_ПереопределяемыеПроцедурыБКСервер.ЗаполнитьШапкуДокумента(ЭтотОбъект, СтандартнаяОбработка);
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	ТЧ = НормыВыдачи.Выгрузить(,"КлючСвязи");
	ТЧ.Свернуть("КлючСвязи");
	ЕстьСвязь = Ложь;
	Для Каждого СтрокаТЧ Из ТЧ Цикл
		НайденныеСтроки = Работники.НайтиСтроки(Новый Структура("КлючСвязи",СтрокаТЧ.КлючСвязи));
		Если Не НайденныеСтроки.Количество() = 0 Тогда
			ЕстьСвязь = Истина;
		КонецЕсли;
		НайденныеСтроки = Должности.НайтиСтроки(Новый Структура("КлючСвязи",СтрокаТЧ.КлючСвязи));
		Если Не НайденныеСтроки.Количество() = 0 Тогда
			ЕстьСвязь = Истина;
		КонецЕсли;
		Если Не ЕстьСвязь Тогда
			НайденныеСтроки = НормыВыдачи.НайтиСтроки(Новый Структура("КлючСвязи",СтрокаТЧ.КлючСвязи));
			Для Каждого НайденнаяСтрока Из НайденныеСтроки Цикл
				НормыВыдачи.Удалить(НайденнаяСтрока);
			КонецЦикла;
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры

#КонецОбласти

#Иначе
ВызватьИсключение НСтр("ru = 'Недопустимый вызов объекта на клиенте.'");
#КонецЕсли