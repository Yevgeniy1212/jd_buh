#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
	
////////////////////////////////////////////////////////////////////////////////
// ПРОГРАММНЫЙ ИНТЕРФЕЙС

#Область ДляВызоваИзДругихПодсистем

// СтандартныеПодсистемы.ВерсионированиеОбъектов

// Определяет настройки объекта для подсистемы ВерсионированиеОбъектов.
//
// Параметры:
//  Настройки - Структура - настройки подсистемы.
Процедура ПриОпределенииНастроекВерсионированияОбъектов(Настройки) Экспорт

КонецПроцедуры

// Конец СтандартныеПодсистемы.ВерсионированиеОбъектов

// СтандартныеПодсистемы.УправлениеДоступом

// См. УправлениеДоступомПереопределяемый.ПриЗаполненииСписковСОграничениемДоступа.
Процедура ПриЗаполненииОграниченияДоступа(Ограничение) Экспорт

КонецПроцедуры

// Конец СтандартныеПодсистемы.УправлениеДоступом

#КонецОбласти

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ

////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ	

Процедура Автозаполнение(Объект, ЭтотОбъект, ПоддержкаРаботыСоСтруктурнымиПодразделениями) Экспорт
	

	ГоловнаяОрганизация = ОбщегоНазначенияБКВызовСервера.ГоловнаяОрганизацияДляУчетаЗарплаты(Объект.Организация);
	
	Налогоплательщик		= ПроцедурыНалоговогоУчетаВызовСервераПовтИсп.ПолучитьНалогоплательщикаСтруктурнойЕдиницы(
																						?(ПоддержкаРаботыСоСтруктурнымиПодразделениями, Объект.СтруктурноеПодразделение, Объект.Организация),
																						Объект.Организация,
																						Перечисления.РазделыНалоговогоУчета.НалогиСЗаработнойПлаты);
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	// Установим параметры запроса
	Запрос.УстановитьПараметр("парамНачало" , Объект.ПериодРегистрации);
	Запрос.УстановитьПараметр("парамКонец" , КонецМесяца(Объект.ПериодРегистрации));
	Запрос.УстановитьПараметр("парамОрганизация" , Объект.Организация);
	Запрос.УстановитьПараметр("парамСтруктурноеПодразделение", Объект.СтруктурноеПодразделение);
	Запрос.УстановитьПараметр("парамГоловнаяОрганизация" , ГоловнаяОрганизация);
	Запрос.УстановитьПараметр("парамПользователь" , Объект.Ответственный);
	Запрос.УстановитьПараметр("парамПодразделение" , Объект.ПодразделениеОрганизации);
	Запрос.УстановитьПараметр("Уволен", Перечисления.ПричиныИзмененияСостояния.Увольнение);
	Запрос.УстановитьПараметр("Принят", Перечисления.ПричиныИзмененияСостояния.ПриемНаРаботу);
	Запрос.УстановитьПараметр("парамПриход", ВидДвиженияНакопления.Приход);
	Запрос.УстановитьПараметр("парамНалогВзнос", Перечисления.ВидыПлатежейВБюджетИФонды.Налог);
	Запрос.УстановитьПараметр("парамИсчисление", Перечисления.РасчетыСБюджетомФондамиВидСтроки.Исчисление);
	Запрос.УстановитьПараметр("парамВнутреннееСовместительство", Перечисления.ВидыЗанятостиВОрганизации.ВнутреннееСовместительство);
	
	// узнаем учетную политику по налоговому учету
	ОрганизацияЯвляетсяПлательщикомСН = УчетнаяПолитикаСервер.ОрганизацияЯвляетсяПлательщикомСН(Объект.Организация, Объект.Дата);
    ОрганизацияЯвляетсяВкладчикомОППВ = ПроцедурыНалоговогоУчета.ПолучитьПризнакВкладчикаПрофПенсионныхВзносов(Объект.Организация, Объект.Дата);
	
	РасчетДляИП = (Налогоплательщик.ЮрФизЛицо = Перечисления.ЮрФизЛицо.ФизЛицо);
	
	// При автозаполнении будем исключать физлицо, если организация является ИП на основе СНР
	ИсключитьДанныеИП = (РасчетДляИП И НЕ ОрганизацияЯвляетсяПлательщикомСН);
	
	// При заполнении СО будем учитывать требуется ли ежемесячный расчет
	ЕжемесячныйРасчетВзносовИОтчисленийЗаИП = ПроцедурыНалоговогоУчета.ПолучитьПризнакЕжемесячногоРасчетаВзносовИОтчисленийЗаИП(Объект.Организация, Объект.ПериодРегистрации);
	
	Если ИсключитьДанныеИП или ЕжемесячныйРасчетВзносовИОтчисленийЗаИП Тогда
    	Запрос.УстановитьПараметр("парамИндивидуальныйПредприниматель", Налогоплательщик.ИндивидуальныйПредприниматель);
	КонецЕсли;
			
	ПустоеПодразделение = Справочники.ПодразделенияОрганизаций.ПустаяСсылка();
	
	Если Объект.ПодразделениеОрганизации = ПустоеПодразделение Тогда
		ПоВсемПодразделениямОрганизации = Истина;
		УсловиеНаПодразделение = "РаботникиОрганизации.ПодразделениеОрганизации.Владелец = &парамОрганизация";
	Иначе
		ПоВсемПодразделениямОрганизации = Ложь;
		УсловиеНаПодразделение = "РаботникиОрганизации.ПодразделениеОрганизации В ИЕРАРХИИ (&парамПодразделение)";
	КонецЕсли;
	
	//СписокРаботниковТекст
	//Описание:
	//	Выбирает список работников, отвечающих условиям отбора, числящихся на начало месяца и принятых за месяц,
	//  а также переведенных в середине месяца из других обособленных подразделений
	РаботникиОрганизацииТекст = "
	|		// срез работников на начало месяца
	|		ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|			РаботникиОрганизации.Сотрудник.Физлицо КАК Физлицо
	|       ПОМЕСТИТЬ ВТ_РаботникиОрганизации
	|		ИЗ
	|			(ВЫБРАТЬ
	|				МАКСИМУМ(ВЫБОР
	|					КОГДА ТИПЗНАЧЕНИЯ(РаботникиОрганизацийСрезПоследних.Регистратор) = ТИП(Документ.ПриемНаРаботуВОрганизацию)
	|						ТОГДА РаботникиОрганизацийСрезПоследних.Регистратор
	|					ИНАЧЕ ЛОЖЬ
	|				КОНЕЦ) КАК Регистратор,
	|				РаботникиОрганизацийСрезПоследних.Сотрудник.Физлицо КАК Физлицо,
	|				РаботникиОрганизацийСрезПоследних.Организация КАК Организация
	|			ИЗ
	|				РегистрСведений.РаботникиОрганизаций.СрезПоследних(&парамНачало, Организация = &парамГоловнаяОрганизация И Сотрудник.ВидЗанятости <> &парамВнутреннееСовместительство) КАК РаботникиОрганизацийСрезПоследних
	|
	|			СГРУППИРОВАТЬ ПО
	|				РаботникиОрганизацийСрезПоследних.Сотрудник.Физлицо,
	|				РаботникиОрганизацийСрезПоследних.Организация) КАК АктуальныйСписокРаботников
	|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций.СрезПоследних(
	|					&парамНачало, 
	|					Организация = &парамГоловнаяОрганизация 
	|					И (Сотрудник.ВидЗанятости <> &парамВнутреннееСовместительство)) КАК РаботникиОрганизации
	|				ПО АктуальныйСписокРаботников.Физлицо = РаботникиОрганизации.Сотрудник.Физлицо
	|					И АктуальныйСписокРаботников.Организация = РаботникиОрганизации.Организация
	|					И (ВЫБОР
	|						КОГДА АктуальныйСписокРаботников.Регистратор <> ЛОЖЬ
	|							ТОГДА РаботникиОрганизации.Регистратор = АктуальныйСписокРаботников.Регистратор
	|						ИНАЧЕ ИСТИНА
	|					КОНЕЦ)
	|		ГДЕ
	|			РаботникиОрганизации.ОбособленноеПодразделение = &парамОрганизация
	|			И РаботникиОрганизации.Организация = &парамГоловнаяОрганизация
	|			И РаботникиОрганизации.СтруктурноеПодразделение = &парамСтруктурноеПодразделение
	|			И РаботникиОрганизации.ПричинаИзмененияСостояния <> &Уволен
	|			" + ?(ПоВсемПодразделениямОрганизации, "", "И " + УсловиеНаПодразделение) + "
	|		
	|		ОБЪЕДИНИТЬ
	|
	|		// движения работников за месяц
	|		ВЫБРАТЬ
	|			РаботникиОрганизации.Сотрудник.Физлицо КАК ФизЛицо
	|		ИЗ
	|			РегистрСведений.РаботникиОрганизаций КАК РаботникиОрганизации
	|				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|									ТекущееНазначение.Регистратор,
	|									ТекущееНазначение.НомерСтроки,
	|									МАКСИМУМ(ПредыдущееНазначение.Период) КАК ДатаПредыдущегоНазначения
	|								ИЗ
	|									РегистрСведений.РаботникиОрганизаций КАК ТекущееНазначение
	|									ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК ПредыдущееНазначение
	|										ПО ТекущееНазначение.Сотрудник = ПредыдущееНазначение.Сотрудник
	|											И ПредыдущееНазначение.Организация = &парамГоловнаяОрганизация
	|											И ПредыдущееНазначение.Период < ТекущееНазначение.Период
	|											И ПредыдущееНазначение.Активность
	|								ГДЕ
	|									ТекущееНазначение.Период > &парамНачало
	|									И ТекущееНазначение.Период <= &парамКонец
	|									И ТекущееНазначение.Организация = &парамГоловнаяОрганизация
	|									И ТекущееНазначение.ОбособленноеПодразделение = &парамОрганизация
	|									И ТекущееНазначение.Активность
	|								СГРУППИРОВАТЬ ПО
	|									ТекущееНазначение.Регистратор,
	|									ТекущееНазначение.НомерСтроки) КАК ДатыПредыдущихНазначений
	|				ПО РаботникиОрганизации.Регистратор = ДатыПредыдущихНазначений.Регистратор
	|					И РаботникиОрганизации.НомерСтроки = ДатыПредыдущихНазначений.НомерСтроки
	|					
	|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК ПредыдущиеНазначения
	|				ПО РаботникиОрганизации.Сотрудник = ПредыдущиеНазначения.Сотрудник
	|					И ПредыдущиеНазначения.Организация = &парамГоловнаяОрганизация
	|					И ДатыПредыдущихНазначений.ДатаПредыдущегоНазначения = ПредыдущиеНазначения.Период
	|					И ПредыдущиеНазначения.Активность
	|		
	|		ГДЕ
	|			РаботникиОрганизации.Период > &парамНачало
	|			И РаботникиОрганизации.Период <= &парамКонец
	|			И РаботникиОрганизации.Организация = &парамГоловнаяОрганизация
	|			И (РаботникиОрганизации.Сотрудник.ВидЗанятости <> &парамВнутреннееСовместительство)
	|			И (РаботникиОрганизации.ПричинаИзмененияСостояния = &Принят
	|					ИЛИ РаботникиОрганизации.ОбособленноеПодразделение <> ПредыдущиеНазначения.ОбособленноеПодразделение
	|					ИЛИ РаботникиОрганизации.СтруктурноеПодразделение <> ПредыдущиеНазначения.СтруктурноеПодразделение)
	|			И РаботникиОрганизации.ОбособленноеПодразделение = &парамОрганизация
	|			И РаботникиОрганизации.СтруктурноеПодразделение = &парамСтруктурноеПодразделение
	|			И РаботникиОрганизации.Активность
	|			" + ?(ПоВсемПодразделениямОрганизации, "", " И " + УсловиеНаПодразделение) + "
	|";

	Запрос.Текст = РаботникиОрганизацииТекст;
	Запрос.Выполнить();
	РаботникиОрганизацииТекст = "ВТ_РаботникиОрганизации";

	// Еще берем людей, которые не являются работниками или договорниками, но
	// за месяц расчета имеют налогооблагаемый доход, и по которым еще не был рассчитан 
	// налог в периоде регистрации
	СписокРаботниковТекст = "
	|ВЫБРАТЬ 
	|	РаботникиОрганизации.ФизЛицо
	|ПОМЕСТИТЬ ВТ_СписокРаботников
	|ИЗ
	|	" + РаботникиОрганизацииТекст + " КАК РаботникиОрганизации
	|
	|ОБЪЕДИНИТЬ 
	|
	|ВЫБРАТЬ
	|	СНСведенияОДоходах.ФизЛицо
	|ИЗ
	|	РегистрНакопления.СНСведенияОДоходах КАК СНСведенияОДоходах 
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций.СрезПоследних(
	|				&парамКонец, 
	|				Организация = &парамГоловнаяОрганизация 
	|				И Сотрудник.ВидЗанятости <> &парамВнутреннееСовместительство) КАК РаботникиОрганизации
	|		ПО СНСведенияОДоходах.ФизЛицо = РаботникиОрганизации.Сотрудник.ФизЛицо
	|			И (ВЫБОР 
	|				КОГДА (РаботникиОрганизации.ПричинаИзмененияСостояния = &Уволен
	|					И ДОБАВИТЬКДАТЕ(РаботникиОрганизации.Период, ДЕНЬ, -1) >= &парамНачало) 
	|					ИЛИ РаботникиОрганизации.ПричинаИзмененияСостояния <> &Уволен
	|					ТОГДА ИСТИНА
	|				ИНАЧЕ ЛОЖЬ
	|			КОНЕЦ)
	|
	|ГДЕ
	|	СНСведенияОДоходах.ПериодРегистрации = &парамНачало И
	|	СНСведенияОДоходах.Организация = &парамОрганизация И
	|	РаботникиОрганизации.Сотрудник ЕСТЬ NULL И
	|	СНСведенияОДоходах.Активность
	|
	|ОБЪЕДИНИТЬ 
	|
	|ВЫБРАТЬ
	|	СОСведенияОДоходах.ФизЛицо 
	|ИЗ
	|	РегистрНакопления.СОСведенияОДоходах КАК СОСведенияОДоходах
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций.СрезПоследних(
	|				&парамКонец, 
	|				Организация = &парамГоловнаяОрганизация 
	|				И Сотрудник.ВидЗанятости <> &парамВнутреннееСовместительство) КАК РаботникиОрганизации
	|		ПО СОСведенияОДоходах.ФизЛицо = РаботникиОрганизации.Сотрудник.ФизЛицо
	|			И (ВЫБОР 
	|				КОГДА (РаботникиОрганизации.ПричинаИзмененияСостояния = &Уволен
	|					И ДОБАВИТЬКДАТЕ(РаботникиОрганизации.Период, ДЕНЬ, -1) >= &парамНачало)
	|					ИЛИ РаботникиОрганизации.ПричинаИзмененияСостояния <> &Уволен
	|					ТОГДА ИСТИНА
	|				ИНАЧЕ ЛОЖЬ
	|			КОНЕЦ)
	|
	|ГДЕ
	|	СОСведенияОДоходах.ПериодРегистрации = &парамНачало И
	|	СОСведенияОДоходах.Организация = &парамОрганизация И	
	|	РаботникиОрганизации.Сотрудник ЕСТЬ NULL И  
	//Ограничено получение сведений по контрагентам в рамках ТП Реализация СО за ГПХ 
	|	СОСведенияОДоходах.ФизЛицо ССЫЛКА Справочник.ФизическиеЛица И
	|	СОСведенияОДоходах.Активность
	|
	|ОБЪЕДИНИТЬ 
	|
	|ВЫБРАТЬ
	|	ОППВСведенияОДоходах.ФизЛицо 
	|ИЗ
	|	РегистрНакопления.ОППВСведенияОДоходах КАК ОППВСведенияОДоходах
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций.СрезПоследних(
	|				&парамКонец, 
	|				Организация = &парамГоловнаяОрганизация) КАК РаботникиОрганизации
	|		ПО ОППВСведенияОДоходах.ФизЛицо = РаботникиОрганизации.Сотрудник.ФизЛицо
	|			И РаботникиОрганизации.ОбособленноеПодразделение = &парамОрганизация
	|           И (ВЫБОР 
	|				КОГДА (РаботникиОрганизации.ПричинаИзмененияСостояния = &Уволен
	|					И ДОБАВИТЬКДАТЕ(РаботникиОрганизации.Период, ДЕНЬ, -1) >= &парамНачало)
	|					ИЛИ РаботникиОрганизации.ПричинаИзмененияСостояния <> &Уволен
	|					ТОГДА ИСТИНА
	|				ИНАЧЕ ЛОЖЬ
	|			КОНЕЦ)
	|
	|ГДЕ
	|	ОППВСведенияОДоходах.ПериодРегистрации = &парамНачало И
	|	ОППВСведенияОДоходах.Организация = &парамОрганизация И
	|	РаботникиОрганизации.Сотрудник ЕСТЬ NULL И
	|	ОППВСведенияОДоходах.Активность
	|
	|ОБЪЕДИНИТЬ 
	|
	|ВЫБРАТЬ
	|	ОПВРСведенияОДоходах.ФизЛицо 
	|ИЗ
	|	РегистрНакопления.ОПВРСведенияОДоходах КАК ОПВРСведенияОДоходах
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций.СрезПоследних(
	|				&парамКонец, 
	|				Организация = &парамГоловнаяОрганизация) КАК РаботникиОрганизации
	|		ПО ОПВРСведенияОДоходах.ФизЛицо = РаботникиОрганизации.Сотрудник.ФизЛицо
	|			И РаботникиОрганизации.ОбособленноеПодразделение = &парамОрганизация
	|           И (ВЫБОР 
	|				КОГДА (РаботникиОрганизации.ПричинаИзмененияСостояния = &Уволен
	|					И ДОБАВИТЬКДАТЕ(РаботникиОрганизации.Период, ДЕНЬ, -1) >= &парамНачало)
	|					ИЛИ РаботникиОрганизации.ПричинаИзмененияСостояния <> &Уволен
	|					ТОГДА ИСТИНА
	|				ИНАЧЕ ЛОЖЬ
	|			КОНЕЦ)
	|
	|ГДЕ
	|	ОПВРСведенияОДоходах.ПериодРегистрации = &парамНачало И
	|	ОПВРСведенияОДоходах.Организация = &парамОрганизация И
	|	РаботникиОрганизации.Сотрудник ЕСТЬ NULL И
	|	ОПВРСведенияОДоходах.Активность
	|
	|ОБЪЕДИНИТЬ 
	|
	|ВЫБРАТЬ
	|	ООСМССведенияОДоходах.ФизЛицо 
	|ИЗ
	|	РегистрНакопления.ООСМССведенияОДоходах КАК ООСМССведенияОДоходах
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций.СрезПоследних(
	|				&парамКонец, 
	|				Организация = &парамГоловнаяОрганизация) КАК РаботникиОрганизации
	|		ПО ООСМССведенияОДоходах.ФизЛицо = РаботникиОрганизации.Сотрудник.ФизЛицо
	|			И РаботникиОрганизации.ОбособленноеПодразделение = &парамОрганизация
	|           И (ВЫБОР 
	|				КОГДА (РаботникиОрганизации.ПричинаИзмененияСостояния = &Уволен
	|					И ДОБАВИТЬКДАТЕ(РаботникиОрганизации.Период, ДЕНЬ, -1) >= &парамНачало)
	|					ИЛИ РаботникиОрганизации.ПричинаИзмененияСостояния <> &Уволен
	|					ТОГДА ИСТИНА
	|				ИНАЧЕ ЛОЖЬ
	|			КОНЕЦ)
	|
	|ГДЕ
	|	ООСМССведенияОДоходах.ПериодРегистрации = &парамНачало И
	|	ООСМССведенияОДоходах.Организация = &парамОрганизация И
	|	РаботникиОрганизации.Сотрудник ЕСТЬ NULL И
	|	ООСМССведенияОДоходах.Активность
	|";
	
	Запрос.Текст = СписокРаботниковТекст;
	Запрос.Выполнить();
	СписокРаботниковТекст = "ВТ_СписокРаботников";
	
	// заполнение табличной части "ИсчисленныйСН"
	Если ОрганизацияЯвляетсяПлательщикомСН Тогда

		Если РасчетДляИП Тогда
			
			// заполнение табличной части "ИсчисленныйСН" для ИП, если налоговый режим не на основе упрощенной декларации
			ИсчисленныйСНТекст =
				"ВЫБРАТЬ РАЗЛИЧНЫЕ РАЗРЕШЕННЫЕ
				|	Работники.ФизЛицо,
				|	&парамНачало КАК МесяцНалоговогоПериода
				|ИЗ
				|	" + СписокРаботниковТекст + " КАК Работники
				|";
			Если ЕжемесячныйРасчетВзносовИОтчисленийЗаИП Тогда
				ИсчисленныйСНТекст = ИсчисленныйСНТекст + "
				|ОБЪЕДИНИТЬ
				|
				|ВЫБРАТЬ
				|	&парамИндивидуальныйПредприниматель КАК ФизЛицо,
				|   &парамНачало КАК МесяцНалоговогоПериода
				|";
			КонецЕсли;
		Иначе 
			
			// заполнение табличной части "ИсчисленныйСН" для юр. лиц, если налоговый режим не на основе упрощенной декларации
			ИсчисленныйСНТекст =
				"ВЫБРАТЬ РАЗЛИЧНЫЕ РАЗРЕШЕННЫЕ
				|	Работники.ФизЛицо,
				|	&парамНачало КАК МесяцНалоговогоПериода
				|ИЗ
				|	РегистрНакопления.СНСведенияОДоходах КАК СНСведенияОДоходах
				|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ " + СписокРаботниковТекст + " КАК Работники
				|		ПО СНСведенияОДоходах.ФизЛицо = Работники.ФизЛицо
				|
				|ГДЕ
				|	СНСведенияОДоходах.ПериодРегистрации = &парамНачало И
				|	СНСведенияОДоходах.Организация = &парамОрганизация И
				|	СНСведенияОДоходах.Активность
				|";
		КонецЕсли;
		
		Запрос.Текст = ИсчисленныйСНТекст;
		ТЗИсчисленныйСН = Запрос.Выполнить().Выгрузить();   
		
		
		// переносим в табличную часть документа, не затирая существующие строки
		Для Каждого СтрокаТЗ Из ТЗИсчисленныйСН Цикл
			НоваяСтрока = Объект.ИсчисленныйСН.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаТЗ);
		КонецЦикла;		
	
	КонецЕсли;
	
	// заполнение табличной части "ИсчисленныеСО"
	
	// ФизлицаБезСоциальногоСтрахования
	//	Поля:
	//		Физлицо
	//
	//	Описание:
	//	список физлиц не подлежащих социальному страхованию
	ФизлицаБезСоциальногоСтрахованияТекст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ГражданствоФизЛиц.ФизЛицо
	|ПОМЕСТИТЬ ВТ_ФизлицаБезСоциальногоСтрахования
	|ИЗ
	|	РегистрСведений.ГражданствоФизЛиц.СрезПоследних(&парамКонец) КАК ГражданствоФизЛиц
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ " + СписокРаботниковТекст + " КАК Работники
	|		ПО ГражданствоФизЛиц.ФизЛицо = Работники.ФизЛицо
	|
	|ГДЕ
	|	(ГражданствоФизЛиц.НеПодлежитСоциальномуСтрахованию)";
	
	Запрос.Текст = ФизлицаБезСоциальногоСтрахованияТекст;
	Запрос.Выполнить();
	ФизлицаБезСоциальногоСтрахованияТекст = "ВТ_ФизлицаБезСоциальногоСтрахования";
	
	// ФизлицаПенсионеры
	//	Поля:
	//		Физлицо
	//
	//	Описание:
	//	список физлиц достигших пенсионный возраст
	ФизлицаПенсионерыТекст = "
    |ВЫБРАТЬ РАЗЛИЧНЫЕ 
	|	СведенияОПенсионномОбеспеченииФизЛиц.ФизЛицо
	|ПОМЕСТИТЬ ВТ_ФизлицаПенсионеры
	|ИЗ
	|	РегистрСведений.СведенияОПенсионномОбеспеченииФизЛиц.СрезПоследних(&парамКонец) КАК СведенияОПенсионномОбеспеченииФизЛиц
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ " + СписокРаботниковТекст + " КАК Работники
	|		ПО СведенияОПенсионномОбеспеченииФизЛиц.ФизЛицо = Работники.ФизЛицо
	|
	|ГДЕ
	|	(СведенияОПенсионномОбеспеченииФизЛиц.Пенсионер)";
	
	Запрос.Текст = ФизлицаПенсионерыТекст;
	Запрос.Выполнить();
	ФизлицаПенсионерыТекст = "ВТ_ФизлицаПенсионеры";
	
	ИсчисленныеСОТекст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ РАЗРЕШЕННЫЕ
	|	Работники.ФизЛицо,
	|	&парамНачало КАК МесяцНалоговогоПериода
	|ИЗ
	|	РегистрНакопления.СОСведенияОДоходах КАК СОСведенияОДоходах
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ " + СписокРаботниковТекст + " КАК Работники
	|		ПО СОСведенияОДоходах.ФизЛицо = Работники.ФизЛицо
	|
	|ГДЕ
	|	СОСведенияОДоходах.ПериодРегистрации = &парамНачало И
	|	СОСведенияОДоходах.Организация = &парамОрганизация И
	|	СОСведенияОДоходах.ФизЛицо НЕ В (ВЫБРАТЬ ФизЛицо ИЗ " + ФизлицаПенсионерыТекст + " КАК ФизлицаПенсионеры) И
	|	СОСведенияОДоходах.ФизЛицо НЕ В (ВЫБРАТЬ ФизЛицо ИЗ " + ФизлицаБезСоциальногоСтрахованияТекст + " КАК ФизлицаБезСоциальногоСтрахования) И
	|	СОСведенияОДоходах.Активность
	|	" + ?(ИсключитьДанныеИП и НЕ ЕжемесячныйРасчетВзносовИОтчисленийЗаИП, "И СОСведенияОДоходах.ФизЛицо <> &парамИндивидуальныйПредприниматель", "") + "        
	|";
	
	Запрос.Текст = ИсчисленныеСОТекст;
	ТЗИсчисленныеСО = Запрос.Выполнить().Выгрузить();   
	
	
	// переносим в табличную часть документа, не затирая существующие строки
	Для Каждого СтрокаТЗ Из ТЗИсчисленныеСО Цикл
		НоваяСтрока = Объект.ИсчисленныеСО.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаТЗ);
	КонецЦикла;
	
	// ОППВ и ОПВР
	// ФизлицаБезПраваНаПенсию
	//	Поля:
	//		Физлицо
	//
	//	Описание:
	//	список физлиц не имеющих право на пенсионное обеспечение
	ФизлицаБезПраваНаПенсиюТекст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ГражданствоФизЛиц.ФизЛицо
	|ПОМЕСТИТЬ ВТ_ФизлицаБезПраваНаПенсию
	|ИЗ
	|	РегистрСведений.ГражданствоФизЛиц.СрезПоследних(&парамКонец) КАК ГражданствоФизЛиц
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ " + СписокРаботниковТекст + " КАК Работники
	|		ПО ГражданствоФизЛиц.ФизЛицо = Работники.ФизЛицо
	|
	|ГДЕ
	|	(ГражданствоФизЛиц.НеИмеетПравоНаПенсию)";
	
	Запрос.Текст = ФизлицаБезПраваНаПенсиюТекст;
	Запрос.Выполнить();                                         		
	ФизлицаБезПраваНаПенсиюТекст = "ВТ_ФизлицаБезПраваНаПенсию";
	
	// заполнение табличной части "ИсчисленныйОППВ"	
	Если ОрганизацияЯвляетсяВкладчикомОППВ Тогда
		
		ИсчисленныйОППВТекст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ РАЗРЕШЕННЫЕ
		|	Работники.ФизЛицо,
		|	&парамНачало КАК МесяцНалоговогоПериода
		|ИЗ
		|	РегистрНакопления.ОППВСведенияОДоходах КАК ОППВСведенияОДоходах
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ " + СписокРаботниковТекст + " КАК Работники
		|		ПО ОППВСведенияОДоходах.ФизЛицо = Работники.ФизЛицо
		|
		|ГДЕ
		|	ОППВСведенияОДоходах.ПериодРегистрации = &парамНачало И
		|	ОППВСведенияОДоходах.Организация = &парамОрганизация И
		|	ОППВСведенияОДоходах.ФизЛицо НЕ В (ВЫБРАТЬ ФизЛицо ИЗ " + ФизлицаПенсионерыТекст + " КАК ФизлицаПенсионеры) И
		|	ОППВСведенияОДоходах.ФизЛицо НЕ В (ВЫБРАТЬ ФизЛицо ИЗ " + ФизлицаБезПраваНаПенсиюТекст + " КАК ФизлицаБезПраваНаПенсию) И
		|	ОППВСведенияОДоходах.Активность
		|";
		
		Запрос.Текст = ИсчисленныйОППВТекст;
		ТЗИсчисленныйОППВ = Запрос.Выполнить().Выгрузить(); 
		
		
		// переносим в табличную часть документа, не затирая существующие строки
		Для Каждого СтрокаТЗ Из ТЗИсчисленныйОППВ Цикл
			НоваяСтрока = Объект.ИсчисленныйОППВ.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаТЗ);
		КонецЦикла;
		
	КонецЕсли;
	
	// заполнение табличной части "ИсчисленныйОПВР"
	// Отчисления ОПВР вводятся с 1 января 2023 г.

	ИсчисленныйОПВРТекст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ РАЗРЕШЕННЫЕ
	|	Работники.ФизЛицо,
	|	&парамНачало КАК МесяцНалоговогоПериода
	|ИЗ
	|	РегистрНакопления.ОПВРСведенияОДоходах КАК ОПВРСведенияОДоходах
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ " + СписокРаботниковТекст + " КАК Работники
	|		ПО ОПВРСведенияОДоходах.ФизЛицо = Работники.ФизЛицо	
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ФизическиеЛица КАК ФизическиеЛица
	|		ПО ОПВРСведенияОДоходах.ФизЛицо = ФизическиеЛица.Ссылка
	|			И (ФизическиеЛица.ДатаРождения >= ДАТАВРЕМЯ(1975, 1, 1)
	|			ИЛИ ФизическиеЛица.ДатаРождения = ДАТАВРЕМЯ(1, 1, 1))
	|
	|ГДЕ
	|	ОПВРСведенияОДоходах.ПериодРегистрации = &парамНачало И
	|	ОПВРСведенияОДоходах.Организация = &парамОрганизация И
	|	ОПВРСведенияОДоходах.ФизЛицо НЕ В (ВЫБРАТЬ ФизЛицо ИЗ " + ФизлицаПенсионерыТекст + " КАК ФизлицаПенсионеры) И
	|	ОПВРСведенияОДоходах.ФизЛицо НЕ В (ВЫБРАТЬ ФизЛицо ИЗ " + ФизлицаБезПраваНаПенсиюТекст + " КАК ФизлицаБезПраваНаПенсию) И
	|	ОПВРСведенияОДоходах.Активность
	|";
	
	Запрос.Текст = ИсчисленныйОПВРТекст;
	ТЗИсчисленныйОПВР = Запрос.Выполнить().Выгрузить();    
	
	
	// переносим в табличную часть документа, не затирая существующие строки
	Для Каждого СтрокаТЗ Из ТЗИсчисленныйОПВР Цикл
		НоваяСтрока = Объект.ИсчисленныйОПВР.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаТЗ);
	КонецЦикла;

	// заполнение табличной части "ИсчисленныеООСМС"
	// Отчисления ОСМС вводятся с 1 июля 2017 г.
	
	// ФизлицаБезМедицинскогоСтрахования
	//	Поля:
	//		Физлицо
	//
	//	Описание:
	//	список физлиц не подлежащих медицинскому страхованию
	ФизлицаБезМедицинскогоСтрахованияТекст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ГражданствоФизЛиц.ФизЛицо
	|ПОМЕСТИТЬ ВТ_ФизлицаБезМедицинскогоСтрахования
	|ИЗ
	|	РегистрСведений.ГражданствоФизЛиц.СрезПоследних(&парамКонец, ) КАК ГражданствоФизЛиц
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ " + СписокРаботниковТекст + " КАК Работники
	|		ПО ГражданствоФизЛиц.ФизЛицо = Работники.ФизЛицо
	|ГДЕ
	|	ГражданствоФизЛиц.НеПодлежитСоциальномуМедицинскомуСтрахованию";
	
	Запрос.Текст = ФизлицаБезМедицинскогоСтрахованияТекст;
	Запрос.Выполнить();
	ФизлицаБезМедицинскогоСтрахованияТекст = "ВТ_ФизлицаБезМедицинскогоСтрахования";
	
	// ФизлицаИнвалиды
	//	Поля:
	//		Физлицо
	//
	//	Описание:
	//	список физлиц-инвалидов
	ФизлицаИнвалидыТекст = "
    |ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СведенияОбИнвалидностиФизлиц.ФизЛицо
	|ПОМЕСТИТЬ ВТ_ФизлицаИнвалиды
	|ИЗ
	|	РегистрСведений.СведенияОбИнвалидностиФизлиц.СрезПоследних(&парамКонец) КАК СведенияОбИнвалидностиФизлиц
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ " + СписокРаботниковТекст + " КАК Работники
	|		ПО СведенияОбИнвалидностиФизлиц.ФизЛицо = Работники.ФизЛицо
	|
	|ГДЕ
	|	СведенияОбИнвалидностиФизлиц.ОтношениеКИнвалидности = ЗНАЧЕНИЕ(Перечисление.ОтношениеКИнвалидности.Инвалид)
	|	И (СведенияОбИнвалидностиФизлиц.СрокДействияСправки = ДАТАВРЕМЯ(1,1,1) ИЛИ КОНЕЦПЕРИОДА(СведенияОбИнвалидностиФизлиц.СрокДействияСправки, МЕСЯЦ) >= &парамКонец)
	|";
	Запрос.Текст = ФизлицаИнвалидыТекст;
	Запрос.Выполнить();
	ФизлицаИнвалидыТекст = "ВТ_ФизлицаИнвалиды";

	// ФизлицаУчастникиВОВ
	//	Поля:
	//		Физлицо
	//
	//	Описание:
	//	список физлиц участников и инвалидов ВОВ
	ФизлицаУчастникиВОВТекст = "
    |ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СведенияОФизлицахУчастникахВОВ.ФизЛицо
	|ПОМЕСТИТЬ ВТ_ФизлицаУчастникиВОВ
	|ИЗ
	|	РегистрСведений.СведенияОФизлицахУчастникахВОВ.СрезПоследних(&парамКонец) КАК СведенияОФизлицахУчастникахВОВ
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ " + СписокРаботниковТекст + " КАК Работники
	|		ПО СведенияОФизлицахУчастникахВОВ.ФизЛицо = Работники.ФизЛицо
	|
	|ГДЕ
	|	СведенияОФизлицахУчастникахВОВ.Статус = ЗНАЧЕНИЕ(Перечисление.КатегорииФизлицУчастниковВОВ.УчастникВОВ)
	|	ИЛИ СведенияОФизлицахУчастникахВОВ.Статус = ЗНАЧЕНИЕ(Перечисление.КатегорииФизлицУчастниковВОВ.ИнвалидВОВ)
	|";
	Запрос.Текст = ФизлицаУчастникиВОВТекст;
	Запрос.Выполнить();
	ФизлицаУчастникиВОВТекст = "ВТ_ФизлицаУчастникиВОВ";

	ИсчисленныеООСМСТекст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ РАЗРЕШЕННЫЕ
	|	Работники.ФизЛицо,
	|	&парамНачало КАК МесяцНалоговогоПериода
	|ИЗ
	|	РегистрНакопления.ООСМССведенияОДоходах КАК ООСМССведенияОДоходах
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ " + СписокРаботниковТекст + " КАК Работники
	|		ПО ООСМССведенияОДоходах.ФизЛицо = Работники.ФизЛицо
	|
	|ГДЕ
	|	ООСМССведенияОДоходах.ПериодРегистрации = &парамНачало И
	|	ООСМССведенияОДоходах.Организация = &парамОрганизация И
	|	ООСМССведенияОДоходах.ФизЛицо НЕ В (ВЫБРАТЬ ФизЛицо ИЗ " + ФизлицаПенсионерыТекст + " КАК ФизлицаПенсионеры) И
	|	ООСМССведенияОДоходах.ФизЛицо НЕ В (ВЫБРАТЬ ФизЛицо ИЗ " + ФизлицаБезМедицинскогоСтрахованияТекст + " КАК ФизлицаБезМедицинскогоСтрахования) И
	|	ООСМССведенияОДоходах.ФизЛицо НЕ В (ВЫБРАТЬ ФизЛицо ИЗ " + ФизлицаИнвалидыТекст + " КАК ФизлицаИнвалиды) И
	|	ООСМССведенияОДоходах.ФизЛицо НЕ В (ВЫБРАТЬ ФизЛицо ИЗ " + ФизлицаУчастникиВОВТекст + " КАК ФизлицаУчастникиВОВ) И
	|	" + ?(ИсключитьДанныеИП, "ООСМССведенияОДоходах.ФизЛицо <> &парамИндивидуальныйПредприниматель И", "") + "        
	|	ООСМССведенияОДоходах.Активность
	|";
	
	Запрос.Текст = ИсчисленныеООСМСТекст;
	ТЗИсчисленныеООСМС = Запрос.Выполнить().Выгрузить();
	
	
	// переносим в табличную часть документа, не затирая существующие строки
	Для Каждого СтрокаТЗ Из ТЗИсчисленныеООСМС Цикл
		НоваяСтрока = Объект.ИсчисленныеООСМС.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаТЗ);
	КонецЦикла;

КонецПроцедуры

Процедура Рассчитать(Объект, ФизЛицо = Неопределено, КомментироватьРасчет = Ложь, СтруктураДополнительныхДанных = Неопределено) Экспорт
	
	Отказ = Ложь;
	
	НачатьТранзакцию();
	
	ДокументОбъект = Объект.Ссылка.ПолучитьОбъект();
	Если НЕ ДокументОбъект.ПроверитьЗаполнение() Тогда
		ОтменитьТранзакцию();
		Возврат;
	КонецЕсли;
	
	ПоддержкаРаботыСоСтруктурнымиПодразделениями = ПолучитьФункциональнуюОпцию("ПоддержкаРаботыСоСтруктурнымиПодразделениями");
	
	Если ПоддержкаРаботыСоСтруктурнымиПодразделениями Тогда
		Налогоплательщик = ПроцедурыНалоговогоУчетаВызовСервераПовтИсп.ПолучитьНалогоплательщикаСтруктурнойЕдиницы(Объект.Организация, 
																		Объект.Организация, 
																		Перечисления.РазделыНалоговогоУчета.НалогиСЗаработнойПлаты);
	Иначе
		Налогоплательщик = Объект.Организация;
	КонецЕсли;
	
	// узнаем учетную политику по налоговому учету
	ОрганизацияЯвляетсяПлательщикомСН = УчетнаяПолитикаСервер.ОрганизацияЯвляетсяПлательщикомСН(Объект.Организация, Объект.ПериодРегистрации);
	ОрганизацияЯвляетсяВкладчикомОППВ = УчетнаяПолитикаСервер.ВкладчикОППВ(Объект.Организация, Объект.ПериодРегистрации);

	РаспределятьНалогиПоСтруктурнымЕдиницам = УчетнаяПолитикаСервер.ПолучитьПризнакиРаспределенияНалогов(Объект.Организация, Объект.ПериодРегистрации).РаспределятьНалогиПоСтруктурнымЕдиницам;
	ОтражениеПоПериодуРегистрации = УчетнаяПолитикаСервер.ОтражениеПоПериодуРегистрации(Объект.Организация, Объект.ПериодРегистрации);
	
	ГоловнаяОрганизация = ОбщегоНазначенияБКВызовСервера.ГоловнаяОрганизацияДляУчетаЗарплаты(Объект.Организация);
	
	// Определим структуру дополнительных параметров 
	ДополнительныеПараметрыЗапроса = Новый Структура();
	ДополнительныеПараметрыЗапроса.Вставить("парамФизЛицо", ФизЛицо);
	ДополнительныеПараметрыЗапроса.Вставить("парамОрганизация", Объект.Организация);
	ДополнительныеПараметрыЗапроса.Вставить("парамГоловнаяОрганизация", ГоловнаяОрганизация);

	// ОППВ
	Если ОрганизацияЯвляетсяВкладчикомОППВ Тогда
		
		//Очистим движения
		НаборОППВРасчетыСФондами = РегистрыНакопления.ОППВРасчетыСФондами.СоздатьНаборЗаписей();
		НаборОППВРасчетыСФондами.Отбор.Регистратор.Значение = Объект.Ссылка;
		НаборОППВРасчетыСФондами.Записать();// сначала удалим существующие движения

		// Составим текст запроса для выбора списка физлиц, по которым надо считать ОППВ
		СписокФизлицТекст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Работники.Физлицо КАК Физлицо
		|ИЗ
		|	Документ.РасчетСНиСО.ИсчисленныйОППВ КАК Работники
		|
		|ГДЕ
		|	Работники.Ссылка = &парамРегистратор
		|	" + ?(ФизЛицо <> Неопределено, "И Работники.ФизЛицо В (&парамФизЛицо)", "");
		
		ДанныеОППВ = ПроведениеРасчетовСервер.ПолучитьДанныеДляРасчетаОППВ(Неопределено, Объект.ПериодРегистрации, Налогоплательщик, Объект.Ссылка, СписокФизлицТекст, ОтражениеПоПериодуРегистрации, ДополнительныеПараметрыЗапроса);
		Если ДанныеОППВ <> НеОпределено Тогда
			ПроведениеРасчетовСервер.ЗаполнитьНаборЗаписейПоДаннымОППВ(Объект.ИсчисленныйОППВ, Объект.ПериодРегистрации, НаборОППВРасчетыСФондами, ДанныеОППВ, Налогоплательщик, Объект.Организация, ОтражениеПоПериодуРегистрации, , КомментироватьРасчет, ФизЛицо, НЕ РаспределятьНалогиПоСтруктурнымЕдиницам, ?(СтруктураДополнительныхДанных = Неопределено, Неопределено, СтруктураДополнительныхДанных.РасчетОППВДополнительныеДанные));
		КонецЕсли;
		
		НаборОППВРасчетыСФондами.Записать();

	КонецЕсли;
	
	// СО
	//Очистим движения
	НаборСОРасчетыСФондами = РегистрыНакопления.СОРасчетыСФондами.СоздатьНаборЗаписей();
	НаборСОРасчетыСФондами.Отбор.Регистратор.Значение = Объект.Ссылка;
	НаборСОРасчетыСФондами.Записать();// сначала удалим существующие движения
	
	// Получение результата СО
	// Составим текст запроса для выбора списка физлиц, по которым надо считать СО
	СписокФизлицТекст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Работники.Физлицо КАК Физлицо
	|ИЗ
	|	Документ.РасчетСНиСО.ИсчисленныеСО КАК Работники
	|
	|ГДЕ
	|	Работники.Ссылка = &парамРегистратор
	|	" + ?(ФизЛицо <> Неопределено, "И Работники.ФизЛицо В (&парамФизЛицо)", "");
	
	ДанныеСО = ПроведениеРасчетовСервер.ПолучитьДанныеДляРасчетаСО(Неопределено, Объект.ПериодРегистрации, Налогоплательщик, Объект.Ссылка, СписокФизлицТекст, ОтражениеПоПериодуРегистрации, ДополнительныеПараметрыЗапроса);
	Если ДанныеСО <> НеОпределено Тогда
		ПроведениеРасчетовСервер.ЗаполнитьНаборЗаписейПоДаннымСО(Объект.ИсчисленныеСО, Объект.ПериодРегистрации, НаборСОРасчетыСФондами, ДанныеСО, Налогоплательщик, Объект.Организация, ОтражениеПоПериодуРегистрации, , КомментироватьРасчет, ФизЛицо, Не РаспределятьНалогиПоСтруктурнымЕдиницам, ?(СтруктураДополнительныхДанных = Неопределено, Неопределено, СтруктураДополнительныхДанных.РасчетСОДополнительныеДанные));
	КонецЕсли;

	НаборСОРасчетыСФондами.Записать();
	
	Если ОрганизацияЯвляетсяПлательщикомСН Тогда
	
		// Составим текст запроса для выбора списка физлиц, по которым надо считать СН
		СписокФизлицТекст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Работники.Физлицо КАК Физлицо
		|ИЗ
		|	Документ.РасчетСНиСО.ИсчисленныйСН КАК Работники
		|
		|ГДЕ
		|	Работники.Ссылка = &парамРегистратор
		|	" + ?(ФизЛицо <> Неопределено, "И Работники.ФизЛицо В (&парамФизЛицо)", "");
		
		// получение результата СН по регрессивной шкале ставок
		ДанныеСН = ПроведениеРасчетовСервер.ПолучитьДанныеДляРасчетаСН(Неопределено, Объект.ПериодРегистрации,  Налогоплательщик, ГоловнаяОрганизация, Объект.Ссылка, СписокФизлицТекст, ДополнительныеПараметрыЗапроса);
		Если ДанныеСН <> НеОпределено Тогда
			ПроведениеРасчетовСервер.ЗаполнитьТабличнуюЧастьПоДаннымСН(Объект.ИсчисленныйСН, Объект.ПериодРегистрации, ДанныеСН, Налогоплательщик, ОтражениеПоПериодуРегистрации, , КомментироватьРасчет, ФизЛицо, Не РаспределятьНалогиПоСтруктурнымЕдиницам, ?(СтруктураДополнительныхДанных = Неопределено, Неопределено, СтруктураДополнительныхДанных.РасчетСНДополнительныеДанные));
		КонецЕсли;
	
	КонецЕсли;
	
	// ООСМС

	// Составим текст запроса для выбора списка физлиц, по которым надо считать ООСМС
	СписокФизлицТекст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Работники.Физлицо КАК Физлицо
	|ИЗ
	|	Документ.РасчетСНиСО.ИсчисленныеООСМС КАК Работники
	|
	|ГДЕ
	|	Работники.Ссылка = &парамРегистратор
	|	" + ?(ФизЛицо <> Неопределено, "И Работники.ФизЛицо В (&парамФизЛицо)", "");
	
	ДанныеООСМС = ПроведениеРасчетовСервер.ПолучитьДанныеДляРасчетаООСМС(Неопределено, Объект.ПериодРегистрации, Налогоплательщик, Объект.Ссылка, СписокФизлицТекст, ОтражениеПоПериодуРегистрации, ДополнительныеПараметрыЗапроса);
	Если ДанныеООСМС <> НеОпределено Тогда
		ПроведениеРасчетовСервер.ЗаполнитьНаборЗаписейПоДаннымООСМС(Объект.ИсчисленныеООСМС, Объект.ПериодРегистрации, ДанныеООСМС, Налогоплательщик, Объект.Организация, ОтражениеПоПериодуРегистрации, , КомментироватьРасчет, ФизЛицо, Не РаспределятьНалогиПоСтруктурнымЕдиницам, ?(СтруктураДополнительныхДанных = Неопределено, Неопределено, СтруктураДополнительныхДанных.РасчетООСМСДополнительныеДанные));
	КонецЕсли;

	// ОПВР

	НаборОПВРРасчетыСФондами = РегистрыНакопления.ОПВРРасчетыСФондами.СоздатьНаборЗаписей();
	НаборОПВРРасчетыСФондами.Отбор.Регистратор.Значение = Объект.Ссылка;
	НаборОПВРРасчетыСФондами.Записать();// сначала удалим существующие движения
	
	// Составим текст запроса для выбора списка физлиц, по которым надо считать ООСМС
	СписокФизлицТекст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Работники.Физлицо КАК Физлицо
	|ИЗ
	|	Документ.РасчетСНиСО.ИсчисленныйОПВР КАК Работники
	|
	|ГДЕ
	|	Работники.Ссылка = &парамРегистратор
	|	" + ?(ФизЛицо <> Неопределено, "И Работники.ФизЛицо В (&парамФизЛицо)", "");
	
	ДанныеОПВР = ПроведениеРасчетовСервер.ПолучитьДанныеДляРасчетаОПВР(Неопределено, Объект.ПериодРегистрации, Налогоплательщик, Объект.Ссылка, СписокФизлицТекст, ОтражениеПоПериодуРегистрации, ДополнительныеПараметрыЗапроса);
	Если ДанныеОПВР <> НеОпределено Тогда
		ПроведениеРасчетовСервер.ЗаполнитьНаборЗаписейПоДаннымОПВР(Объект.ИсчисленныйОПВР, Объект.ПериодРегистрации, НаборОПВРРасчетыСФондами, ДанныеОПВР, Налогоплательщик, Объект.Организация, ОтражениеПоПериодуРегистрации, , КомментироватьРасчет, ФизЛицо, НЕ РаспределятьНалогиПоСтруктурнымЕдиницам, ?(СтруктураДополнительныхДанных = Неопределено, Неопределено, СтруктураДополнительныхДанных.РасчетОПВРДополнительныеДанные));
	КонецЕсли;

	
	// Удаляем движения
	НаборСОРасчетыСФондами.Очистить();
	НаборСОРасчетыСФондами.Записать();
	
	Если ОрганизацияЯвляетсяВкладчикомОППВ Тогда
		НаборОППВРасчетыСФондами.Очистить();
		НаборОППВРасчетыСФондами.Записать();
	КонецЕсли;
	
	НаборОПВРРасчетыСФондами.Очистить();
	НаборОПВРРасчетыСФондами.Записать();

	// Завершаем транзакцию
	ЗафиксироватьТранзакцию();	
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// Проведение

Функция ПодготовитьПараметрыПроведения(Ссылка, Отказ) Экспорт
	
	ПараметрыПроведения = Новый Структура;
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("Ссылка", Ссылка);
	Запрос.УстановитьПараметр("Период",  			   	   Ссылка.ПериодРегистрации);
	ПоддержкаРаботыСоСтруктурнымиПодразделениями = ПолучитьФункциональнуюОпцию("ПоддержкаРаботыСоСтруктурнымиПодразделениями");
	Запрос.УстановитьПараметр("ПоддержкаРаботыСоСтруктурнымиПодразделениями", ПоддержкаРаботыСоСтруктурнымиПодразделениями);
	
	НомераТаблиц = Новый Структура;
	
	Запрос.Текст = ТекстЗапросаРеквизитыДокумента(НомераТаблиц);
	Результат = Запрос.ВыполнитьПакет();
	ТаблицаРеквизиты = Результат[НомераТаблиц["Реквизиты"]].Выгрузить();
	ПараметрыПроведения.Вставить("Реквизиты", ТаблицаРеквизиты);
	
	Реквизиты = ОбщегоНазначения.СтрокаТаблицыЗначенийВСтруктуру(ТаблицаРеквизиты[0]);
	
	Запрос.УстановитьПараметр("Организация", 			   Реквизиты.ГоловнаяОрганизация);
	Запрос.УстановитьПараметр("ОбособленноеПодразделение", Реквизиты.Организация);
	Запрос.УстановитьПараметр("СтруктурноеПодразделение",  Реквизиты.СтруктурноеПодразделение);
	
	Запрос.УстановитьПараметр("Начало", НачалоМесяца(Реквизиты.ПериодРегистрации));
	Запрос.УстановитьПараметр("Окончание", КонецМесяца(Реквизиты.ПериодРегистрации));
	
	Если ПоддержкаРаботыСоСтруктурнымиПодразделениями Тогда   			
		Налогоплательщик = ПроцедурыНалоговогоУчетаВызовСервераПовтИсп.ПолучитьНалогоплательщикаСтруктурнойЕдиницы(Реквизиты.СтруктурноеПодразделение,
																							Реквизиты.Организация,
																							ПредопределенноеЗначение("Перечисление.РазделыНалоговогоУчета.НалогиСЗаработнойПлаты"));
	Иначе
		Налогоплательщик = Реквизиты.Организация;
	КонецЕсли;
	Запрос.УстановитьПараметр("Налогоплательщик",  Налогоплательщик);
	
	НомераТаблиц = Новый Структура;
	
	Если НЕ Реквизиты.РаспределятьНалогиПоСтруктурнымЕдиницам Тогда
		ПодготовитьТаблицыДокумента(Запрос, Реквизиты);
		Запрос.Текст = ТекстЗапросаИсчисленныйСН(НомераТаблиц, Реквизиты)
						+ ТекстЗапросаИсчисленныеСО(НомераТаблиц, Реквизиты)
						+ ТекстЗапросаИсчисленныйОППВ(НомераТаблиц, Реквизиты)
						+ ТекстЗапросаИсчисленныйОПВР(НомераТаблиц, Реквизиты)
						+ ТекстЗапросаИсчисленныеООСМС(НомераТаблиц, Реквизиты)
						+ ТекстЗапросаСНСведенияОДоходах(НомераТаблиц, Реквизиты)
						+ ТекстЗапросаСОСведенияОДоходах(НомераТаблиц, Реквизиты)
						+ ТекстЗапросаОППВСведенияОДоходах(НомераТаблиц, Реквизиты)
						+ ТекстЗапросаОПВРСведенияОДоходах(НомераТаблиц, Реквизиты)
						+ ТекстЗапросаООСМССведенияОДоходах(НомераТаблиц, Реквизиты);
	Иначе
		Запрос.Текст = РаспределитьРезультатыПоСтруктурнымЕдиницам(НомераТаблиц, Реквизиты, Запрос);
	КонецЕсли;
				
	Если НЕ ПустаяСтрока(Запрос.Текст) Тогда 
		Результат = Запрос.ВыполнитьПакет();
		Для Каждого НомерТаблицы Из НомераТаблиц Цикл
			ПараметрыПроведения.Вставить(НомерТаблицы.Ключ, Результат[НомерТаблицы.Значение].Выгрузить());
		КонецЦикла;
	КонецЕсли;
			
	Возврат ПараметрыПроведения;

КонецФункции

Функция ТекстЗапросаРеквизитыДокумента(НомераТаблиц) 
	
	НомераТаблиц.Вставить("ВременнаяТаблица_ДанныеДокумента", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ВременнаяТаблица_Реквизиты", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("Реквизиты", НомераТаблиц.Количество());
	
	ТекстЗапроса = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	Реквизиты.Дата,
		|	Реквизиты.Организация,
		|	Реквизиты.СтруктурноеПодразделение,
		|	Реквизиты.ПериодРегистрации,
		|	Реквизиты.Ссылка,
		|	Реквизиты.ПодразделениеОрганизации,
		|	Реквизиты.ПодразделениеОрганизации.ЯвляетсяСтруктурнымПодразделением
		|ПОМЕСТИТЬ ВТ_ДанныеДокумента
		|ИЗ
		|	Документ.РасчетСНиСО КАК Реквизиты
		|ГДЕ
		|	Реквизиты.Ссылка = &Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДанныеДокумента.Дата,
		|	ДанныеДокумента.Организация,
		|	ДанныеДокумента.СтруктурноеПодразделение,
		|	ДанныеДокумента.ПериодРегистрации,
		|	ДанныеДокумента.Ссылка,
		|	ДанныеДокумента.ПодразделениеОрганизации,
		|	ДанныеДокумента.ПодразделениеОрганизацииЯвляетсяСтруктурнымПодразделением,
		|	ВЫБОР
		|		КОГДА ЕСТЬNULL(УчетнаяПолитикаПоПерсоналуОрганизаций.ВестиУчетПоГоловнойОрганизации, ИСТИНА)
		|			ТОГДА ВЫБОР
		|					КОГДА ДанныеДокумента.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|						ТОГДА ДанныеДокумента.Организация
		|					ИНАЧЕ ДанныеДокумента.Организация.ГоловнаяОрганизация
		|				КОНЕЦ
		|		ИНАЧЕ ДанныеДокумента.Организация
		|	КОНЕЦ КАК ГоловнаяОрганизация,
		|	ЕСТЬNULL(УчетнаяПолитикаНУ.ОтражениеПоПериодуРегистрации, ЛОЖЬ) КАК ОтражениеПоПериодуРегистрации,
		|	ЕСТЬNULL(УчетнаяПолитикаНУ.РаспределятьНалогиПоСтруктурнымЕдиницам, ЛОЖЬ) КАК РаспределятьНалогиПоСтруктурнымЕдиницам,
		|	ЕСТЬNULL(УчетнаяПолитикаНУ.РаспределятьНалогиПоПодразделениямОрганизаций, ЛОЖЬ) КАК РаспределятьНалогиПоПодразделениямОрганизаций,
		|	ЕСТЬNULL(УчетнаяПолитикаНУ.ОрганизацияЯвляетсяВкладчикомОППВ, ЛОЖЬ) КАК ОрганизацияЯвляетсяВкладчикомОППВ,
		|	ЕСТЬNULL(УчетнаяПолитикаНУ.ОрганизацияЯвляетсяПлательщикомСН, ЛОЖЬ) КАК ОрганизацияЯвляетсяПлательщикомСН,
		|	ЕСТЬNULL(УчетнаяПолитикаНУ.РежимНалогообложения, ЗНАЧЕНИЕ(Перечисление.РежимНалогообложения.ПустаяСсылка)) = ЗНАЧЕНИЕ(Перечисление.РежимНалогообложения.РозничныйНалог) КАК РежимРозничныйНалог,
		|	&ПоддержкаРаботыСоСтруктурнымиПодразделениями КАК ПоддержкаРаботыСоСтруктурнымиПодразделениями
		|ПОМЕСТИТЬ ВТ_Реквизиты
		|ИЗ
		|	ВТ_ДанныеДокумента КАК ДанныеДокумента
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаПоПерсоналуОрганизаций КАК УчетнаяПолитикаПоПерсоналуОрганизаций
		|		ПО ДанныеДокумента.Организация = УчетнаяПолитикаПоПерсоналуОрганизаций.Организация
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаНалоговыйУчет.СрезПоследних(&Период, ) КАК УчетнаяПолитикаНУ
		|		ПО ДанныеДокумента.Организация = УчетнаяПолитикаНУ.Организация
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Реквизиты.Дата,
		|	Реквизиты.Организация,
		|	Реквизиты.СтруктурноеПодразделение,
		|	Реквизиты.ПериодРегистрации,
		|	Реквизиты.Ссылка,
		|	Реквизиты.ПодразделениеОрганизации,
		|	Реквизиты.ПодразделениеОрганизацииЯвляетсяСтруктурнымПодразделением,
		|	Реквизиты.ГоловнаяОрганизация,
		|	Реквизиты.ОтражениеПоПериодуРегистрации,
		|	Реквизиты.РаспределятьНалогиПоСтруктурнымЕдиницам,
		|	Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций,
		|	Реквизиты.ОрганизацияЯвляетсяВкладчикомОППВ,
		|	Реквизиты.ОрганизацияЯвляетсяПлательщикомСН,
		|	Реквизиты.РежимРозничныйНалог,
		|	Реквизиты.ПоддержкаРаботыСоСтруктурнымиПодразделениями
		|ИЗ
		|	ВТ_Реквизиты КАК Реквизиты";
	
	Возврат ТекстЗапроса + ОбщегоНазначенияБКВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

Процедура ПодготовитьТаблицыДокумента(Запрос, Реквизиты)
	
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ИсчисленныйСН.НомерСтроки,
		|	ИсчисленныйСН.ФизЛицо,
		|	ИсчисленныйСН.Налог,
		|	ИсчисленныйСН.МесяцНалоговогоПериода,
		|	ИсчисленныйСН.ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_ИсчисленныйСН
		|ИЗ
		|	Документ.РасчетСНиСО.ИсчисленныйСН КАК ИсчисленныйСН
		|	
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		//|			ПО Реквизиты.ОрганизацияЯвляетсяПлательщикомСН
		|			ПО НЕ Реквизиты.РежимРозничныйНалог
		|
		|ГДЕ
		|	ИсчисленныйСН.Ссылка = &Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ИсчисленныеСО.НомерСтроки,
		|	ИсчисленныеСО.ФизЛицо,
		|	ИсчисленныеСО.Отчисление,
		|	ИсчисленныеСО.МесяцНалоговогоПериода,
		|	ИсчисленныеСО.ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_ИсчисленныеСО
		|ИЗ
		|	Документ.РасчетСНиСО.ИсчисленныеСО КАК ИсчисленныеСО
		|ГДЕ
		|	ИсчисленныеСО.Ссылка = &Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ИсчисленныйОППВ.НомерСтроки,
		|	ИсчисленныйОППВ.ФизЛицо,
		|	ИсчисленныйОППВ.Взнос,
		|	ИсчисленныйОППВ.МесяцНалоговогоПериода,
		|	ИсчисленныйОППВ.ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_ИсчисленныйОППВ
		|ИЗ
		|	Документ.РасчетСНиСО.ИсчисленныйОППВ КАК ИсчисленныйОППВ
		|ГДЕ
		|	ИсчисленныйОППВ.Ссылка = &Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ИсчисленныйОПВР.НомерСтроки,
		|	ИсчисленныйОПВР.ФизЛицо,
		|	ИсчисленныйОПВР.Взнос,
		|	ИсчисленныйОПВР.МесяцНалоговогоПериода,
		|	ИсчисленныйОПВР.ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_ИсчисленныйОПВР
		|ИЗ
		|	Документ.РасчетСНиСО.ИсчисленныйОПВР КАК ИсчисленныйОПВР
		|ГДЕ
		|	ИсчисленныйОПВР.Ссылка = &Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ИсчисленныеООСМС.НомерСтроки,
		|	ИсчисленныеООСМС.ФизЛицо,
		|	ИсчисленныеООСМС.Отчисление,
		|	ИсчисленныеООСМС.МесяцНалоговогоПериода,
		|	ИсчисленныеООСМС.ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_ИсчисленныеООСМС
		|ИЗ
		|	Документ.РасчетСНиСО.ИсчисленныеООСМС КАК ИсчисленныеООСМС
		|ГДЕ
		|	ИсчисленныеООСМС.Ссылка = &Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ 
		|	ИсчисленныйСН.ФизЛицо,
		|	ВЫБОР
		|		КОГДА Реквизиты.ОтражениеПоПериодуРегистрации
		|			ТОГДА &Период
		|		ИНАЧЕ ИсчисленныйСН.МесяцНалоговогоПериода
		|	КОНЕЦ КАК Период
		|ПОМЕСТИТЬ ВТ_ПериодыСотрудников
		|ИЗ 
		|	ВТ_ИсчисленныйСН КАК ИсчисленныйСН
		|	
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ 
		|	ИсчисленныеСО.ФизЛицо,
		|	ВЫБОР 
		|		КОГДА Реквизиты.ОтражениеПоПериодуРегистрации
		|			ТОГДА &Период
		|		ИНАЧЕ ИсчисленныеСО.МесяцНалоговогоПериода
		|	КОНЕЦ КАК Период
		|ИЗ 
		|	ВТ_ИсчисленныеСО КАК ИсчисленныеСО
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ 
		|	ИсчисленныйОППВ.ФизЛицо,
		|	ВЫБОР
		|		КОГДА Реквизиты.ОтражениеПоПериодуРегистрации
		|			ТОГДА &Период
		|		ИНАЧЕ ИсчисленныйОППВ.МесяцНалоговогоПериода
		|	КОНЕЦ КАК Период
		|ИЗ 
		|	ВТ_ИсчисленныйОППВ КАК ИсчисленныйОППВ
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ 
		|	ИсчисленныйОПВР.ФизЛицо,
		|	ВЫБОР
		|		КОГДА Реквизиты.ОтражениеПоПериодуРегистрации
		|			ТОГДА &Период
		|		ИНАЧЕ ИсчисленныйОПВР.МесяцНалоговогоПериода
		|	КОНЕЦ КАК Период
		|ИЗ 
		|	ВТ_ИсчисленныйОПВР КАК ИсчисленныйОПВР
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|";
			
	Запрос.Текст = Запрос.Текст + ОбщегоНазначенияБКВызовСервера.ТекстРазделителяЗапросовПакета()
				 + РасчетЗарплатыСервер.СформироватьТекстЗапросаСтруктурныеЕдиницы("ВТ_ПериодыСотрудников", Истина, Реквизиты.ПоддержкаРаботыСоСтруктурнымиПодразделениями И Не Реквизиты.РаспределятьНалогиПоСтруктурнымЕдиницам);
	Результат = Запрос.Выполнить();
	                                                 
КонецПроцедуры

Функция ТекстЗапросаИсчисленныйСН(НомераТаблиц, Реквизиты) 
	
	НомераТаблиц.Вставить("ИсчисленныйСН", НомераТаблиц.Количество());
	ТекстЗапроса =  
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	&Окончание КАК Период,
		|	ВЫБОР
		|		КОГДА Реквизиты.ОтражениеПоПериодуРегистрации
		|			ТОГДА &Начало
		|		ИНАЧЕ СтрокаИсчисленныйСН.МесяцНалоговогоПериода
		|	КОНЕЦ КАК МесяцНалоговогоПериода,
		|	СтрокаИсчисленныйСН.ФизЛицо,
		|	СтрокаИсчисленныйСН.Налог,
		|	СтрокаИсчисленныйСН.НомерСтроки,
		|	ВЫБОР
		|		КОГДА Реквизиты.ПоддержкаРаботыСоСтруктурнымиПодразделениями
		|			ТОГДА ВЫБОР
		|					КОГДА НЕ(МестоРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|						ТОГДА МестоРаботы.СтруктурнаяЕдиница
		|					КОГДА НЕ (&СтруктурноеПодразделение = ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка))
		|						ТОГДА &СтруктурноеПодразделение
		|					ИНАЧЕ &ОбособленноеПодразделение
		|				КОНЕЦ
		|		ИНАЧЕ &ОбособленноеПодразделение
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|	ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК ПодразделениеОрганизации
		|	
		|ИЗ
		|	ВТ_ИсчисленныйСН КАК СтрокаИсчисленныйСН
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|		ПО ИСТИНА
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестоРаботы
		|		ПО СтрокаИсчисленныйСН.ФизЛицо = МестоРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ СтрокаИсчисленныйСН.МесяцНалоговогоПериода КОНЕЦ) = МестоРаботы.Период
		|
		|ГДЕ
		|	СтрокаИсчисленныйСН.Налог <> 0
		|
		|УПОРЯДОЧИТЬ ПО 
		|	СтрокаИсчисленныйСН.НомерСтроки
		|";

	Возврат ТекстЗапроса + ОбщегоНазначенияБКВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

Функция ТекстЗапросаИсчисленныеСО(НомераТаблиц, Реквизиты) 
	
	НомераТаблиц.Вставить("ИсчисленныеСО", НомераТаблиц.Количество());
	ТекстЗапроса =  
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	&Окончание КАК Период,
		|	ВЫБОР
		|		КОГДА Реквизиты.ОтражениеПоПериодуРегистрации
		|			ТОГДА &Начало
		|		ИНАЧЕ СтрокаИсчисленныеСО.МесяцНалоговогоПериода
		|	КОНЕЦ КАК МесяцНалоговогоПериода,
		|	СтрокаИсчисленныеСО.ФизЛицо,
		|	СтрокаИсчисленныеСО.Отчисление,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог) КАК ВидПлатежа,
		|	ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление) КАК ВидСтроки,
		|	СтрокаИсчисленныеСО.НомерСтроки,
		|	ВЫБОР
		|		КОГДА Реквизиты.ПоддержкаРаботыСоСтруктурнымиПодразделениями
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ(МестоРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|					ТОГДА МестоРаботы.СтруктурнаяЕдиница
		|				КОГДА НЕ (&СтруктурноеПодразделение = ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка))
		|					ТОГДА &СтруктурноеПодразделение
		|				ИНАЧЕ &ОбособленноеПодразделение
		|			КОНЕЦ
		|		ИНАЧЕ &ОбособленноеПодразделение 
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|   ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК ПодразделениеОрганизации
		|	
		|ИЗ
		|	ВТ_ИсчисленныеСО КАК СтрокаИсчисленныеСО
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|		ПО ИСТИНА
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестоРаботы
		|		ПО СтрокаИсчисленныеСО.ФизЛицо = МестоРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ СтрокаИсчисленныеСО.МесяцНалоговогоПериода КОНЕЦ) = МестоРаботы.Период
		|
		|ГДЕ 
		|	СтрокаИсчисленныеСО.Отчисление <> 0
		|
		|УПОРЯДОЧИТЬ ПО 
		|	СтрокаИсчисленныеСО.НомерСтроки
		|";

	Возврат ТекстЗапроса + ОбщегоНазначенияБКВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

Функция ТекстЗапросаИсчисленныйОППВ(НомераТаблиц, Реквизиты) 
	
	НомераТаблиц.Вставить("ИсчисленныйОППВ", НомераТаблиц.Количество());
	ТекстЗапроса =  
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	&Окончание КАК Период,
		|	ВЫБОР
		|		КОГДА Реквизиты.ОтражениеПоПериодуРегистрации
		|			ТОГДА &Начало
		|		ИНАЧЕ СтрокаИсчисленныйОППВ.МесяцНалоговогоПериода
		|	КОНЕЦ КАК МесяцНалоговогоПериода,
		|	СтрокаИсчисленныйОППВ.ФизЛицо,
		|	СтрокаИсчисленныйОППВ.Взнос,
		|	ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление) КАК ВидСтроки,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог) КАК ВидПлатежа,
		|	СтрокаИсчисленныйОППВ.НомерСтроки,
		|	ВЫБОР
		|		КОГДА Реквизиты.ПоддержкаРаботыСоСтруктурнымиПодразделениями
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ(МестоРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|					ТОГДА МестоРаботы.СтруктурнаяЕдиница
		|				КОГДА НЕ (&СтруктурноеПодразделение = ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка))
		|					ТОГДА &СтруктурноеПодразделение
		|				ИНАЧЕ &ОбособленноеПодразделение
		|			КОНЕЦ
		|		ИНАЧЕ &ОбособленноеПодразделение 
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|	ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК ПодразделениеОрганизации
		|	
		|ИЗ
		|	ВТ_ИсчисленныйОППВ КАК СтрокаИсчисленныйОППВ
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|		ПО ИСТИНА
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестоРаботы
		|		ПО СтрокаИсчисленныйОППВ.ФизЛицо = МестоРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ СтрокаИсчисленныйОППВ.МесяцНалоговогоПериода КОНЕЦ) = МестоРаботы.Период
		|
		|ГДЕ
		|	СтрокаИсчисленныйОППВ.Взнос <> 0
		|
		|УПОРЯДОЧИТЬ ПО 
		|	СтрокаИсчисленныйОППВ.НомерСтроки
		|";

	Возврат ТекстЗапроса + ОбщегоНазначенияБКВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

Функция ТекстЗапросаИсчисленныеООСМС(НомераТаблиц, Реквизиты) 
	
	НомераТаблиц.Вставить("ИсчисленныеООСМС", НомераТаблиц.Количество());
	ТекстЗапроса =  
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	&Окончание КАК Период,
		|	ВЫБОР
		|		КОГДА Реквизиты.ОтражениеПоПериодуРегистрации
		|			ТОГДА &Начало
		|		ИНАЧЕ СтрокаИсчисленныеООСМС.МесяцНалоговогоПериода
		|	КОНЕЦ КАК МесяцНалоговогоПериода,
		|	СтрокаИсчисленныеООСМС.ФизЛицо,
		|	СтрокаИсчисленныеООСМС.Отчисление,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог) КАК ВидПлатежа,
		|	ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление) КАК ВидСтроки,
		|	СтрокаИсчисленныеООСМС.НомерСтроки,
		|	ВЫБОР
		|		КОГДА Реквизиты.ПоддержкаРаботыСоСтруктурнымиПодразделениями
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ(МестоРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|					ТОГДА МестоРаботы.СтруктурнаяЕдиница
		|				КОГДА НЕ (&СтруктурноеПодразделение = ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка))
		|					ТОГДА &СтруктурноеПодразделение
		|				ИНАЧЕ &ОбособленноеПодразделение
		|			КОНЕЦ
		|		ИНАЧЕ &ОбособленноеПодразделение 
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|   ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК ПодразделениеОрганизации
		|	
		|ИЗ
		|	ВТ_ИсчисленныеООСМС КАК СтрокаИсчисленныеООСМС
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|		ПО ИСТИНА
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестоРаботы
		|		ПО СтрокаИсчисленныеООСМС.ФизЛицо = МестоРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ СтрокаИсчисленныеООСМС.МесяцНалоговогоПериода КОНЕЦ) = МестоРаботы.Период
		|
		|ГДЕ 
		|	СтрокаИсчисленныеООСМС.Отчисление <> 0
		|
		|УПОРЯДОЧИТЬ ПО 
		|	СтрокаИсчисленныеООСМС.НомерСтроки
		|";

	Возврат ТекстЗапроса + ОбщегоНазначенияБКВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

Функция ТекстЗапросаСНСведенияОДоходах(НомераТаблиц, Реквизиты) 
	
	НомераТаблиц.Вставить("СНСведенияОДоходах", НомераТаблиц.Количество());
	ТекстЗапроса =  
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ВЫБОР
		|		КОГДА Реквизиты.ОтражениеПоПериодуРегистрации
		|			ТОГДА &Период
		|		ИНАЧЕ СтрокаИсчисленныйСН.МесяцНалоговогоПериода
		|	КОНЕЦ КАК Период,
		|	&Начало КАК ПериодРегистрации,
		|	СтрокаИсчисленныйСН.ФизЛицо,
		|	СтрокаИсчисленныйСН.ОблагаемаяБаза,
		|	ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.ОблагаетсяЦеликом) КАК ОблагаетсяЦеликом,
		|	СтрокаИсчисленныйСН.НомерСтроки,
		|	ВЫБОР
		|		КОГДА Реквизиты.ПоддержкаРаботыСоСтруктурнымиПодразделениями
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ(МестоРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|					ТОГДА МестоРаботы.СтруктурнаяЕдиница
		|				КОГДА НЕ (&СтруктурноеПодразделение = ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка))
		|					ТОГДА &СтруктурноеПодразделение
		|				ИНАЧЕ &ОбособленноеПодразделение
		|			КОНЕЦ
		|		ИНАЧЕ &ОбособленноеПодразделение 
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|	ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК ПодразделениеОрганизации
		|	
		|ИЗ
		|	ВТ_ИсчисленныйСН КАК СтрокаИсчисленныйСН
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|		ПО ИСТИНА
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестоРаботы
		|		ПО СтрокаИсчисленныйСН.ФизЛицо = МестоРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ СтрокаИсчисленныйСН.МесяцНалоговогоПериода КОНЕЦ) = МестоРаботы.Период
		|
		|ГДЕ 
		|	СтрокаИсчисленныйСН.ОблагаемаяБаза <> 0
		|
		|УПОРЯДОЧИТЬ ПО 
		|	СтрокаИсчисленныйСН.НомерСтроки
		|";

	Возврат ТекстЗапроса + ОбщегоНазначенияБКВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

Функция ТекстЗапросаСОСведенияОДоходах(НомераТаблиц, Реквизиты) 
	
	НомераТаблиц.Вставить("СОСведенияОДоходах", НомераТаблиц.Количество());
	ТекстЗапроса =  
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ВЫБОР
		|		КОГДА Реквизиты.ОтражениеПоПериодуРегистрации
		|			ТОГДА &Период
		|		ИНАЧЕ СтрокаИсчисленныеСО.МесяцНалоговогоПериода
		|	КОНЕЦ КАК Период,
		|	&Начало КАК ПериодРегистрации,
		|	СтрокаИсчисленныеСО.ФизЛицо,
		|	СтрокаИсчисленныеСО.ОблагаемаяБаза,
		|	ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.ОблагаетсяЦеликом) КАК ОблагаетсяЦеликом,
		|	СтрокаИсчисленныеСО.НомерСтроки,
		|	ВЫБОР
		|		КОГДА Реквизиты.ПоддержкаРаботыСоСтруктурнымиПодразделениями
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ(МестоРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|					ТОГДА МестоРаботы.СтруктурнаяЕдиница
		|				КОГДА НЕ (&СтруктурноеПодразделение = ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка))
		|					ТОГДА &СтруктурноеПодразделение
		|				ИНАЧЕ &ОбособленноеПодразделение
		|			КОНЕЦ
		|		ИНАЧЕ &ОбособленноеПодразделение 
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|	ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК ПодразделениеОрганизации 
		|	
		|ИЗ
		|	ВТ_ИсчисленныеСО КАК СтрокаИсчисленныеСО
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|		ПО ИСТИНА
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестоРаботы
		|		ПО СтрокаИсчисленныеСО.ФизЛицо = МестоРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ СтрокаИсчисленныеСО.МесяцНалоговогоПериода КОНЕЦ) = МестоРаботы.Период
		|
		|ГДЕ 
		|	СтрокаИсчисленныеСО.ОблагаемаяБаза <> 0
		|
		|УПОРЯДОЧИТЬ ПО 
		|	СтрокаИсчисленныеСО.НомерСтроки
		|";

	Возврат ТекстЗапроса + ОбщегоНазначенияБКВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

Функция ТекстЗапросаОППВСведенияОДоходах(НомераТаблиц, Реквизиты) 
	
	НомераТаблиц.Вставить("ОППВСведенияОДоходах", НомераТаблиц.Количество());
	ТекстЗапроса =  
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ВЫБОР
		|		КОГДА Реквизиты.ОтражениеПоПериодуРегистрации
		|			ТОГДА &Период
		|		ИНАЧЕ СтрокаИсчисленныйОППВ.МесяцНалоговогоПериода
		|	КОНЕЦ КАК Период,
		|	&Начало КАК ПериодРегистрации,
		|	СтрокаИсчисленныйОППВ.ФизЛицо,
		|	СтрокаИсчисленныйОППВ.ОблагаемаяБаза,
		|	ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.ОблагаетсяЦеликом) КАК ОблагаетсяЦеликом,
		|	СтрокаИсчисленныйОППВ.НомерСтроки,
		|	ВЫБОР
		|		КОГДА Реквизиты.ПоддержкаРаботыСоСтруктурнымиПодразделениями
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ(МестоРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|					ТОГДА МестоРаботы.СтруктурнаяЕдиница
		|				КОГДА НЕ (&СтруктурноеПодразделение = ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка))
		|					ТОГДА &СтруктурноеПодразделение
		|				ИНАЧЕ &ОбособленноеПодразделение
		|			КОНЕЦ
		|		ИНАЧЕ &ОбособленноеПодразделение 
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|	ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК ПодразделениеОрганизации
		|	
		|ИЗ
		|	ВТ_ИсчисленныйОППВ КАК СтрокаИсчисленныйОППВ
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|		ПО ИСТИНА
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестоРаботы
		|		ПО СтрокаИсчисленныйОППВ.ФизЛицо = МестоРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ СтрокаИсчисленныйОППВ.МесяцНалоговогоПериода КОНЕЦ) = МестоРаботы.Период
		|
		|ГДЕ 
		|	СтрокаИсчисленныйОППВ.ОблагаемаяБаза <> 0
		|
		|УПОРЯДОЧИТЬ ПО 
		|	СтрокаИсчисленныйОППВ.НомерСтроки
		|";

	Возврат ТекстЗапроса + ОбщегоНазначенияБКВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

Функция ТекстЗапросаООСМССведенияОДоходах(НомераТаблиц, Реквизиты) 
	
	НомераТаблиц.Вставить("ООСМССведенияОДоходах", НомераТаблиц.Количество());
	ТекстЗапроса =  
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ВЫБОР
		|		КОГДА Реквизиты.ОтражениеПоПериодуРегистрации
		|			ТОГДА &Период
		|		ИНАЧЕ СтрокаИсчисленныеООСМС.МесяцНалоговогоПериода
		|	КОНЕЦ КАК Период,
		|	&Начало КАК ПериодРегистрации,
		|	СтрокаИсчисленныеООСМС.ФизЛицо,
		|	СтрокаИсчисленныеООСМС.ОблагаемаяБаза,
		|	ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.ОблагаетсяЦеликом) КАК ОблагаетсяЦеликом,
		|	СтрокаИсчисленныеООСМС.НомерСтроки,
		|	ВЫБОР
		|		КОГДА Реквизиты.ПоддержкаРаботыСоСтруктурнымиПодразделениями
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ(МестоРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|					ТОГДА МестоРаботы.СтруктурнаяЕдиница
		|				КОГДА НЕ (&СтруктурноеПодразделение = ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка))
		|					ТОГДА &СтруктурноеПодразделение
		|				ИНАЧЕ &ОбособленноеПодразделение
		|			КОНЕЦ
		|		ИНАЧЕ &ОбособленноеПодразделение 
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|	ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК ПодразделениеОрганизации 
		|	
		|ИЗ
		|	ВТ_ИсчисленныеООСМС КАК СтрокаИсчисленныеООСМС
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|		ПО ИСТИНА
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестоРаботы
		|		ПО СтрокаИсчисленныеООСМС.ФизЛицо = МестоРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ СтрокаИсчисленныеООСМС.МесяцНалоговогоПериода КОНЕЦ) = МестоРаботы.Период
		|
		|ГДЕ 
		|	СтрокаИсчисленныеООСМС.ОблагаемаяБаза <> 0
		|
		|УПОРЯДОЧИТЬ ПО 
		|	СтрокаИсчисленныеООСМС.НомерСтроки
		|";

	Возврат ТекстЗапроса + ОбщегоНазначенияБКВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

// Распределяет результаты расчетов по структурным единицам и подразделениям.
//
Функция РаспределитьРезультатыПоСтруктурнымЕдиницам(НомераТаблиц, Реквизиты, Запрос)
	
	ЗапросРаспределения = Новый Запрос;
	ЗапросРаспределения.МенеджерВременныхТаблиц = Запрос.МенеджерВременныхТаблиц;
	ЗапросРаспределения.УстановитьПараметр("Период",  					Реквизиты.ПериодРегистрации);
	ЗапросРаспределения.УстановитьПараметр("Ссылка", 					Реквизиты.Ссылка);
	ЗапросРаспределения.УстановитьПараметр("Начало", 					НачалоМесяца(Реквизиты.ПериодРегистрации));
	ЗапросРаспределения.УстановитьПараметр("Окончание", 				КонецМесяца(Реквизиты.ПериодРегистрации));
	ЗапросРаспределения.УстановитьПараметр("Организация", 			   	Реквизиты.ГоловнаяОрганизация);
	ЗапросРаспределения.УстановитьПараметр("ОбособленноеПодразделение", Реквизиты.Организация);
	
	ПоддержкаРаботыСоСтруктурнымиПодразделениями = ПолучитьФункциональнуюОпцию("ПоддержкаРаботыСоСтруктурнымиПодразделениями");
	Если ПоддержкаРаботыСоСтруктурнымиПодразделениями Тогда   			
		Налогоплательщик = ПроцедурыНалоговогоУчетаВызовСервераПовтИсп.ПолучитьНалогоплательщикаСтруктурнойЕдиницы(Реквизиты.СтруктурноеПодразделение,
																							Реквизиты.Организация,
																							ПредопределенноеЗначение("Перечисление.РазделыНалоговогоУчета.НалогиСЗаработнойПлаты"));
	Иначе
		Налогоплательщик = Реквизиты.Организация;
	КонецЕсли;
	ЗапросРаспределения.УстановитьПараметр("Налогоплательщик",  Налогоплательщик);
	
	// Табличные части
	ЗапросРаспределения.Текст =
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ИсчисленныйСН.Ссылка,
		|	ИсчисленныйСН.НомерСтроки,
		|	ИсчисленныйСН.ФизЛицо,
		|	ИсчисленныйСН.Налог,
		|	ИсчисленныйСН.МесяцНалоговогоПериода,
		|	ИсчисленныйСН.ОблагаемаяБаза,
		|	ИсчисленныйСН.Ссылка.ПериодРегистрации,
		|	ИсчисленныйСН.Ссылка.Организация,
		|	Реквизиты.ОтражениеПоПериодуРегистрации,
		|	Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|ПОМЕСТИТЬ ВТ_ТабличнаяЧастьСН
		|ИЗ
		|	Документ.РасчетСНиСО.ИсчисленныйСН КАК ИсчисленныйСН
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|ГДЕ
		|	ИсчисленныйСН.Ссылка = &Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ИсчисленныеСО.Ссылка,
		|	ИсчисленныеСО.НомерСтроки,
		|	ИсчисленныеСО.ФизЛицо,
		|	ИсчисленныеСО.Отчисление,
		|	ИсчисленныеСО.МесяцНалоговогоПериода,
		|	ИсчисленныеСО.ОблагаемаяБаза,
		|	ИсчисленныеСО.Ссылка.ПериодРегистрации,
		|	ИсчисленныеСО.Ссылка.Организация,
		|	Реквизиты.ОтражениеПоПериодуРегистрации,
		|	Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|ПОМЕСТИТЬ ВТ_ТабличнаяЧастьСО
		|ИЗ
		|	Документ.РасчетСНиСО.ИсчисленныеСО КАК ИсчисленныеСО
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|ГДЕ
		|	ИсчисленныеСО.Ссылка = &Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ИсчисленныеООСМС.Ссылка,
		|	ИсчисленныеООСМС.НомерСтроки,
		|	ИсчисленныеООСМС.ФизЛицо,
		|	ИсчисленныеООСМС.Отчисление,
		|	ИсчисленныеООСМС.МесяцНалоговогоПериода,
		|	ИсчисленныеООСМС.ОблагаемаяБаза,
		|	ИсчисленныеООСМС.Ссылка.ПериодРегистрации,
		|	ИсчисленныеООСМС.Ссылка.Организация,
		|	Реквизиты.ОтражениеПоПериодуРегистрации,
		|	Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|ПОМЕСТИТЬ ВТ_ТабличнаяЧастьООСМС
		|ИЗ
		|	Документ.РасчетСНиСО.ИсчисленныеООСМС КАК ИсчисленныеООСМС
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|ГДЕ
		|	ИсчисленныеООСМС.Ссылка = &Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ИсчисленныйОППВ.Ссылка,
		|	ИсчисленныйОППВ.НомерСтроки,
		|	ИсчисленныйОППВ.ФизЛицо,
		|	ИсчисленныйОППВ.Взнос,
		|	ИсчисленныйОППВ.МесяцНалоговогоПериода,
		|	ИсчисленныйОППВ.ОблагаемаяБаза,
		|	ИсчисленныйОППВ.Ссылка.ПериодРегистрации,
		|	ИсчисленныйОППВ.Ссылка.Организация,
		|	Реквизиты.ОтражениеПоПериодуРегистрации,
		|	Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|ПОМЕСТИТЬ ВТ_ТабличнаяЧастьОППВ
		|ИЗ
		|	Документ.РасчетСНиСО.ИсчисленныйОППВ КАК ИсчисленныйОППВ
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|ГДЕ
		|	ИсчисленныйОППВ.Ссылка = &Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ИсчисленныйОПВР.Ссылка,
		|	ИсчисленныйОПВР.НомерСтроки,
		|	ИсчисленныйОПВР.ФизЛицо,
		|	ИсчисленныйОПВР.Взнос,
		|	ИсчисленныйОПВР.МесяцНалоговогоПериода,
		|	ИсчисленныйОПВР.ОблагаемаяБаза,
		|	ИсчисленныйОПВР.Ссылка.ПериодРегистрации,
		|	ИсчисленныйОПВР.Ссылка.Организация,
		|	Реквизиты.ОтражениеПоПериодуРегистрации,
		|	Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|ПОМЕСТИТЬ ВТ_ТабличнаяЧастьОПВР
		|ИЗ
		|	Документ.РасчетСНиСО.ИсчисленныйОПВР КАК ИсчисленныйОПВР
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|ГДЕ
		|	ИсчисленныйОПВР.Ссылка = &Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТабличнаяЧастьСН.ФизЛицо
		|ПОМЕСТИТЬ ВТ_СписокФизЛиц
		|ИЗ
		|	ВТ_ТабличнаяЧастьСН КАК ТабличнаяЧастьСН
		|
		|ОБЪЕДИНИТЬ // выбираем только различающиеся строки (без ВСЕ)
		|
		|ВЫБРАТЬ
		|	ТабличнаяЧастьСО.ФизЛицо
		|ИЗ
		|	ВТ_ТабличнаяЧастьСО КАК ТабличнаяЧастьСО
		|
		|ОБЪЕДИНИТЬ 
		|
		|ВЫБРАТЬ
		|	ТабличнаяЧастьООСМС.ФизЛицо
		|ИЗ
		|	ВТ_ТабличнаяЧастьООСМС КАК ТабличнаяЧастьООСМС
		|
		|ОБЪЕДИНИТЬ 
		|
		|ВЫБРАТЬ
		|	ТабличнаяЧастьОПВР.ФизЛицо
		|ИЗ
		|	ВТ_ТабличнаяЧастьОПВР КАК ТабличнаяЧастьОПВР
		|
		|ОБЪЕДИНИТЬ 
		|
		|ВЫБРАТЬ
		|	ТабличнаяЧастьОППВ.ФизЛицо
		|ИЗ
		|	ВТ_ТабличнаяЧастьОППВ КАК ТабличнаяЧастьОППВ";
		
	ЗапросРаспределения.Выполнить();
	
	// Для корректного распределения в случае доначисления учтем все ранее начисленные суммы
	
	ЗапросРаспределения.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	РанееИсчисленныеСО.НомерСтроки,
		|	РанееИсчисленныеСО.ФизЛицо,
		|	РанееИсчисленныеСО.МесяцНалоговогоПериода,
		|	РанееИсчисленныеСО.ПериодРегистрации,
		|	РанееИсчисленныеСО.Организация,
		|	РанееИсчисленныеСО.СтруктурнаяЕдиница,
		|	РанееИсчисленныеСО.ПодразделениеОрганизации,
		|	СУММА(РанееИсчисленныеСО.Отчисление) КАК Отчисление,
		|	СУММА(РанееИсчисленныеСО.ОблагаемаяБаза) КАК ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_РанееИсчисленныеСО
		|ИЗ
		|	(ВЫБРАТЬ
		|		ТабличнаяЧастьСО.НомерСтроки КАК НомерСтроки,
		|		СОРасчетыСФондами.ФизЛицо КАК ФизЛицо,
		|		СОРасчетыСФондами.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|		НАЧАЛОПЕРИОДА(СОРасчетыСФондами.Период, МЕСЯЦ) КАК ПериодРегистрации,
		|		ТабличнаяЧастьСО.Организация КАК Организация,
		|		СОРасчетыСФондами.СтруктурнаяЕдиница КАК СтруктурнаяЕдиница,
		|		ВЫБОР
		|			КОГДА ТабличнаяЧастьСО.РаспределятьНалогиПоПодразделениямОрганизаций
		|				ТОГДА СОРасчетыСФондами.ПодразделениеОрганизации 
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|		КОНЕЦ КАК ПодразделениеОрганизации,
		|		СОРасчетыСФондами.Отчисление КАК Отчисление,
		|		0 КАК ОблагаемаяБаза
		|	ИЗ
		|		РегистрНакопления.СОРасчетыСФондами КАК СОРасчетыСФондами
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ТабличнаяЧастьСО КАК ТабличнаяЧастьСО
		|			ПО СОРасчетыСФондами.ФизЛицо = ТабличнаяЧастьСО.ФизЛицо
		|				И (НАЧАЛОПЕРИОДА(СОРасчетыСФондами.Период, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ТабличнаяЧастьСО.ПериодРегистрации, МЕСЯЦ))
		|				И (НАЧАЛОПЕРИОДА(СОРасчетыСФондами.МесяцНалоговогоПериода, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ВЫБОР КОГДА ТабличнаяЧастьСО.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьСО.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ))
		|				И СОРасчетыСФондами.Налогоплательщик = &Налогоплательщик
		|				И СОРасчетыСФондами.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И СОРасчетыСФондами.ВидПлатежа = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)			
		|				И СОРасчетыСФондами.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)
		|ГДЕ
		|	СОРасчетыСФондами.Активность
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ТабличнаяЧастьСО.НомерСтроки,
		|		СОСведенияОДоходах.ФизЛицо,
		|		СОСведенияОДоходах.Период,
		|		СОСведенияОДоходах.ПериодРегистрации,
		|		ТабличнаяЧастьСО.Организация,
		|		СОСведенияОДоходах.СтруктурнаяЕдиница,
		|		ВЫБОР
		|			КОГДА ТабличнаяЧастьСО.РаспределятьНалогиПоПодразделениямОрганизаций
		|				ТОГДА СОСведенияОДоходах.ПодразделениеОрганизации
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|		КОНЕЦ,
		|		0,
		|		СОСведенияОДоходах.ОблагаемаяБазаОборот
		|	ИЗ
		|		РегистрНакопления.СОСведенияОДоходах.Обороты( , , Месяц,
		|				Налогоплательщик = &Налогоплательщик
		|					И ПериодРегистрации = &Период
		|					И СпособНалогообложения = ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.ОблагаетсяЦеликом)) КАК СОСведенияОДоходах
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ТабличнаяЧастьСО КАК ТабличнаяЧастьСО
		|			ПО СОСведенияОДоходах.ФизЛицо = ТабличнаяЧастьСО.ФизЛицо
		|				И (НАЧАЛОПЕРИОДА(СОСведенияОДоходах.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ТабличнаяЧастьСО.ПериодРегистрации, МЕСЯЦ))
		|				И (НАЧАЛОПЕРИОДА(СОСведенияОДоходах.Период, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ВЫБОР КОГДА ТабличнаяЧастьСО.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьСО.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ))) КАК РанееИсчисленныеСО
		|
		|СГРУППИРОВАТЬ ПО
		|	РанееИсчисленныеСО.НомерСтроки,
		|	РанееИсчисленныеСО.ФизЛицо,
		|	РанееИсчисленныеСО.МесяцНалоговогоПериода,
		|	РанееИсчисленныеСО.ПериодРегистрации,
		|	РанееИсчисленныеСО.Организация,
		|	РанееИсчисленныеСО.СтруктурнаяЕдиница,
		|	РанееИсчисленныеСО.ПодразделениеОрганизации
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	РанееИсчисленныйСН.НомерСтроки,
		|	РанееИсчисленныйСН.ФизЛицо,
		|	РанееИсчисленныйСН.МесяцНалоговогоПериода,
		|	РанееИсчисленныйСН.ПериодРегистрации,
		|	РанееИсчисленныйСН.Организация,
		|	РанееИсчисленныйСН.СтруктурнаяЕдиница,
		|	РанееИсчисленныйСН.ПодразделениеОрганизации,
		|	СУММА(РанееИсчисленныйСН.Налог) КАК Налог,
		|	СУММА(РанееИсчисленныйСН.ОблагаемаяБаза) КАК ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_РанееИсчисленныйСН
		|ИЗ
		|	(ВЫБРАТЬ
		|		ТабличнаяЧастьСН.НомерСтроки КАК НомерСтроки,
		|		СНИсчисленный.ФизЛицо КАК ФизЛицо,
		|		СНИсчисленный.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|		СНИсчисленный.Период КАК ПериодРегистрации,
		|		ТабличнаяЧастьСН.Организация КАК Организация,
		|		СНИсчисленный.СтруктурнаяЕдиница КАК СтруктурнаяЕдиница,
		|		ВЫБОР
		|			КОГДА ТабличнаяЧастьСН.РаспределятьНалогиПоПодразделениямОрганизаций
		|				ТОГДА СНИсчисленный.ПодразделениеОрганизации 
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|		КОНЕЦ КАК ПодразделениеОрганизации,
		|		СНИсчисленный.НалогОборот КАК Налог,
		|		0 КАК ОблагаемаяБаза
		|	ИЗ
		|		РегистрНакопления.СНИсчисленный.Обороты(&Начало, &Окончание, Месяц, Налогоплательщик = &Налогоплательщик) КАК СНИсчисленный
		|
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ТабличнаяЧастьСН КАК ТабличнаяЧастьСН
		|			ПО СНИсчисленный.ФизЛицо = ТабличнаяЧастьСН.ФизЛицо
		|				И (НАЧАЛОПЕРИОДА(СНИсчисленный.Период, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ТабличнаяЧастьСН.ПериодРегистрации, МЕСЯЦ))
		|				И (НАЧАЛОПЕРИОДА(СНИсчисленный.МесяцНалоговогоПериода, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ВЫБОР КОГДА ТабличнаяЧастьСН.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьСН.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ))
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ТабличнаяЧастьСН.НомерСтроки,
		|		СНСведенияОДоходах.ФизЛицо,
		|		СНСведенияОДоходах.Период,
		|		СНСведенияОДоходах.ПериодРегистрации,
		|		ТабличнаяЧастьСН.Организация,
		|		СНСведенияОДоходах.СтруктурнаяЕдиница,
		|		ВЫБОР
		|			КОГДА ТабличнаяЧастьСН.РаспределятьНалогиПоПодразделениямОрганизаций
		|				ТОГДА СНСведенияОДоходах.ПодразделениеОрганизации
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|		КОНЕЦ,
		|		0,
		|		СНСведенияОДоходах.ОблагаемаяБазаОборот
		|	ИЗ
		|		РегистрНакопления.СНСведенияОДоходах.Обороты( , , Месяц,
		|				Налогоплательщик = &Налогоплательщик
		|					И ПериодРегистрации = &Период
		|					И СпособНалогообложения = ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.ОблагаетсяЦеликом)) КАК СНСведенияОДоходах
		|
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ТабличнаяЧастьСН КАК ТабличнаяЧастьСН
		|			ПО СНСведенияОДоходах.ФизЛицо = ТабличнаяЧастьСН.ФизЛицо
		|				И (НАЧАЛОПЕРИОДА(СНСведенияОДоходах.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ТабличнаяЧастьСН.ПериодРегистрации, МЕСЯЦ))
		|				И (НАЧАЛОПЕРИОДА(СНСведенияОДоходах.Период, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ВЫБОР КОГДА ТабличнаяЧастьСН.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьСН.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ))) КАК РанееИсчисленныйСН
		|
		|СГРУППИРОВАТЬ ПО
		|	РанееИсчисленныйСН.НомерСтроки,
		|	РанееИсчисленныйСН.ФизЛицо,
		|	РанееИсчисленныйСН.МесяцНалоговогоПериода,
		|	РанееИсчисленныйСН.ПериодРегистрации,
		|	РанееИсчисленныйСН.Организация,
		|	РанееИсчисленныйСН.СтруктурнаяЕдиница,
		|	РанееИсчисленныйСН.ПодразделениеОрганизации
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	РанееИсчисленныйОППВ.НомерСтроки,
		|	РанееИсчисленныйОППВ.ФизЛицо,
		|	РанееИсчисленныйОППВ.МесяцНалоговогоПериода,
		|	РанееИсчисленныйОППВ.ПериодРегистрации,
		|	РанееИсчисленныйОППВ.Организация,
		|	РанееИсчисленныйОППВ.СтруктурнаяЕдиница,
		|	РанееИсчисленныйОППВ.ПодразделениеОрганизации,
		|	СУММА(РанееИсчисленныйОППВ.Взнос) КАК Взнос,
		|	СУММА(РанееИсчисленныйОППВ.ОблагаемаяБаза) КАК ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_РанееИсчисленныйОППВ
		|ИЗ
		|	(ВЫБРАТЬ
		|		ТабличнаяЧастьОППВ.НомерСтроки КАК НомерСтроки,
		|		ОППВРасчетыСФондами.ФизЛицо КАК ФизЛицо,
		|		ОППВРасчетыСФондами.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|		НАЧАЛОПЕРИОДА(ОППВРасчетыСФондами.Период, МЕСЯЦ) КАК ПериодРегистрации,
		|		ТабличнаяЧастьОППВ.Организация КАК Организация,
		|		ОППВРасчетыСФондами.СтруктурнаяЕдиница КАК СтруктурнаяЕдиница,
		|		ВЫБОР
		|			КОГДА ТабличнаяЧастьОППВ.РаспределятьНалогиПоПодразделениямОрганизаций
		|				ТОГДА ОППВРасчетыСФондами.ПодразделениеОрганизации 
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|		КОНЕЦ КАК ПодразделениеОрганизации,
		|		ОППВРасчетыСФондами.Взнос КАК Взнос,
		|		0 КАК ОблагаемаяБаза
		|	ИЗ
		|		РегистрНакопления.ОППВРасчетыСФондами КАК ОППВРасчетыСФондами
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ТабличнаяЧастьОППВ КАК ТабличнаяЧастьОППВ
		|			ПО ОППВРасчетыСФондами.ФизЛицо = ТабличнаяЧастьОППВ.ФизЛицо
		|				И (НАЧАЛОПЕРИОДА(ОППВРасчетыСФондами.Период, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ТабличнаяЧастьОППВ.ПериодРегистрации, МЕСЯЦ))
		|				И (НАЧАЛОПЕРИОДА(ОППВРасчетыСФондами.МесяцНалоговогоПериода, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ВЫБОР КОГДА ТабличнаяЧастьОППВ.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьОППВ.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ))
		|				И ОППВРасчетыСФондами.Налогоплательщик = &Налогоплательщик
		|				И ОППВРасчетыСФондами.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И ОППВРасчетыСФондами.ВидПлатежа = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
		|				И ОППВРасчетыСФондами.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)
		|ГДЕ
		|	ОППВРасчетыСФондами.Активность
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ТабличнаяЧастьОППВ.НомерСтроки,
		|		ОППВСведенияОДоходах.ФизЛицо,
		|		ОППВСведенияОДоходах.Период,
		|		ОППВСведенияОДоходах.ПериодРегистрации,
		|		ТабличнаяЧастьОППВ.Организация,
		|		ОППВСведенияОДоходах.СтруктурнаяЕдиница,
		|		ВЫБОР
		|			КОГДА ТабличнаяЧастьОППВ.РаспределятьНалогиПоПодразделениямОрганизаций
		|				ТОГДА ОППВСведенияОДоходах.ПодразделениеОрганизации
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|		КОНЕЦ, 
		|		0,
		|		ОППВСведенияОДоходах.ОблагаемаяБазаОборот
		|	ИЗ
		|		РегистрНакопления.ОППВСведенияОДоходах.Обороты( , , Месяц,
		|				Налогоплательщик = &Налогоплательщик
		|					И ПериодРегистрации = &Период
		|					И СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)) КАК ОППВСведенияОДоходах
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ТабличнаяЧастьОППВ КАК ТабличнаяЧастьОППВ
		|			ПО ОППВСведенияОДоходах.ФизЛицо = ТабличнаяЧастьОППВ.ФизЛицо
		|				И (НАЧАЛОПЕРИОДА(ОППВСведенияОДоходах.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ТабличнаяЧастьОППВ.ПериодРегистрации, МЕСЯЦ))
		|				И (НАЧАЛОПЕРИОДА(ОППВСведенияОДоходах.Период, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ВЫБОР КОГДА ТабличнаяЧастьОППВ.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьОППВ.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ))) КАК РанееИсчисленныйОППВ
		|
		|СГРУППИРОВАТЬ ПО
		|	РанееИсчисленныйОППВ.НомерСтроки,
		|	РанееИсчисленныйОППВ.ФизЛицо,
		|	РанееИсчисленныйОППВ.МесяцНалоговогоПериода,
		|	РанееИсчисленныйОППВ.ПериодРегистрации,
		|	РанееИсчисленныйОППВ.Организация,
		|	РанееИсчисленныйОППВ.СтруктурнаяЕдиница,
		|	РанееИсчисленныйОППВ.ПодразделениеОрганизации
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	РанееИсчисленныйОПВР.НомерСтроки,
		|	РанееИсчисленныйОПВР.ФизЛицо,
		|	РанееИсчисленныйОПВР.МесяцНалоговогоПериода,
		|	РанееИсчисленныйОПВР.ПериодРегистрации,
		|	РанееИсчисленныйОПВР.Организация,
		|	РанееИсчисленныйОПВР.СтруктурнаяЕдиница,
		|	РанееИсчисленныйОПВР.ПодразделениеОрганизации,
		|	СУММА(РанееИсчисленныйОПВР.Взнос) КАК Взнос,
		|	СУММА(РанееИсчисленныйОПВР.ОблагаемаяБаза) КАК ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_РанееИсчисленныйОПВР
		|ИЗ
		|	(ВЫБРАТЬ
		|		ТабличнаяЧастьОПВР.НомерСтроки КАК НомерСтроки,
		|		ОПВРРасчетыСФондами.ФизЛицо КАК ФизЛицо,
		|		ОПВРРасчетыСФондами.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|		НАЧАЛОПЕРИОДА(ОПВРРасчетыСФондами.Период, МЕСЯЦ) КАК ПериодРегистрации,
		|		ТабличнаяЧастьОПВР.Организация КАК Организация,
		|		ОПВРРасчетыСФондами.СтруктурнаяЕдиница КАК СтруктурнаяЕдиница,
		|		ВЫБОР
		|			КОГДА ТабличнаяЧастьОПВР.РаспределятьНалогиПоПодразделениямОрганизаций
		|				ТОГДА ОПВРРасчетыСФондами.ПодразделениеОрганизации 
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|		КОНЕЦ КАК ПодразделениеОрганизации,
		|		ТабличнаяЧастьОПВР.Взнос КАК Взнос,
		|		0 КАК ОблагаемаяБаза
		|	ИЗ
		|		РегистрНакопления.ОПВРРасчетыСФондами КАК ОПВРРасчетыСФондами
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ТабличнаяЧастьОПВР КАК ТабличнаяЧастьОПВР
		|			ПО ОПВРРасчетыСФондами.ФизЛицо = ТабличнаяЧастьОПВР.ФизЛицо
		|				И (НАЧАЛОПЕРИОДА(ОПВРРасчетыСФондами.Период, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ТабличнаяЧастьОПВР.ПериодРегистрации, МЕСЯЦ))
		|				И (НАЧАЛОПЕРИОДА(ОПВРРасчетыСФондами.МесяцНалоговогоПериода, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ВЫБОР КОГДА ТабличнаяЧастьОПВР.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьОПВР.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ))
		|				И ОПВРРасчетыСФондами.Налогоплательщик = &Налогоплательщик
		|				И ОПВРРасчетыСФондами.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И ОПВРРасчетыСФондами.ВидПлатежа = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
		|				И ОПВРРасчетыСФондами.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)
		|ГДЕ
		|	ОПВРРасчетыСФондами.Активность
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ТабличнаяЧастьОПВР.НомерСтроки,
		|		ОПВРСведенияОДоходах.ФизЛицо,
		|		ОПВРСведенияОДоходах.Период,
		|		ОПВРСведенияОДоходах.ПериодРегистрации,
		|		ТабличнаяЧастьОПВР.Организация,
		|		ОПВРСведенияОДоходах.СтруктурнаяЕдиница,
		|		ВЫБОР
		|			КОГДА ТабличнаяЧастьОПВР.РаспределятьНалогиПоПодразделениямОрганизаций
		|				ТОГДА ОПВРСведенияОДоходах.ПодразделениеОрганизации
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|		КОНЕЦ, 
		|		0,
		|		ОПВРСведенияОДоходах.ОблагаемаяБазаОборот
		|	ИЗ
		|		РегистрНакопления.ОПВРСведенияОДоходах.Обороты( , , Месяц,
		|				Налогоплательщик = &Налогоплательщик
		|					И ПериодРегистрации = &Период
		|					И СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)) КАК ОПВРСведенияОДоходах
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ТабличнаяЧастьОПВР КАК ТабличнаяЧастьОПВР
		|			ПО ОПВРСведенияОДоходах.ФизЛицо = ТабличнаяЧастьОПВР.ФизЛицо
		|				И (НАЧАЛОПЕРИОДА(ОПВРСведенияОДоходах.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ТабличнаяЧастьОПВР.ПериодРегистрации, МЕСЯЦ))
		|				И (НАЧАЛОПЕРИОДА(ОПВРСведенияОДоходах.Период, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ВЫБОР КОГДА ТабличнаяЧастьОПВР.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьОПВР.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ))) КАК РанееИсчисленныйОПВР
		|
		|СГРУППИРОВАТЬ ПО
		|	РанееИсчисленныйОПВР.НомерСтроки,
		|	РанееИсчисленныйОПВР.ФизЛицо,
		|	РанееИсчисленныйОПВР.МесяцНалоговогоПериода,
		|	РанееИсчисленныйОПВР.ПериодРегистрации,
		|	РанееИсчисленныйОПВР.Организация,
		|	РанееИсчисленныйОПВР.СтруктурнаяЕдиница,
		|	РанееИсчисленныйОПВР.ПодразделениеОрганизации
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	РанееИсчисленныеООСМС.НомерСтроки,
		|	РанееИсчисленныеООСМС.ФизЛицо,
		|	РанееИсчисленныеООСМС.МесяцНалоговогоПериода,
		|	РанееИсчисленныеООСМС.ПериодРегистрации,
		|	РанееИсчисленныеООСМС.Организация,
		|	РанееИсчисленныеООСМС.СтруктурнаяЕдиница,
		|	РанееИсчисленныеООСМС.ПодразделениеОрганизации,
		|	СУММА(РанееИсчисленныеООСМС.Отчисление) КАК Отчисление,
		|	СУММА(РанееИсчисленныеООСМС.ОблагаемаяБаза) КАК ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_РанееИсчисленныеООСМС
		|ИЗ
		|	(ВЫБРАТЬ
		|		ТабличнаяЧастьООСМС.НомерСтроки КАК НомерСтроки,
		|		ООСМСРасчетыСФондами.ФизЛицо КАК ФизЛицо,
		|		ООСМСРасчетыСФондами.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|		НАЧАЛОПЕРИОДА(ООСМСРасчетыСФондами.Период, МЕСЯЦ) КАК ПериодРегистрации,
		|		ТабличнаяЧастьООСМС.Организация КАК Организация,
		|		ООСМСРасчетыСФондами.СтруктурнаяЕдиница КАК СтруктурнаяЕдиница,
		|		ВЫБОР
		|			КОГДА ТабличнаяЧастьООСМС.РаспределятьНалогиПоПодразделениямОрганизаций
		|				ТОГДА ООСМСРасчетыСФондами.ПодразделениеОрганизации 
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|		КОНЕЦ КАК ПодразделениеОрганизации,
		|		ООСМСРасчетыСФондами.Отчисление КАК Отчисление,
		|		0 КАК ОблагаемаяБаза
		|	ИЗ
		|		РегистрНакопления.ООСМСРасчетыСФондами КАК ООСМСРасчетыСФондами
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ТабличнаяЧастьООСМС КАК ТабличнаяЧастьООСМС
		|			ПО ООСМСРасчетыСФондами.ФизЛицо = ТабличнаяЧастьООСМС.ФизЛицо
		|				И (НАЧАЛОПЕРИОДА(ООСМСРасчетыСФондами.Период, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ТабличнаяЧастьООСМС.ПериодРегистрации, МЕСЯЦ))
		|				И (НАЧАЛОПЕРИОДА(ООСМСРасчетыСФондами.МесяцНалоговогоПериода, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ВЫБОР КОГДА ТабличнаяЧастьООСМС.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьООСМС.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ))
		|				И ООСМСРасчетыСФондами.Налогоплательщик = &Налогоплательщик
		|				И ООСМСРасчетыСФондами.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|				И ООСМСРасчетыСФондами.ВидПлатежа = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)			
		|				И ООСМСРасчетыСФондами.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)
		|ГДЕ
		|	ООСМСРасчетыСФондами.Активность
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ТабличнаяЧастьООСМС.НомерСтроки,
		|		ООСМССведенияОДоходах.ФизЛицо,
		|		ООСМССведенияОДоходах.Период,
		|		ООСМССведенияОДоходах.ПериодРегистрации,
		|		ТабличнаяЧастьООСМС.Организация,
		|		ООСМССведенияОДоходах.СтруктурнаяЕдиница,
		|		ВЫБОР
		|			КОГДА ТабличнаяЧастьООСМС.РаспределятьНалогиПоПодразделениямОрганизаций
		|				ТОГДА ООСМССведенияОДоходах.ПодразделениеОрганизации
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|		КОНЕЦ,
		|		0,
		|		ООСМССведенияОДоходах.ОблагаемаяБазаОборот
		|	ИЗ
		|		РегистрНакопления.ООСМССведенияОДоходах.Обороты( , , Месяц,
		|				Налогоплательщик = &Налогоплательщик
		|					И ПериодРегистрации = &Период
		|					И СпособНалогообложения = ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.ОблагаетсяЦеликом)) КАК ООСМССведенияОДоходах
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ТабличнаяЧастьООСМС КАК ТабличнаяЧастьООСМС
		|			ПО ООСМССведенияОДоходах.ФизЛицо = ТабличнаяЧастьООСМС.ФизЛицо
		|				И (НАЧАЛОПЕРИОДА(ООСМССведенияОДоходах.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ТабличнаяЧастьООСМС.ПериодРегистрации, МЕСЯЦ))
		|				И (НАЧАЛОПЕРИОДА(ООСМССведенияОДоходах.Период, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ВЫБОР КОГДА ТабличнаяЧастьООСМС.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьООСМС.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ))) КАК РанееИсчисленныеООСМС
		|
		|СГРУППИРОВАТЬ ПО
		|	РанееИсчисленныеООСМС.НомерСтроки,
		|	РанееИсчисленныеООСМС.ФизЛицо,
		|	РанееИсчисленныеООСМС.МесяцНалоговогоПериода,
		|	РанееИсчисленныеООСМС.ПериодРегистрации,
		|	РанееИсчисленныеООСМС.Организация,
		|	РанееИсчисленныеООСМС.СтруктурнаяЕдиница,
		|	РанееИсчисленныеООСМС.ПодразделениеОрганизации
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ИсчисленныеСО.НомерСтроки,
		|	ИсчисленныеСО.ФизЛицо,
		|	ИсчисленныеСО.МесяцНалоговогоПериода,
		|	ИсчисленныеСО.ПериодРегистрации,
		|	ИсчисленныеСО.Организация,
		|	СУММА(ИсчисленныеСО.Отчисление) КАК Отчисление,
		|	СУММА(ИсчисленныеСО.ОблагаемаяБаза) КАК ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_ИсчисленныеСО
		|ИЗ
		|	(ВЫБРАТЬ
		|		РанееИсчисленныеСО.НомерСтроки КАК НомерСтроки,
		|		РанееИсчисленныеСО.ФизЛицо КАК ФизЛицо,
		|		РанееИсчисленныеСО.Отчисление КАК Отчисление,
		|		РанееИсчисленныеСО.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|		РанееИсчисленныеСО.ОблагаемаяБаза КАК ОблагаемаяБаза,
		|		РанееИсчисленныеСО.ПериодРегистрации КАК ПериодРегистрации,
		|		РанееИсчисленныеСО.Организация КАК Организация
		|	ИЗ
		|		ВТ_РанееИсчисленныеСО КАК РанееИсчисленныеСО
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ТабличнаяЧастьСО.НомерСтроки,
		|		ТабличнаяЧастьСО.ФизЛицо,
		|		ТабличнаяЧастьСО.Отчисление,
		|		ТабличнаяЧастьСО.МесяцНалоговогоПериода,
		|		ТабличнаяЧастьСО.ОблагаемаяБаза,
		|		ТабличнаяЧастьСО.ПериодРегистрации,
		|		ТабличнаяЧастьСО.Организация
		|	ИЗ
		|		ВТ_ТабличнаяЧастьСО КАК ТабличнаяЧастьСО) КАК ИсчисленныеСО
		|
		|СГРУППИРОВАТЬ ПО
		|	ИсчисленныеСО.НомерСтроки,
		|	ИсчисленныеСО.ФизЛицо,
		|	ИсчисленныеСО.МесяцНалоговогоПериода,
		|	ИсчисленныеСО.ПериодРегистрации,
		|	ИсчисленныеСО.Организация
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ИсчисленныеСН.НомерСтроки,
		|	ИсчисленныеСН.ФизЛицо,
		|	ИсчисленныеСН.МесяцНалоговогоПериода,
		|	ИсчисленныеСН.ПериодРегистрации,
		|	ИсчисленныеСН.Организация,
		|	СУММА(ИсчисленныеСН.Налог) КАК Налог,
		|	СУММА(ИсчисленныеСН.ОблагаемаяБаза) КАК ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_ИсчисленныеСН
		|ИЗ
		|	(ВЫБРАТЬ
		|		РанееИсчисленныйСН.НомерСтроки КАК НомерСтроки,
		|		РанееИсчисленныйСН.ФизЛицо КАК ФизЛицо,
		|		РанееИсчисленныйСН.Налог КАК Налог,
		|		РанееИсчисленныйСН.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|		РанееИсчисленныйСН.ОблагаемаяБаза КАК ОблагаемаяБаза,
		|		РанееИсчисленныйСН.ПериодРегистрации КАК ПериодРегистрации,
		|		РанееИсчисленныйСН.Организация КАК Организация
		|	ИЗ
		|		ВТ_РанееИсчисленныйСН КАК РанееИсчисленныйСН
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ТабличнаяЧастьСН.НомерСтроки,
		|		ТабличнаяЧастьСН.ФизЛицо,
		|		ТабличнаяЧастьСН.Налог,
		|		ТабличнаяЧастьСН.МесяцНалоговогоПериода,
		|		ТабличнаяЧастьСН.ОблагаемаяБаза,
		|		ТабличнаяЧастьСН.ПериодРегистрации,
		|		ТабличнаяЧастьСН.Организация
		|	ИЗ
		|		ВТ_ТабличнаяЧастьСН КАК ТабличнаяЧастьСН) КАК ИсчисленныеСН
		|
		|СГРУППИРОВАТЬ ПО
		|	ИсчисленныеСН.НомерСтроки,
		|	ИсчисленныеСН.ФизЛицо,
		|	ИсчисленныеСН.МесяцНалоговогоПериода,
		|	ИсчисленныеСН.ПериодРегистрации,
		|	ИсчисленныеСН.Организация
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ИсчисленныйОППВ.НомерСтроки,
		|	ИсчисленныйОППВ.ФизЛицо,
		|	ИсчисленныйОППВ.МесяцНалоговогоПериода,
		|	ИсчисленныйОППВ.ПериодРегистрации,
		|	ИсчисленныйОППВ.Организация,
		|	СУММА(ИсчисленныйОППВ.Взнос) КАК Взнос,
		|	СУММА(ИсчисленныйОППВ.ОблагаемаяБаза) КАК ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_ИсчисленныйОППВ
		|ИЗ
		|	(ВЫБРАТЬ
		|		РанееИсчисленныйОППВ.НомерСтроки КАК НомерСтроки,
		|		РанееИсчисленныйОППВ.ФизЛицо КАК ФизЛицо,
		|		РанееИсчисленныйОППВ.Взнос КАК Взнос,
		|		РанееИсчисленныйОППВ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|		РанееИсчисленныйОППВ.ОблагаемаяБаза КАК ОблагаемаяБаза,
		|		РанееИсчисленныйОППВ.ПериодРегистрации КАК ПериодРегистрации,
		|		РанееИсчисленныйОППВ.Организация КАК Организация
		|	ИЗ
		|		ВТ_РанееИсчисленныйОППВ КАК РанееИсчисленныйОППВ
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ТабличнаяЧастьОППВ.НомерСтроки,
		|		ТабличнаяЧастьОППВ.ФизЛицо,
		|		ТабличнаяЧастьОППВ.Взнос,
		|		ТабличнаяЧастьОППВ.МесяцНалоговогоПериода,
		|		ТабличнаяЧастьОППВ.ОблагаемаяБаза,
		|		ТабличнаяЧастьОППВ.ПериодРегистрации,
		|		ТабличнаяЧастьОППВ.Организация
		|	ИЗ
		|		ВТ_ТабличнаяЧастьОППВ КАК ТабличнаяЧастьОППВ) КАК ИсчисленныйОППВ
		|
		|СГРУППИРОВАТЬ ПО
		|	ИсчисленныйОППВ.НомерСтроки,
		|	ИсчисленныйОППВ.ФизЛицо,
		|	ИсчисленныйОППВ.МесяцНалоговогоПериода,
		|	ИсчисленныйОППВ.ПериодРегистрации,
		|	ИсчисленныйОППВ.Организация
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ИсчисленныйОПВР.НомерСтроки,
		|	ИсчисленныйОПВР.ФизЛицо,
		|	ИсчисленныйОПВР.МесяцНалоговогоПериода,
		|	ИсчисленныйОПВР.ПериодРегистрации,
		|	ИсчисленныйОПВР.Организация,
		|	СУММА(ИсчисленныйОПВР.Взнос) КАК Взнос,
		|	СУММА(ИсчисленныйОПВР.ОблагаемаяБаза) КАК ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_ИсчисленныйОПВР
		|ИЗ
		|	(ВЫБРАТЬ
		|		РанееИсчисленныйОПВР.НомерСтроки КАК НомерСтроки,
		|		РанееИсчисленныйОПВР.ФизЛицо КАК ФизЛицо,
		|		РанееИсчисленныйОПВР.Взнос КАК Взнос,
		|		РанееИсчисленныйОПВР.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|		РанееИсчисленныйОПВР.ОблагаемаяБаза КАК ОблагаемаяБаза,
		|		РанееИсчисленныйОПВР.ПериодРегистрации КАК ПериодРегистрации,
		|		РанееИсчисленныйОПВР.Организация КАК Организация
		|	ИЗ
		|		ВТ_РанееИсчисленныйОПВР КАК РанееИсчисленныйОПВР
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ТабличнаяЧастьОПВР.НомерСтроки,
		|		ТабличнаяЧастьОПВР.ФизЛицо,
		|		ТабличнаяЧастьОПВР.Взнос,
		|		ТабличнаяЧастьОПВР.МесяцНалоговогоПериода,
		|		ТабличнаяЧастьОПВР.ОблагаемаяБаза,
		|		ТабличнаяЧастьОПВР.ПериодРегистрации,
		|		ТабличнаяЧастьОПВР.Организация
		|	ИЗ
		|		ВТ_ТабличнаяЧастьОПВР КАК ТабличнаяЧастьОПВР) КАК ИсчисленныйОПВР
		|
		|СГРУППИРОВАТЬ ПО
		|	ИсчисленныйОПВР.НомерСтроки,
		|	ИсчисленныйОПВР.ФизЛицо,
		|	ИсчисленныйОПВР.МесяцНалоговогоПериода,
		|	ИсчисленныйОПВР.ПериодРегистрации,
		|	ИсчисленныйОПВР.Организация
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ИсчисленныеООСМС.НомерСтроки,
		|	ИсчисленныеООСМС.ФизЛицо,
		|	ИсчисленныеООСМС.МесяцНалоговогоПериода,
		|	ИсчисленныеООСМС.ПериодРегистрации,
		|	ИсчисленныеООСМС.Организация,
		|	СУММА(ИсчисленныеООСМС.Отчисление) КАК Отчисление,
		|	СУММА(ИсчисленныеООСМС.ОблагаемаяБаза) КАК ОблагаемаяБаза
		|ПОМЕСТИТЬ ВТ_ИсчисленныеООСМС
		|ИЗ
		|	(ВЫБРАТЬ
		|		РанееИсчисленныеООСМС.НомерСтроки КАК НомерСтроки,
		|		РанееИсчисленныеООСМС.ФизЛицо КАК ФизЛицо,
		|		РанееИсчисленныеООСМС.Отчисление КАК Отчисление,
		|		РанееИсчисленныеООСМС.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|		РанееИсчисленныеООСМС.ОблагаемаяБаза КАК ОблагаемаяБаза,
		|		РанееИсчисленныеООСМС.ПериодРегистрации КАК ПериодРегистрации,
		|		РанееИсчисленныеООСМС.Организация КАК Организация
		|	ИЗ
		|		ВТ_РанееИсчисленныеООСМС КАК РанееИсчисленныеООСМС
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ТабличнаяЧастьООСМС.НомерСтроки,
		|		ТабличнаяЧастьООСМС.ФизЛицо,
		|		ТабличнаяЧастьООСМС.Отчисление,
		|		ТабличнаяЧастьООСМС.МесяцНалоговогоПериода,
		|		ТабличнаяЧастьООСМС.ОблагаемаяБаза,
		|		ТабличнаяЧастьООСМС.ПериодРегистрации,
		|		ТабличнаяЧастьООСМС.Организация
		|	ИЗ
		|		ВТ_ТабличнаяЧастьООСМС КАК ТабличнаяЧастьООСМС) КАК ИсчисленныеООСМС
		|
		|СГРУППИРОВАТЬ ПО
		|	ИсчисленныеООСМС.НомерСтроки,
		|	ИсчисленныеООСМС.ФизЛицо,
		|	ИсчисленныеООСМС.МесяцНалоговогоПериода,
		|	ИсчисленныеООСМС.ПериодРегистрации,
		|	ИсчисленныеООСМС.Организация
		|
		|";
		
	ЗапросРаспределения.Выполнить();
		
	ЗапросРаспределения.Текст = 
	"ВЫБРАТЬ
	|	ВТ_ТабличнаяЧастьСН.ФизЛицо,
	|	ВЫБОР
	|		КОГДА ВТ_ТабличнаяЧастьСН.ОтражениеПоПериодуРегистрации
	|			ТОГДА &Период
	|		ИНАЧЕ ВТ_ТабличнаяЧастьСН.МесяцНалоговогоПериода
	|	КОНЕЦ КАК Период
	|ПОМЕСТИТЬ ВТ_ПериодыСотрудников
	|ИЗ
	|	ВТ_ТабличнаяЧастьСН
	|
	|ОБЪЕДИНИТЬ // выбираем только различающиеся строки (без ВСЕ) 
	|
	|ВЫБРАТЬ
	|	ВТ_ТабличнаяЧастьСО.ФизЛицо,
	|	ВЫБОР 
	|		КОГДА ВТ_ТабличнаяЧастьСО.ОтражениеПоПериодуРегистрации
	|			ТОГДА &Период
	|		ИНАЧЕ ВТ_ТабличнаяЧастьСО.МесяцНалоговогоПериода
	|	КОНЕЦ КАК Период
	|ИЗ
	|	ВТ_ТабличнаяЧастьСО 
	|
	|ОБЪЕДИНИТЬ  
	|
	|ВЫБРАТЬ
	|	ВТ_ТабличнаяЧастьОППВ.ФизЛицо,
	|	ВЫБОР
	|		КОГДА ВТ_ТабличнаяЧастьОППВ.ОтражениеПоПериодуРегистрации
	|			ТОГДА &Период
	|		ИНАЧЕ ВТ_ТабличнаяЧастьОППВ.МесяцНалоговогоПериода
	|	КОНЕЦ КАК Период
	|ИЗ
	|	ВТ_ТабличнаяЧастьОППВ
	|
	|ОБЪЕДИНИТЬ  
	|
	|ВЫБРАТЬ
	|	ВТ_ТабличнаяЧастьОПВР.ФизЛицо,
	|	ВЫБОР
	|		КОГДА ВТ_ТабличнаяЧастьОПВР.ОтражениеПоПериодуРегистрации
	|			ТОГДА &Период
	|		ИНАЧЕ ВТ_ТабличнаяЧастьОПВР.МесяцНалоговогоПериода
	|	КОНЕЦ КАК Период
	|ИЗ
	|	ВТ_ТабличнаяЧастьОПВР
	|
	|ОБЪЕДИНИТЬ  
	|
	|ВЫБРАТЬ
	|	ВТ_ТабличнаяЧастьООСМС.ФизЛицо,
	|	ВЫБОР 
	|		КОГДА ВТ_ТабличнаяЧастьООСМС.ОтражениеПоПериодуРегистрации
	|			ТОГДА &Период
	|		ИНАЧЕ ВТ_ТабличнаяЧастьООСМС.МесяцНалоговогоПериода
	|	КОНЕЦ КАК Период
	|ИЗ
	|	ВТ_ТабличнаяЧастьООСМС
	|";
	
	ЗапросРаспределения.Текст = ЗапросРаспределения.Текст + ОбщегоНазначенияБКВызовСервера.ТекстРазделителяЗапросовПакета()
				 + РасчетЗарплатыСервер.СформироватьТекстЗапросаСтруктурныеЕдиницы("ВТ_ПериодыСотрудников", Истина) 
				 + ОбщегоНазначенияБКВызовСервера.ТекстРазделителяЗапросовПакета();
	ЗапросРаспределения.Выполнить();
	
	// СОЦИАЛЬНЫЕ ОТЧИСЛЕНИЯ
	
	ЗапросРаспределения.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ТабличнаяЧастьСО.НомерСтроки,
		|	ТабличнаяЧастьСО.ФизЛицо КАК ФизЛицо,
		|	ТабличнаяЧастьСО.ПериодРегистрации,
		|	ТабличнаяЧастьСО.МесяцНалоговогоПериода,
		|	ВЫБОР
		|		КОГДА НЕ (СОСведенияОДоходахОбороты.Период ЕСТЬ NULL)
		|			ТОГДА СОСведенияОДоходахОбороты.Период
		|		ИНАЧЕ ТабличнаяЧастьСО.МесяцНалоговогоПериода
		|	КОНЕЦ КАК ПериодДоходов,
		|	ВЫБОР
		|		КОГДА НЕ (СОСведенияОДоходахОбороты.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА СОСведенияОДоходахОбороты.СтруктурнаяЕдиница
		|		КОГДА НЕ (МестаРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА МестаРаботы.СтруктурнаяЕдиница
		|		ИНАЧЕ ТабличнаяЧастьСО.Организация
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|	ВЫБОР
		|		КОГДА НЕ (СОСведенияОДоходахОбороты.Организация ЕСТЬ NULL)
		|			ТОГДА СОСведенияОДоходахОбороты.Организация
		|		ИНАЧЕ ТабличнаяЧастьСО.Организация
		|	КОНЕЦ КАК Организация,
		|	ВЫБОР 
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА 
		|				ВЫБОР
		|					КОГДА НЕ (СОСведенияОДоходахОбороты.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА СОСведенияОДоходахОбороты.ПодразделениеОрганизации
		|					КОГДА НЕ (МестаРаботы.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА МестаРаботы.ПодразделениеОрганизации
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|				КОНЕЦ 
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ КАК ПодразделениеОрганизации,
		|	СУММА(ЕСТЬNULL(СОСведенияОДоходахОбороты.СуммаДоходаОборот, 0) - ЕСТЬNULL(СОСведенияОДоходахОбороты.СуммаВычетаОборот, 0)) КАК ОблагаемыйДоход
		|ПОМЕСТИТЬ ВТ_СведенияОДоходахСО
		|ИЗ
		|	ВТ_ИсчисленныеСО КАК ТабличнаяЧастьСО
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СОСведенияОДоходах.Обороты(
		|				,
		|				,
		|				Месяц,
		|				ПериодРегистрации = &Период
		|					И ФизЛицо В (ВЫБРАТЬ СписокФизЛиц.ФизЛицо ИЗ ВТ_СписокФизЛиц КАК СписокФизЛиц)
		|					И Налогоплательщик = &Налогоплательщик
		|					И СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)) КАК СОСведенияОДоходахОбороты
		|		ПО ТабличнаяЧастьСО.ФизЛицо = СОСведенияОДоходахОбороты.ФизЛицо
		|			И (НАЧАЛОПЕРИОДА(ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьСО.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ)= НАЧАЛОПЕРИОДА(СОСведенияОДоходахОбороты.Период, МЕСЯЦ))
		|			И (НАЧАЛОПЕРИОДА(ТабличнаяЧастьСО.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(СОСведенияОДоходахОбороты.ПериодРегистрации, МЕСЯЦ))
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестаРаботы
		|		ПО ТабличнаяЧастьСО.ФизЛицо = МестаРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьСО.МесяцНалоговогоПериода КОНЕЦ) = МестаРаботы.Период
		|
		|СГРУППИРОВАТЬ ПО
		|	ТабличнаяЧастьСО.НомерСтроки,
		|	ТабличнаяЧастьСО.ФизЛицо,
		|	ТабличнаяЧастьСО.ПериодРегистрации,
		|	ТабличнаяЧастьСО.МесяцНалоговогоПериода,
		|	ВЫБОР
		|		КОГДА НЕ (СОСведенияОДоходахОбороты.Период ЕСТЬ NULL)
		|			ТОГДА СОСведенияОДоходахОбороты.Период
		|		ИНАЧЕ ТабличнаяЧастьСО.МесяцНалоговогоПериода
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ (СОСведенияОДоходахОбороты.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА СОСведенияОДоходахОбороты.СтруктурнаяЕдиница
		|		КОГДА НЕ (МестаРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА МестаРаботы.СтруктурнаяЕдиница
		|		ИНАЧЕ ТабличнаяЧастьСО.Организация
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ (СОСведенияОДоходахОбороты.Организация ЕСТЬ NULL)
		|			ТОГДА СОСведенияОДоходахОбороты.Организация
		|		ИНАЧЕ ТабличнаяЧастьСО.Организация
		|	КОНЕЦ,
		|	ВЫБОР 
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА 
		|				ВЫБОР
		|					КОГДА НЕ (СОСведенияОДоходахОбороты.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА СОСведенияОДоходахОбороты.ПодразделениеОрганизации
		|					КОГДА НЕ (МестаРаботы.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА МестаРаботы.ПодразделениеОрганизации
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|				КОНЕЦ 
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТабличнаяЧастьСО.НомерСтроки КАК НомерСтроки,
		|	ТабличнаяЧастьСО.ФизЛицо КАК ФизЛицо,
		|	ТабличнаяЧастьСО.Отчисление КАК Отчисление,
		|	ТабличнаяЧастьСО.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	ТабличнаяЧастьСО.ОблагаемаяБаза КАК ОблагаемаяБаза,
		|	СведенияОДоходахСО.СтруктурнаяЕдиница,
		|	СведенияОДоходахСО.Организация КАК Организация,
		|	ВЫБОР
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА СведенияОДоходахСО.ПодразделениеОрганизации
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ КАК ПодразделениеОрганизации,
		|	СведенияОДоходахСО.ОблагаемыйДоход,
		|	ОбщаяСуммаДоходов.ОблагаемыйДоход КАК ОблагаемыйДоходВсего,
		|	ЕСТЬNULL(ИндивидуальныйПорядокОкругления.ПорядокОкругления, ОбщийПорядокОкругления.ПорядокОкругления) КАК ПорядокОкругления,
		|	ЕСТЬNULL(ИндивидуальныйПорядокОкругления.МетодОкругления, ОбщийПорядокОкругления.МетодОкругления) КАК МетодОкругления
		|ИЗ
		|	ВТ_ИсчисленныеСО КАК ТабличнаяЧастьСО
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			СведенияОДоходахСО.НомерСтроки КАК НомерСтроки,
		|			СведенияОДоходахСО.ФизЛицо КАК ФизЛицо,
		|			СведенияОДоходахСО.ПериодРегистрации КАК ПериодРегистрации,
		|			СведенияОДоходахСО.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|			СведенияОДоходахСО.ПериодДоходов КАК ПериодДоходов,
		|			СУММА(СведенияОДоходахСО.ОблагаемыйДоход) КАК ОблагаемыйДоход
		|		ИЗ
		|			ВТ_СведенияОДоходахСО КАК СведенияОДоходахСО
		|		
		|		СГРУППИРОВАТЬ ПО
		|			СведенияОДоходахСО.НомерСтроки,
		|			СведенияОДоходахСО.ФизЛицо,
		|			СведенияОДоходахСО.ПериодРегистрации,
		|			СведенияОДоходахСО.МесяцНалоговогоПериода,
		|			СведенияОДоходахСО.ПериодДоходов) КАК ОбщаяСуммаДоходов
		|		ПО ТабличнаяЧастьСО.НомерСтроки = ОбщаяСуммаДоходов.НомерСтроки
		|			И ТабличнаяЧастьСО.ФизЛицо = ОбщаяСуммаДоходов.ФизЛицо
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СведенияОДоходахСО КАК СведенияОДоходахСО
		|		ПО ТабличнаяЧастьСО.ФизЛицо = СведенияОДоходахСО.ФизЛицо
		|			И ТабличнаяЧастьСО.НомерСтроки = СведенияОДоходахСО.НомерСтроки
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПорядокОкругленияРезультатовРасчетаЗарплаты.СрезПоследних(&Период, ВидРасчета = НЕОПРЕДЕЛЕНО) КАК ОбщийПорядокОкругления
		|		ПО (ИСТИНА)
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПорядокОкругленияРезультатовРасчетаЗарплаты.СрезПоследних(&Период, ) КАК ИндивидуальныйПорядокОкругления
		|		ПО (ИндивидуальныйПорядокОкругления.ВидРасчета = ЗНАЧЕНИЕ(Справочник.НалогиСборыОтчисления.ОбязательныеСоциальныеОтчисления))
		|
		|УПОРЯДОЧИТЬ ПО
		|	НомерСтроки,
		|	ФизЛицо,
		|	МесяцНалоговогоПериода
		|ИТОГИ
		|	МАКСИМУМ(Отчисление),
		|	МАКСИМУМ(ОблагаемаяБаза),
		|	МАКСИМУМ(ПорядокОкругления),
		|	МАКСИМУМ(МетодОкругления)
		|ПО
		|	НомерСтроки";
		
	РезультатЗапросаСО = ЗапросРаспределения.Выполнить();;
	
	// Ключевое поле
	КолонкаДляПоиска = "НомерСтроки";
	
	// Сформируем структуру таблицы для промежуточного хранения результатов распределения СО
	ТаблицаРаспределенияСО = Новый ТаблицаЗначений();
	МассивТипов = Новый Массив; 
	МассивТипов.Добавить(Тип("Число"));
	ТаблицаРаспределенияСО.Колонки.Добавить("НомерСтроки", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(10)));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ФизическиеЛица"));
	ТаблицаРаспределенияСО.Колонки.Добавить("ФизЛицо", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ПодразделенияОрганизаций"));
	МассивТипов.Добавить(Тип("СправочникСсылка.Организации"));
	ТаблицаРаспределенияСО.Колонки.Добавить("СтруктурнаяЕдиница", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.Организации"));
	ТаблицаРаспределенияСО.Колонки.Добавить("Организация", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ПодразделенияОрганизаций"));
	ТаблицаРаспределенияСО.Колонки.Добавить("ПодразделениеОрганизации", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("Дата"));
	ТаблицаРаспределенияСО.Колонки.Добавить("МесяцНалоговогоПериода", Новый ОписаниеТипов(МассивТипов, Новый КвалификаторыДаты(ЧастиДаты.Дата)));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("Число"));
	ТаблицаРаспределенияСО.Колонки.Добавить("Отчисление", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(15,2)));
	ТаблицаРаспределенияСО.Колонки.Добавить("ОблагаемаяБаза", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(15,2)));

	// Распределяемые значения
	КолонкиДляРаспределения = Новый Массив;
	КолонкиДляРаспределения.Добавить("Отчисление");
	КолонкиДляРаспределения.Добавить("ОблагаемаяБаза");
	
	КолонкаКоэффициентов = "ОблагаемыйДоход";
	ПроведениеРасчетовСервер.РаспределитьНалогиВзносыУдержанияПоСтруктурнымЕдиницам(ТаблицаРаспределенияСО, РезультатЗапросаСО, КолонкиДляРаспределения, КолонкаДляПоиска, КолонкаКоэффициентов);	
	
	ТаблицаРаспределенияСО.Свернуть("НомерСтроки, ФизЛицо, СтруктурнаяЕдиница, Организация, ПодразделениеОрганизации, МесяцНалоговогоПериода", 
									"Отчисление, ОблагаемаяБаза");

	// СОЦИАЛЬНЫЙ НАЛОГ
	
	ЗапросРаспределения.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ТабличнаяЧастьСН.НомерСтроки,
		|	ТабличнаяЧастьСН.ФизЛицо КАК ФизЛицо,
		|	ТабличнаяЧастьСН.ПериодРегистрации,
		|	ТабличнаяЧастьСН.МесяцНалоговогоПериода,
		|	ВЫБОР 
		|		КОГДА НЕ (СНСведенияОДоходахОбороты.Период ЕСТЬ NULL)
		|			ТОГДА СНСведенияОДоходахОбороты.Период
		|		ИНАЧЕ ТабличнаяЧастьСН.МесяцНалоговогоПериода
		|	КОНЕЦ КАК ПериодДоходов,
		|	ВЫБОР
		|		КОГДА НЕ (СНСведенияОДоходахОбороты.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА СНСведенияОДоходахОбороты.СтруктурнаяЕдиница
		|		КОГДА НЕ (МестаРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА МестаРаботы.СтруктурнаяЕдиница
		|		ИНАЧЕ ТабличнаяЧастьСН.Организация
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|	ВЫБОР
		|		КОГДА НЕ (СНСведенияОДоходахОбороты.Организация ЕСТЬ NULL)
		|			ТОГДА СНСведенияОДоходахОбороты.Организация
		|		ИНАЧЕ ТабличнаяЧастьСН.Организация
		|	КОНЕЦ КАК Организация,
		|	ВЫБОР
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА
		|				ВЫБОР 
		|					КОГДА НЕ (СНСведенияОДоходахОбороты.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА СНСведенияОДоходахОбороты.ПодразделениеОрганизации
		|					КОГДА НЕ (МестаРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|						ТОГДА МестаРаботы.СтруктурнаяЕдиница
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|				КОНЕЦ 
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ КАК ПодразделениеОрганизации,
		|	СУММА(ЕСТЬNULL(СНСведенияОДоходахОбороты.СуммаДоходаОборот, 0) - ЕСТЬNULL(СНСведенияОДоходахОбороты.СуммаВычетаОборот, 0)) КАК ОблагаемыйДоход
		|ПОМЕСТИТЬ ВТ_СведенияОДоходахСН
		|ИЗ
		|	ВТ_ИсчисленныеСН КАК ТабличнаяЧастьСН
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СНСведенияОДоходах.Обороты(
		|				,
		|				,
		|				Месяц,
		|				ПериодРегистрации = &Период
		|					И ФизЛицо В (ВЫБРАТЬ СписокФизЛиц.ФизЛицо ИЗ ВТ_СписокФизЛиц КАК СписокФизЛиц)
		|					И Налогоплательщик = &Налогоплательщик
		|					И СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)) КАК СНСведенияОДоходахОбороты
		|		ПО ТабличнаяЧастьСН.ФизЛицо = СНСведенияОДоходахОбороты.ФизЛицо
		|			И (НАЧАЛОПЕРИОДА(ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьСН.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ) = НАЧАЛОПЕРИОДА(СНСведенияОДоходахОбороты.Период, МЕСЯЦ))
		|			И (НАЧАЛОПЕРИОДА(ТабличнаяЧастьСН.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(СНСведенияОДоходахОбороты.ПериодРегистрации, МЕСЯЦ))
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестаРаботы
		|		ПО ТабличнаяЧастьСН.ФизЛицо = МестаРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьСН.МесяцНалоговогоПериода КОНЕЦ) = МестаРаботы.Период
		|              
		|СГРУППИРОВАТЬ ПО
		|	ТабличнаяЧастьСН.НомерСтроки,
		|	ТабличнаяЧастьСН.ФизЛицо,
		|	ТабличнаяЧастьСН.ПериодРегистрации,
		|	ТабличнаяЧастьСН.МесяцНалоговогоПериода,
		|	ВЫБОР 
		|		КОГДА НЕ (СНСведенияОДоходахОбороты.Период ЕСТЬ NULL)
		|			ТОГДА СНСведенияОДоходахОбороты.Период
		|		ИНАЧЕ ТабличнаяЧастьСН.МесяцНалоговогоПериода
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ (СНСведенияОДоходахОбороты.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА СНСведенияОДоходахОбороты.СтруктурнаяЕдиница
		|		КОГДА НЕ (МестаРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА МестаРаботы.СтруктурнаяЕдиница
		|		ИНАЧЕ ТабличнаяЧастьСН.Организация
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ (СНСведенияОДоходахОбороты.Организация ЕСТЬ NULL)
		|			ТОГДА СНСведенияОДоходахОбороты.Организация
		|		ИНАЧЕ ТабличнаяЧастьСН.Организация
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА
		|				ВЫБОР 
		|					КОГДА НЕ (СНСведенияОДоходахОбороты.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА СНСведенияОДоходахОбороты.ПодразделениеОрганизации
		|					КОГДА НЕ (МестаРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|						ТОГДА МестаРаботы.СтруктурнаяЕдиница
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|				КОНЕЦ 
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТабличнаяЧастьСН.НомерСтроки КАК НомерСтроки,
		|	ТабличнаяЧастьСН.ФизЛицо КАК ФизЛицо,
		|	ТабличнаяЧастьСН.Налог КАК Налог,
		|	ТабличнаяЧастьСН.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	ТабличнаяЧастьСН.ОблагаемаяБаза КАК ОблагаемаяБаза,
		|	СведенияОДоходахСН.СтруктурнаяЕдиница,
		|	СведенияОДоходахСН.Организация КАК Организация,
		|	ВЫБОР
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА СведенияОДоходахСН.ПодразделениеОрганизации
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ КАК ПодразделениеОрганизации,
		|	СведенияОДоходахСН.ОблагаемыйДоход,
		|	ОбщаяСуммаДоходов.ОблагаемыйДоход КАК ОблагаемыйДоходВсего,
		|	ЕСТЬNULL(ИндивидуальныйПорядокОкругления.ПорядокОкругления, ОбщийПорядокОкругления.ПорядокОкругления) КАК ПорядокОкругления,
		|	ЕСТЬNULL(ИндивидуальныйПорядокОкругления.МетодОкругления, ОбщийПорядокОкругления.МетодОкругления) КАК МетодОкругления
		|ИЗ
		|	ВТ_ИсчисленныеСН КАК ТабличнаяЧастьСН
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			СведенияОДоходахСН.НомерСтроки КАК НомерСтроки,
		|			СведенияОДоходахСН.ФизЛицо КАК ФизЛицо,
		|			СведенияОДоходахСН.ПериодРегистрации КАК ПериодРегистрации,
		|			СведенияОДоходахСН.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|			СведенияОДоходахСН.ПериодДоходов КАК ПериодДоходов,
		|			СУММА(СведенияОДоходахСН.ОблагаемыйДоход) КАК ОблагаемыйДоход
		|		ИЗ
		|			ВТ_СведенияОДоходахСН КАК СведенияОДоходахСН
		|		
		|		СГРУППИРОВАТЬ ПО
		|			СведенияОДоходахСН.НомерСтроки,
		|			СведенияОДоходахСН.ФизЛицо,
		|			СведенияОДоходахСН.ПериодРегистрации,
		|			СведенияОДоходахСН.МесяцНалоговогоПериода,
		|			СведенияОДоходахСН.ПериодДоходов) КАК ОбщаяСуммаДоходов
		|		ПО ТабличнаяЧастьСН.НомерСтроки = ОбщаяСуммаДоходов.НомерСтроки
		|			И ТабличнаяЧастьСН.ФизЛицо = ОбщаяСуммаДоходов.ФизЛицо
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СведенияОДоходахСН КАК СведенияОДоходахСН
		|		ПО ТабличнаяЧастьСН.ФизЛицо = СведенияОДоходахСН.ФизЛицо
		|			И ТабличнаяЧастьСН.НомерСтроки = СведенияОДоходахСН.НомерСтроки
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПорядокОкругленияРезультатовРасчетаЗарплаты.СрезПоследних(&Период, ВидРасчета = НЕОПРЕДЕЛЕНО) КАК ОбщийПорядокОкругления
		|		ПО (ИСТИНА)
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПорядокОкругленияРезультатовРасчетаЗарплаты.СрезПоследних(&Период, ) КАК ИндивидуальныйПорядокОкругления
		|		ПО (ИндивидуальныйПорядокОкругления.ВидРасчета = ЗНАЧЕНИЕ(Справочник.НалогиСборыОтчисления.СоциальныйНалог))
		|
		|УПОРЯДОЧИТЬ ПО
		|	НомерСтроки,
		|	ФизЛицо,
		|	МесяцНалоговогоПериода
		|ИТОГИ
		|	МАКСИМУМ(Налог),
		|	МАКСИМУМ(ОблагаемаяБаза),
		|	МАКСИМУМ(ПорядокОкругления),
		|	МАКСИМУМ(МетодОкругления)
		|ПО
		|	НомерСтроки";
		
	РезультатЗапросаСН = ЗапросРаспределения.Выполнить();;
	
	// Ключевое поле
	КолонкаДляПоиска = "НомерСтроки";
	
	// Сформируем структуру таблицы для промежуточного хранения результатов распределения СН
	ТаблицаРаспределенияСН = Новый ТаблицаЗначений();
	МассивТипов = Новый Массив;
	МассивТипов.Добавить(Тип("Число"));
	ТаблицаРаспределенияСН.Колонки.Добавить("НомерСтроки", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(10)));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ФизическиеЛица"));
	ТаблицаРаспределенияСН.Колонки.Добавить("ФизЛицо", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ПодразделенияОрганизаций"));
	МассивТипов.Добавить(Тип("СправочникСсылка.Организации"));
	ТаблицаРаспределенияСН.Колонки.Добавить("СтруктурнаяЕдиница", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.Организации"));
	ТаблицаРаспределенияСН.Колонки.Добавить("Организация", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ПодразделенияОрганизаций"));
	ТаблицаРаспределенияСН.Колонки.Добавить("ПодразделениеОрганизации", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("Дата"));
	ТаблицаРаспределенияСН.Колонки.Добавить("МесяцНалоговогоПериода", Новый ОписаниеТипов(МассивТипов, Новый КвалификаторыДаты(ЧастиДаты.Дата)));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("Число"));
	ТаблицаРаспределенияСН.Колонки.Добавить("Налог", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(15,2)));
	ТаблицаРаспределенияСН.Колонки.Добавить("ОблагаемаяБаза", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(15,2)));
	
	// Распределяемые значения
	КолонкиДляРаспределения = Новый Массив;
	КолонкиДляРаспределения.Добавить("Налог");
	КолонкиДляРаспределения.Добавить("ОблагаемаяБаза");
	
	КолонкаКоэффициентов = "ОблагаемыйДоход";
	ПроведениеРасчетовСервер.РаспределитьНалогиВзносыУдержанияПоСтруктурнымЕдиницам(ТаблицаРаспределенияСН, РезультатЗапросаСН, КолонкиДляРаспределения, КолонкаДляПоиска, КолонкаКоэффициентов);	
	
	ТаблицаРаспределенияСН.Свернуть("НомерСтроки, ФизЛицо, СтруктурнаяЕдиница, Организация, ПодразделениеОрганизации, МесяцНалоговогоПериода", 
									"Налог, ОблагаемаяБаза");
	
	// ОБЯЗАТЕЛЬНЫЕ ПРОФЕССИОНАЛЬНЕ ПЕНСИОННЫЕ ВЗНОСЫ
	
	ЗапросРаспределения.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ТабличнаяЧастьОППВ.НомерСтроки,
		|	ТабличнаяЧастьОППВ.ФизЛицо КАК ФизЛицо,
		|	ТабличнаяЧастьОППВ.ПериодРегистрации,
		|	ТабличнаяЧастьОППВ.МесяцНалоговогоПериода,
		|	ВЫБОР
		|		КОГДА НЕ (ОППВСведенияОДоходахОбороты.Период ЕСТЬ NULL)
		|			ТОГДА ОППВСведенияОДоходахОбороты.Период
		|		ИНАЧЕ ТабличнаяЧастьОППВ.МесяцНалоговогоПериода
		|	КОНЕЦ КАК ПериодДоходов,
		|	ВЫБОР
		|		КОГДА НЕ (ОППВСведенияОДоходахОбороты.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА ОППВСведенияОДоходахОбороты.СтруктурнаяЕдиница
		|		КОГДА НЕ (МестаРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА МестаРаботы.СтруктурнаяЕдиница
		|		ИНАЧЕ ТабличнаяЧастьОППВ.Организация
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|	ВЫБОР
		|		КОГДА НЕ (ОППВСведенияОДоходахОбороты.Организация ЕСТЬ NULL)
		|			ТОГДА ОППВСведенияОДоходахОбороты.Организация
		|		ИНАЧЕ ТабличнаяЧастьОППВ.Организация
		|	КОНЕЦ КАК Организация,
		|	ВЫБОР
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА 
		|				ВЫБОР
		|					КОГДА НЕ (ОППВСведенияОДоходахОбороты.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА ОППВСведенияОДоходахОбороты.ПодразделениеОрганизации
		|					КОГДА НЕ (МестаРаботы.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА МестаРаботы.ПодразделениеОрганизации
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|				КОНЕЦ 
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ КАК ПодразделениеОрганизации,
		|	СУММА(ЕСТЬNULL(ОППВСведенияОДоходахОбороты.СуммаДоходаОборот, 0) - ЕСТЬNULL(ОППВСведенияОДоходахОбороты.СуммаВычетаОборот, 0)) КАК ОблагаемыйДоход
		|ПОМЕСТИТЬ ВТ_СведенияОДоходахОППВ
		|ИЗ
		|	ВТ_ИсчисленныйОППВ КАК ТабличнаяЧастьОППВ
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОППВСведенияОДоходах.Обороты(
		|				,
		|				,
		|				Месяц,
		|				ПериодРегистрации = &Период
		|					И ФизЛицо В (ВЫБРАТЬ СписокФизЛиц.ФизЛицо ИЗ ВТ_СписокФизЛиц КАК СписокФизЛиц)
		|					И Налогоплательщик = &Налогоплательщик
		|					И СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)) КАК ОППВСведенияОДоходахОбороты
		|		ПО ТабличнаяЧастьОППВ.ФизЛицо = ОППВСведенияОДоходахОбороты.ФизЛицо
		|			И (НАЧАЛОПЕРИОДА(ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьОППВ.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ)= НАЧАЛОПЕРИОДА(ОППВСведенияОДоходахОбороты.Период, МЕСЯЦ))
		|			И (НАЧАЛОПЕРИОДА(ТабличнаяЧастьОППВ.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ОППВСведенияОДоходахОбороты.ПериодРегистрации, МЕСЯЦ))
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестаРаботы
		|		ПО ТабличнаяЧастьОППВ.ФизЛицо = МестаРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьОППВ.МесяцНалоговогоПериода КОНЕЦ) = МестаРаботы.Период
		|
		|СГРУППИРОВАТЬ ПО
		|	ТабличнаяЧастьОППВ.НомерСтроки,
		|	ТабличнаяЧастьОППВ.ФизЛицо,
		|	ТабличнаяЧастьОППВ.ПериодРегистрации,
		|	ТабличнаяЧастьОППВ.МесяцНалоговогоПериода,
		|	ВЫБОР
		|		КОГДА НЕ (ОППВСведенияОДоходахОбороты.Период ЕСТЬ NULL)
		|			ТОГДА ОППВСведенияОДоходахОбороты.Период
		|		ИНАЧЕ ТабличнаяЧастьОППВ.МесяцНалоговогоПериода
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ (ОППВСведенияОДоходахОбороты.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА ОППВСведенияОДоходахОбороты.СтруктурнаяЕдиница
		|		КОГДА НЕ (МестаРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА МестаРаботы.СтруктурнаяЕдиница
		|		ИНАЧЕ ТабличнаяЧастьОППВ.Организация
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ (ОППВСведенияОДоходахОбороты.Организация ЕСТЬ NULL)
		|			ТОГДА ОППВСведенияОДоходахОбороты.Организация
		|		ИНАЧЕ ТабличнаяЧастьОППВ.Организация
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА 
		|				ВЫБОР
		|					КОГДА НЕ (ОППВСведенияОДоходахОбороты.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА ОППВСведенияОДоходахОбороты.ПодразделениеОрганизации
		|					КОГДА НЕ (МестаРаботы.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА МестаРаботы.ПодразделениеОрганизации
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|				КОНЕЦ 
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТабличнаяЧастьОППВ.НомерСтроки КАК НомерСтроки,
		|	ТабличнаяЧастьОППВ.ФизЛицо КАК ФизЛицо,
		|	ТабличнаяЧастьОППВ.Взнос КАК Взнос,
		|	ТабличнаяЧастьОППВ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	ТабличнаяЧастьОППВ.ОблагаемаяБаза КАК ОблагаемаяБаза,
		|	СведенияОДоходахОППВ.СтруктурнаяЕдиница,
		|	СведенияОДоходахОППВ.Организация КАК Организация,
		|	ВЫБОР
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА СведенияОДоходахОППВ.ПодразделениеОрганизации
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ КАК ПодразделениеОрганизации,
		|	СведенияОДоходахОППВ.ОблагаемыйДоход,
		|	ОбщаяСуммаДоходов.ОблагаемыйДоход КАК ОблагаемыйДоходВсего,
		|	ЕСТЬNULL(ИндивидуальныйПорядокОкругления.ПорядокОкругления, ОбщийПорядокОкругления.ПорядокОкругления) КАК ПорядокОкругления,
		|	ЕСТЬNULL(ИндивидуальныйПорядокОкругления.МетодОкругления, ОбщийПорядокОкругления.МетодОкругления) КАК МетодОкругления
		|ИЗ
		|	ВТ_ИсчисленныйОППВ КАК ТабличнаяЧастьОППВ
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			СведенияОДоходахОППВ.НомерСтроки КАК НомерСтроки,
		|			СведенияОДоходахОППВ.ФизЛицо КАК ФизЛицо,
		|			СведенияОДоходахОППВ.ПериодРегистрации КАК ПериодРегистрации,
		|			СведенияОДоходахОППВ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|			СведенияОДоходахОППВ.ПериодДоходов КАК ПериодДоходов,
		|			СУММА(СведенияОДоходахОППВ.ОблагаемыйДоход) КАК ОблагаемыйДоход
		|		ИЗ
		|			ВТ_СведенияОДоходахОППВ КАК СведенияОДоходахОППВ
		|		
		|		СГРУППИРОВАТЬ ПО
		|			СведенияОДоходахОППВ.НомерСтроки,
		|			СведенияОДоходахОППВ.ФизЛицо,
		|			СведенияОДоходахОППВ.ПериодРегистрации,
		|			СведенияОДоходахОППВ.МесяцНалоговогоПериода,
		|			СведенияОДоходахОППВ.ПериодДоходов) КАК ОбщаяСуммаДоходов
		|		ПО ТабличнаяЧастьОППВ.НомерСтроки = ОбщаяСуммаДоходов.НомерСтроки
		|			И ТабличнаяЧастьОППВ.ФизЛицо = ОбщаяСуммаДоходов.ФизЛицо
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СведенияОДоходахОППВ КАК СведенияОДоходахОППВ
		|		ПО ТабличнаяЧастьОППВ.ФизЛицо = СведенияОДоходахОППВ.ФизЛицо
		|			И ТабличнаяЧастьОППВ.НомерСтроки = СведенияОДоходахОППВ.НомерСтроки
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПорядокОкругленияРезультатовРасчетаЗарплаты.СрезПоследних(&Период, ВидРасчета = НЕОПРЕДЕЛЕНО) КАК ОбщийПорядокОкругления
		|		ПО (ИСТИНА)
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПорядокОкругленияРезультатовРасчетаЗарплаты.СрезПоследних(&Период, ) КАК ИндивидуальныйПорядокОкругления
		|		ПО (ИндивидуальныйПорядокОкругления.ВидРасчета = ЗНАЧЕНИЕ(Справочник.НалогиСборыОтчисления.ОбязательныеСоциальныеОтчисления))
		|
		|УПОРЯДОЧИТЬ ПО
		|	НомерСтроки,
		|	ФизЛицо,
		|	МесяцНалоговогоПериода
		|ИТОГИ
		|	МАКСИМУМ(Взнос),
		|	МАКСИМУМ(ОблагаемаяБаза),
		|	МАКСИМУМ(ПорядокОкругления),
		|	МАКСИМУМ(МетодОкругления)
		|ПО
		|	НомерСтроки";
		
	РезультатЗапросаОППВ = ЗапросРаспределения.Выполнить();;
	
	// Ключевое поле
	КолонкаДляПоиска = "НомерСтроки";
	
	// Сформируем структуру таблицы для промежуточного хранения результатов распределения СО
	ТаблицаРаспределенияОППВ = Новый ТаблицаЗначений();
	МассивТипов = Новый Массив; 
	МассивТипов.Добавить(Тип("Число"));
	ТаблицаРаспределенияОППВ.Колонки.Добавить("НомерСтроки", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(10)));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ФизическиеЛица"));
	ТаблицаРаспределенияОППВ.Колонки.Добавить("ФизЛицо", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ПодразделенияОрганизаций"));
	МассивТипов.Добавить(Тип("СправочникСсылка.Организации"));
	ТаблицаРаспределенияОППВ.Колонки.Добавить("СтруктурнаяЕдиница", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.Организации"));
	ТаблицаРаспределенияОППВ.Колонки.Добавить("Организация", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ПодразделенияОрганизаций"));
	ТаблицаРаспределенияОППВ.Колонки.Добавить("ПодразделениеОрганизации", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("Дата"));
	ТаблицаРаспределенияОППВ.Колонки.Добавить("МесяцНалоговогоПериода", Новый ОписаниеТипов(МассивТипов, Новый КвалификаторыДаты(ЧастиДаты.Дата)));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("Число"));
	ТаблицаРаспределенияОППВ.Колонки.Добавить("Взнос", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(15,2)));
	ТаблицаРаспределенияОППВ.Колонки.Добавить("ОблагаемаяБаза", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(15,2)));

	// Распределяемые значения
	КолонкиДляРаспределения = Новый Массив;
	КолонкиДляРаспределения.Добавить("Взнос");
	КолонкиДляРаспределения.Добавить("ОблагаемаяБаза");
	
	КолонкаКоэффициентов = "ОблагаемыйДоход";
	ПроведениеРасчетовСервер.РаспределитьНалогиВзносыУдержанияПоСтруктурнымЕдиницам(ТаблицаРаспределенияОППВ, РезультатЗапросаОППВ, КолонкиДляРаспределения, КолонкаДляПоиска, КолонкаКоэффициентов);	
	
	ТаблицаРаспределенияОППВ.Свернуть("НомерСтроки, ФизЛицо, СтруктурнаяЕдиница, Организация, ПодразделениеОрганизации, МесяцНалоговогоПериода", 
									"Взнос, ОблагаемаяБаза");
									
	// ОБЯЗАТЕЛЬНЫЕ ПРОФЕССИОНАЛЬНЕ ПЕНСИОННЫЕ ВЗНОСЫ
	
	ЗапросРаспределения.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ТабличнаяЧастьОПВР.НомерСтроки,
		|	ТабличнаяЧастьОПВР.ФизЛицо КАК ФизЛицо,
		|	ТабличнаяЧастьОПВР.ПериодРегистрации,
		|	ТабличнаяЧастьОПВР.МесяцНалоговогоПериода,
		|	ВЫБОР
		|		КОГДА НЕ (ОПВРСведенияОДоходахОбороты.Период ЕСТЬ NULL)
		|			ТОГДА ОПВРСведенияОДоходахОбороты.Период
		|		ИНАЧЕ ТабличнаяЧастьОПВР.МесяцНалоговогоПериода
		|	КОНЕЦ КАК ПериодДоходов,
		|	ВЫБОР
		|		КОГДА НЕ (ОПВРСведенияОДоходахОбороты.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА ОПВРСведенияОДоходахОбороты.СтруктурнаяЕдиница
		|		КОГДА НЕ (МестаРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА МестаРаботы.СтруктурнаяЕдиница
		|		ИНАЧЕ ТабличнаяЧастьОПВР.Организация
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|	ВЫБОР
		|		КОГДА НЕ (ОПВРСведенияОДоходахОбороты.Организация ЕСТЬ NULL)
		|			ТОГДА ОПВРСведенияОДоходахОбороты.Организация
		|		ИНАЧЕ ТабличнаяЧастьОПВР.Организация
		|	КОНЕЦ КАК Организация,
		|	ВЫБОР
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА 
		|				ВЫБОР
		|					КОГДА НЕ (ОПВРСведенияОДоходахОбороты.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА ОПВРСведенияОДоходахОбороты.ПодразделениеОрганизации
		|					КОГДА НЕ (МестаРаботы.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА МестаРаботы.ПодразделениеОрганизации
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|				КОНЕЦ 
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ КАК ПодразделениеОрганизации,
		|	СУММА(ЕСТЬNULL(ОПВРСведенияОДоходахОбороты.СуммаДоходаОборот, 0) - ЕСТЬNULL(ОПВРСведенияОДоходахОбороты.СуммаВычетаОборот, 0)) КАК ОблагаемыйДоход
		|ПОМЕСТИТЬ ВТ_СведенияОДоходахОПВР
		|ИЗ
		|	ВТ_ИсчисленныйОПВР КАК ТабличнаяЧастьОПВР
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОПВРСведенияОДоходах.Обороты(
		|				,
		|				,
		|				Месяц,
		|				ПериодРегистрации = &Период
		|					И ФизЛицо В (ВЫБРАТЬ СписокФизЛиц.ФизЛицо ИЗ ВТ_СписокФизЛиц КАК СписокФизЛиц)
		|					И Налогоплательщик = &Налогоплательщик
		|					И СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)) КАК ОПВРСведенияОДоходахОбороты
		|		ПО ТабличнаяЧастьОПВР.ФизЛицо = ОПВРСведенияОДоходахОбороты.ФизЛицо
		|			И (НАЧАЛОПЕРИОДА(ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьОПВР.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ)= НАЧАЛОПЕРИОДА(ОПВРСведенияОДоходахОбороты.Период, МЕСЯЦ))
		|			И (НАЧАЛОПЕРИОДА(ТабличнаяЧастьОПВР.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ОПВРСведенияОДоходахОбороты.ПериодРегистрации, МЕСЯЦ))
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестаРаботы
		|		ПО ТабличнаяЧастьОПВР.ФизЛицо = МестаРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьОПВР.МесяцНалоговогоПериода КОНЕЦ) = МестаРаботы.Период
		|
		|СГРУППИРОВАТЬ ПО
		|	ТабличнаяЧастьОПВР.НомерСтроки,
		|	ТабличнаяЧастьОПВР.ФизЛицо,
		|	ТабличнаяЧастьОПВР.ПериодРегистрации,
		|	ТабличнаяЧастьОПВР.МесяцНалоговогоПериода,
		|	ВЫБОР
		|		КОГДА НЕ (ОПВРСведенияОДоходахОбороты.Период ЕСТЬ NULL)
		|			ТОГДА ОПВРСведенияОДоходахОбороты.Период
		|		ИНАЧЕ ТабличнаяЧастьОПВР.МесяцНалоговогоПериода
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ (ОПВРСведенияОДоходахОбороты.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА ОПВРСведенияОДоходахОбороты.СтруктурнаяЕдиница
		|		КОГДА НЕ (МестаРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА МестаРаботы.СтруктурнаяЕдиница
		|		ИНАЧЕ ТабличнаяЧастьОПВР.Организация
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ (ОПВРСведенияОДоходахОбороты.Организация ЕСТЬ NULL)
		|			ТОГДА ОПВРСведенияОДоходахОбороты.Организация
		|		ИНАЧЕ ТабличнаяЧастьОПВР.Организация
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА 
		|				ВЫБОР
		|					КОГДА НЕ (ОПВРСведенияОДоходахОбороты.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА ОПВРСведенияОДоходахОбороты.ПодразделениеОрганизации
		|					КОГДА НЕ (МестаРаботы.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА МестаРаботы.ПодразделениеОрганизации
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|				КОНЕЦ 
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТабличнаяЧастьОПВР.НомерСтроки КАК НомерСтроки,
		|	ТабличнаяЧастьОПВР.ФизЛицо КАК ФизЛицо,
		|	ТабличнаяЧастьОПВР.Взнос КАК Взнос,
		|	ТабличнаяЧастьОПВР.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	ТабличнаяЧастьОПВР.ОблагаемаяБаза КАК ОблагаемаяБаза,
		|	СведенияОДоходахОПВР.СтруктурнаяЕдиница,
		|	СведенияОДоходахОПВР.Организация КАК Организация,
		|	ВЫБОР
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА СведенияОДоходахОПВР.ПодразделениеОрганизации
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ КАК ПодразделениеОрганизации,
		|	СведенияОДоходахОПВР.ОблагаемыйДоход,
		|	ОбщаяСуммаДоходов.ОблагаемыйДоход КАК ОблагаемыйДоходВсего,
		|	ЕСТЬNULL(ИндивидуальныйПорядокОкругления.ПорядокОкругления, ОбщийПорядокОкругления.ПорядокОкругления) КАК ПорядокОкругления,
		|	ЕСТЬNULL(ИндивидуальныйПорядокОкругления.МетодОкругления, ОбщийПорядокОкругления.МетодОкругления) КАК МетодОкругления
		|ИЗ
		|	ВТ_ИсчисленныйОПВР КАК ТабличнаяЧастьОПВР
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			СведенияОДоходахОПВР.НомерСтроки КАК НомерСтроки,
		|			СведенияОДоходахОПВР.ФизЛицо КАК ФизЛицо,
		|			СведенияОДоходахОПВР.ПериодРегистрации КАК ПериодРегистрации,
		|			СведенияОДоходахОПВР.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|			СведенияОДоходахОПВР.ПериодДоходов КАК ПериодДоходов,
		|			СУММА(СведенияОДоходахОПВР.ОблагаемыйДоход) КАК ОблагаемыйДоход
		|		ИЗ
		|			ВТ_СведенияОДоходахОПВР КАК СведенияОДоходахОПВР
		|		
		|		СГРУППИРОВАТЬ ПО
		|			СведенияОДоходахОПВР.НомерСтроки,
		|			СведенияОДоходахОПВР.ФизЛицо,
		|			СведенияОДоходахОПВР.ПериодРегистрации,
		|			СведенияОДоходахОПВР.МесяцНалоговогоПериода,
		|			СведенияОДоходахОПВР.ПериодДоходов) КАК ОбщаяСуммаДоходов
		|		ПО ТабличнаяЧастьОПВР.НомерСтроки = ОбщаяСуммаДоходов.НомерСтроки
		|			И ТабличнаяЧастьОПВР.ФизЛицо = ОбщаяСуммаДоходов.ФизЛицо
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СведенияОДоходахОПВР КАК СведенияОДоходахОПВР
		|		ПО ТабличнаяЧастьОПВР.ФизЛицо = СведенияОДоходахОПВР.ФизЛицо
		|			И ТабличнаяЧастьОПВР.НомерСтроки = СведенияОДоходахОПВР.НомерСтроки
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПорядокОкругленияРезультатовРасчетаЗарплаты.СрезПоследних(&Период, ВидРасчета = НЕОПРЕДЕЛЕНО) КАК ОбщийПорядокОкругления
		|		ПО (ИСТИНА)
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПорядокОкругленияРезультатовРасчетаЗарплаты.СрезПоследних(&Период, ) КАК ИндивидуальныйПорядокОкругления
		|		ПО (ИндивидуальныйПорядокОкругления.ВидРасчета = ЗНАЧЕНИЕ(Справочник.НалогиСборыОтчисления.ОбязательныеСоциальныеОтчисления))
		|
		|УПОРЯДОЧИТЬ ПО
		|	НомерСтроки,
		|	ФизЛицо,
		|	МесяцНалоговогоПериода
		|ИТОГИ
		|	МАКСИМУМ(Взнос),
		|	МАКСИМУМ(ОблагаемаяБаза),
		|	МАКСИМУМ(ПорядокОкругления),
		|	МАКСИМУМ(МетодОкругления)
		|ПО
		|	НомерСтроки";
		
	РезультатЗапросаОПВР = ЗапросРаспределения.Выполнить();;
	
	// Ключевое поле
	КолонкаДляПоиска = "НомерСтроки";
	
	// Сформируем структуру таблицы для промежуточного хранения результатов распределения СО
	ТаблицаРаспределенияОПВР = Новый ТаблицаЗначений();
	МассивТипов = Новый Массив; 
	МассивТипов.Добавить(Тип("Число"));
	ТаблицаРаспределенияОПВР.Колонки.Добавить("НомерСтроки", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(10)));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ФизическиеЛица"));
	ТаблицаРаспределенияОПВР.Колонки.Добавить("ФизЛицо", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ПодразделенияОрганизаций"));
	МассивТипов.Добавить(Тип("СправочникСсылка.Организации"));
	ТаблицаРаспределенияОПВР.Колонки.Добавить("СтруктурнаяЕдиница", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.Организации"));
	ТаблицаРаспределенияОПВР.Колонки.Добавить("Организация", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ПодразделенияОрганизаций"));
	ТаблицаРаспределенияОПВР.Колонки.Добавить("ПодразделениеОрганизации", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("Дата"));
	ТаблицаРаспределенияОПВР.Колонки.Добавить("МесяцНалоговогоПериода", Новый ОписаниеТипов(МассивТипов, Новый КвалификаторыДаты(ЧастиДаты.Дата)));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("Число"));
	ТаблицаРаспределенияОПВР.Колонки.Добавить("Взнос", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(15,2)));
	ТаблицаРаспределенияОПВР.Колонки.Добавить("ОблагаемаяБаза", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(15,2)));

	// Распределяемые значения
	КолонкиДляРаспределения = Новый Массив;
	КолонкиДляРаспределения.Добавить("Взнос");
	КолонкиДляРаспределения.Добавить("ОблагаемаяБаза");
	
	КолонкаКоэффициентов = "ОблагаемыйДоход";
	ПроведениеРасчетовСервер.РаспределитьНалогиВзносыУдержанияПоСтруктурнымЕдиницам(ТаблицаРаспределенияОПВР, РезультатЗапросаОПВР, КолонкиДляРаспределения, КолонкаДляПоиска, КолонкаКоэффициентов);	
	
	ТаблицаРаспределенияОПВР.Свернуть("НомерСтроки, ФизЛицо, СтруктурнаяЕдиница, Организация, ПодразделениеОрганизации, МесяцНалоговогоПериода", 
									"Взнос, ОблагаемаяБаза");
									
	// ОТЧИСЛЕНИЯ НА ОБЯЗАТЕЛЬНОЕ СОЦИАЛЬНОЕ МЕДИЦИНСКОЕ СТРАХОВАНИЕ
	
	ЗапросРаспределения.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ТабличнаяЧастьООСМС.НомерСтроки,
		|	ТабличнаяЧастьООСМС.ФизЛицо КАК ФизЛицо,
		|	ТабличнаяЧастьООСМС.ПериодРегистрации,
		|	ТабличнаяЧастьООСМС.МесяцНалоговогоПериода,
		|	ВЫБОР
		|		КОГДА НЕ (ООСМССведенияОДоходахОбороты.Период ЕСТЬ NULL)
		|			ТОГДА ООСМССведенияОДоходахОбороты.Период
		|		ИНАЧЕ ТабличнаяЧастьООСМС.МесяцНалоговогоПериода
		|	КОНЕЦ КАК ПериодДоходов,
		|	ВЫБОР
		|		КОГДА НЕ (ООСМССведенияОДоходахОбороты.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА ООСМССведенияОДоходахОбороты.СтруктурнаяЕдиница
		|		КОГДА НЕ (МестаРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА МестаРаботы.СтруктурнаяЕдиница
		|		ИНАЧЕ ТабличнаяЧастьООСМС.Организация
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|	ВЫБОР
		|		КОГДА НЕ (ООСМССведенияОДоходахОбороты.Организация ЕСТЬ NULL)
		|			ТОГДА ООСМССведенияОДоходахОбороты.Организация
		|		ИНАЧЕ ТабличнаяЧастьООСМС.Организация
		|	КОНЕЦ КАК Организация,
		|	ВЫБОР 
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА 
		|				ВЫБОР
		|					КОГДА НЕ (ООСМССведенияОДоходахОбороты.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА ООСМССведенияОДоходахОбороты.ПодразделениеОрганизации
		|					КОГДА НЕ (МестаРаботы.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА МестаРаботы.ПодразделениеОрганизации
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|				КОНЕЦ 
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ КАК ПодразделениеОрганизации,
		|	СУММА(ЕСТЬNULL(ООСМССведенияОДоходахОбороты.СуммаДоходаОборот, 0) - ЕСТЬNULL(ООСМССведенияОДоходахОбороты.СуммаВычетаОборот, 0)) КАК ОблагаемыйДоход
		|ПОМЕСТИТЬ ВТ_СведенияОДоходахООСМС
		|ИЗ
		|	ВТ_ИсчисленныеООСМС КАК ТабличнаяЧастьООСМС
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ООСМССведенияОДоходах.Обороты(
		|				,
		|				,
		|				Месяц,
		|				ПериодРегистрации = &Период
		|					И ФизЛицо В (ВЫБРАТЬ СписокФизЛиц.ФизЛицо ИЗ ВТ_СписокФизЛиц КАК СписокФизЛиц)
		|					И Налогоплательщик = &Налогоплательщик
		|					И СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)) КАК ООСМССведенияОДоходахОбороты
		|		ПО ТабличнаяЧастьООСМС.ФизЛицо = ООСМССведенияОДоходахОбороты.ФизЛицо
		|			И (НАЧАЛОПЕРИОДА(ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьООСМС.МесяцНалоговогоПериода КОНЕЦ, МЕСЯЦ)= НАЧАЛОПЕРИОДА(ООСМССведенияОДоходахОбороты.Период, МЕСЯЦ))
		|			И (НАЧАЛОПЕРИОДА(ТабличнаяЧастьООСМС.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ООСМССведенияОДоходахОбороты.ПериодРегистрации, МЕСЯЦ))
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестаРаботы
		|		ПО ТабличнаяЧастьООСМС.ФизЛицо = МестаРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ ТабличнаяЧастьООСМС.МесяцНалоговогоПериода КОНЕЦ) = МестаРаботы.Период
		|
		|СГРУППИРОВАТЬ ПО
		|	ТабличнаяЧастьООСМС.НомерСтроки,
		|	ТабличнаяЧастьООСМС.ФизЛицо,
		|	ТабличнаяЧастьООСМС.ПериодРегистрации,
		|	ТабличнаяЧастьООСМС.МесяцНалоговогоПериода,
		|	ВЫБОР
		|		КОГДА НЕ (ООСМССведенияОДоходахОбороты.Период ЕСТЬ NULL)
		|			ТОГДА ООСМССведенияОДоходахОбороты.Период
		|		ИНАЧЕ ТабличнаяЧастьООСМС.МесяцНалоговогоПериода
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ (ООСМССведенияОДоходахОбороты.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА ООСМССведенияОДоходахОбороты.СтруктурнаяЕдиница
		|		КОГДА НЕ (МестаРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|			ТОГДА МестаРаботы.СтруктурнаяЕдиница
		|		ИНАЧЕ ТабличнаяЧастьООСМС.Организация
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА НЕ (ООСМССведенияОДоходахОбороты.Организация ЕСТЬ NULL)
		|			ТОГДА ООСМССведенияОДоходахОбороты.Организация
		|		ИНАЧЕ ТабличнаяЧастьООСМС.Организация
		|	КОНЕЦ,
		|	ВЫБОР 
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА 
		|				ВЫБОР
		|					КОГДА НЕ (ООСМССведенияОДоходахОбороты.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА ООСМССведенияОДоходахОбороты.ПодразделениеОрганизации
		|					КОГДА НЕ (МестаРаботы.ПодразделениеОрганизации ЕСТЬ NULL)
		|						ТОГДА МестаРаботы.ПодразделениеОрганизации
		|					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|				КОНЕЦ 
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ТабличнаяЧастьООСМС.НомерСтроки КАК НомерСтроки,
		|	ТабличнаяЧастьООСМС.ФизЛицо КАК ФизЛицо,
		|	ТабличнаяЧастьООСМС.Отчисление КАК Отчисление,
		|	ТабличнаяЧастьООСМС.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|	ТабличнаяЧастьООСМС.ОблагаемаяБаза КАК ОблагаемаяБаза,
		|	СведенияОДоходахООСМС.СтруктурнаяЕдиница,
		|	СведенияОДоходахООСМС.Организация КАК Организация,
		|	ВЫБОР
		|		КОГДА Реквизиты.РаспределятьНалогиПоПодразделениямОрганизаций
		|			ТОГДА СведенияОДоходахООСМС.ПодразделениеОрганизации
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка)
		|	КОНЕЦ КАК ПодразделениеОрганизации,
		|	СведенияОДоходахООСМС.ОблагаемыйДоход,
		|	ОбщаяСуммаДоходов.ОблагаемыйДоход КАК ОблагаемыйДоходВсего,
		|	ЕСТЬNULL(ИндивидуальныйПорядокОкругления.ПорядокОкругления, ОбщийПорядокОкругления.ПорядокОкругления) КАК ПорядокОкругления,
		|	ЕСТЬNULL(ИндивидуальныйПорядокОкругления.МетодОкругления, ОбщийПорядокОкругления.МетодОкругления) КАК МетодОкругления
		|ИЗ
		|	ВТ_ИсчисленныеООСМС КАК ТабличнаяЧастьООСМС
		|
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|			ПО ИСТИНА
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		|			СведенияОДоходахООСМС.НомерСтроки КАК НомерСтроки,
		|			СведенияОДоходахООСМС.ФизЛицо КАК ФизЛицо,
		|			СведенияОДоходахООСМС.ПериодРегистрации КАК ПериодРегистрации,
		|			СведенияОДоходахООСМС.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода,
		|			СведенияОДоходахООСМС.ПериодДоходов КАК ПериодДоходов,
		|			СУММА(СведенияОДоходахООСМС.ОблагаемыйДоход) КАК ОблагаемыйДоход
		|		ИЗ
		|			ВТ_СведенияОДоходахООСМС КАК СведенияОДоходахООСМС
		|		
		|		СГРУППИРОВАТЬ ПО
		|			СведенияОДоходахООСМС.НомерСтроки,
		|			СведенияОДоходахООСМС.ФизЛицо,
		|			СведенияОДоходахООСМС.ПериодРегистрации,
		|			СведенияОДоходахООСМС.МесяцНалоговогоПериода,
		|			СведенияОДоходахООСМС.ПериодДоходов) КАК ОбщаяСуммаДоходов
		|		ПО ТабличнаяЧастьООСМС.НомерСтроки = ОбщаяСуммаДоходов.НомерСтроки
		|			И ТабличнаяЧастьООСМС.ФизЛицо = ОбщаяСуммаДоходов.ФизЛицо
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СведенияОДоходахООСМС КАК СведенияОДоходахООСМС
		|		ПО ТабличнаяЧастьООСМС.ФизЛицо = СведенияОДоходахООСМС.ФизЛицо
		|			И ТабличнаяЧастьООСМС.НомерСтроки = СведенияОДоходахООСМС.НомерСтроки
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПорядокОкругленияРезультатовРасчетаЗарплаты.СрезПоследних(&Период, ВидРасчета = НЕОПРЕДЕЛЕНО) КАК ОбщийПорядокОкругления
		|		ПО (ИСТИНА)
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПорядокОкругленияРезультатовРасчетаЗарплаты.СрезПоследних(&Период, ) КАК ИндивидуальныйПорядокОкругления
		|		ПО (ИндивидуальныйПорядокОкругления.ВидРасчета = ЗНАЧЕНИЕ(Справочник.НалогиСборыОтчисления.ОбязательныеСоциальныеОтчисления))
		|
		|УПОРЯДОЧИТЬ ПО
		|	НомерСтроки,
		|	ФизЛицо,
		|	МесяцНалоговогоПериода
		|ИТОГИ
		|	МАКСИМУМ(Отчисление),
		|	МАКСИМУМ(ОблагаемаяБаза),
		|	МАКСИМУМ(ПорядокОкругления),
		|	МАКСИМУМ(МетодОкругления)
		|ПО
		|	НомерСтроки";
		
	РезультатЗапросаООСМС = ЗапросРаспределения.Выполнить();;
	
	// Ключевое поле
	КолонкаДляПоиска = "НомерСтроки";
	
	// Сформируем структуру таблицы для промежуточного хранения результатов распределения СО
	ТаблицаРаспределенияООСМС = Новый ТаблицаЗначений();
	МассивТипов = Новый Массив; 
	МассивТипов.Добавить(Тип("Число"));
	ТаблицаРаспределенияООСМС.Колонки.Добавить("НомерСтроки", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(10)));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ФизическиеЛица"));
	ТаблицаРаспределенияООСМС.Колонки.Добавить("ФизЛицо", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ПодразделенияОрганизаций"));
	МассивТипов.Добавить(Тип("СправочникСсылка.Организации"));
	ТаблицаРаспределенияООСМС.Колонки.Добавить("СтруктурнаяЕдиница", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.Организации"));
	ТаблицаРаспределенияООСМС.Колонки.Добавить("Организация", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("СправочникСсылка.ПодразделенияОрганизаций"));
	ТаблицаРаспределенияООСМС.Колонки.Добавить("ПодразделениеОрганизации", Новый ОписаниеТипов(МассивТипов));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("Дата"));
	ТаблицаРаспределенияООСМС.Колонки.Добавить("МесяцНалоговогоПериода", Новый ОписаниеТипов(МассивТипов, Новый КвалификаторыДаты(ЧастиДаты.Дата)));
	МассивТипов.Очистить();
	МассивТипов.Добавить(Тип("Число"));
	ТаблицаРаспределенияООСМС.Колонки.Добавить("Отчисление", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(15,2)));
	ТаблицаРаспределенияООСМС.Колонки.Добавить("ОблагаемаяБаза", Новый ОписаниеТипов(МассивТипов, , , Новый КвалификаторыЧисла(15,2)));

	// Распределяемые значения
	КолонкиДляРаспределения = Новый Массив;
	КолонкиДляРаспределения.Добавить("Отчисление");
	КолонкиДляРаспределения.Добавить("ОблагаемаяБаза");
	
	КолонкаКоэффициентов = "ОблагаемыйДоход";
	ПроведениеРасчетовСервер.РаспределитьНалогиВзносыУдержанияПоСтруктурнымЕдиницам(ТаблицаРаспределенияООСМС, РезультатЗапросаООСМС, КолонкиДляРаспределения, КолонкаДляПоиска, КолонкаКоэффициентов);	
	
	ТаблицаРаспределенияООСМС.Свернуть("НомерСтроки, ФизЛицо, СтруктурнаяЕдиница, Организация, ПодразделениеОрганизации, МесяцНалоговогоПериода", 
									"Отчисление, ОблагаемаяБаза");
									
	// Финальный запрос
	Запрос.УстановитьПараметр("ТаблицаСО", ТаблицаРаспределенияСО);
	Запрос.УстановитьПараметр("ТаблицаСН", ТаблицаРаспределенияСН);
	Запрос.УстановитьПараметр("ТаблицаОППВ", ТаблицаРаспределенияОППВ);
	Запрос.УстановитьПараметр("ТаблицаОПВР", ТаблицаРаспределенияОПВР);
	Запрос.УстановитьПараметр("ТаблицаООСМС", ТаблицаРаспределенияООСМС);
	
	Запрос.МенеджерВременныхТаблиц = ЗапросРаспределения.МенеджерВременныхТаблиц;
	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ТаблицаСО.НомерСтроки,
	|	ТаблицаСО.ФизЛицо,
	|	ТаблицаСО.СтруктурнаяЕдиница,
	|	ТаблицаСО.Организация,
	|	ТаблицаСО.ПодразделениеОрганизации,
	|	ТаблицаСО.МесяцНалоговогоПериода,
	|	ТаблицаСО.Отчисление КАК Отчисление,
	|	ТаблицаСО.ОблагаемаяБаза
	|ПОМЕСТИТЬ ВТ_ДанныеРаспределенияСО
	|ИЗ
	|	&ТаблицаСО КАК ТаблицаСО
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаСН.НомерСтроки,
	|	ТаблицаСН.ФизЛицо,
	|	ТаблицаСН.СтруктурнаяЕдиница,
	|	ТаблицаСН.Организация,
	|	ТаблицаСН.ПодразделениеОрганизации,
	|	ТаблицаСН.МесяцНалоговогоПериода,
	|	ТаблицаСН.Налог,
	|	ТаблицаСН.ОблагаемаяБаза
	|ПОМЕСТИТЬ ВТ_ДанныеРаспределенияСН
	|ИЗ
	|	&ТаблицаСН КАК ТаблицаСН
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаОППВ.НомерСтроки,
	|	ТаблицаОППВ.ФизЛицо,
	|	ТаблицаОППВ.СтруктурнаяЕдиница,
	|	ТаблицаОППВ.Организация,
	|	ТаблицаОППВ.ПодразделениеОрганизации,
	|	ТаблицаОППВ.МесяцНалоговогоПериода,
	|	ТаблицаОППВ.Взнос,
	|	ТаблицаОППВ.ОблагаемаяБаза
	|ПОМЕСТИТЬ ВТ_ДанныеРаспределенияОППВ
	|ИЗ
	|	&ТаблицаОППВ КАК ТаблицаОППВ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаОПВР.НомерСтроки,
	|	ТаблицаОПВР.ФизЛицо,
	|	ТаблицаОПВР.СтруктурнаяЕдиница,
	|	ТаблицаОПВР.Организация,
	|	ТаблицаОПВР.ПодразделениеОрганизации,
	|	ТаблицаОПВР.МесяцНалоговогоПериода,
	|	ТаблицаОПВР.Взнос,
	|	ТаблицаОПВР.ОблагаемаяБаза
	|ПОМЕСТИТЬ ВТ_ДанныеРаспределенияОПВР
	|ИЗ
	|	&ТаблицаОПВР КАК ТаблицаОПВР
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаООСМС.НомерСтроки,
	|	ТаблицаООСМС.ФизЛицо,
	|	ТаблицаООСМС.СтруктурнаяЕдиница,
	|	ТаблицаООСМС.Организация,
	|	ТаблицаООСМС.ПодразделениеОрганизации,
	|	ТаблицаООСМС.МесяцНалоговогоПериода,
	|	ТаблицаООСМС.Отчисление,
	|	ТаблицаООСМС.ОблагаемаяБаза
	|ПОМЕСТИТЬ ВТ_ДанныеРаспределенияООСМС
	|ИЗ
	|	&ТаблицаООСМС КАК ТаблицаООСМС";
	
	Запрос.Выполнить();
	
	НомераТаблиц.Вставить("ИсчисленныеСО", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ИсчисленныйСН", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ИсчисленныйОППВ", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ИсчисленныйОПВР", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ИсчисленныеООСМС", НомераТаблиц.Количество());

	НомераТаблиц.Вставить("СОСведенияОДоходах", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("СНСведенияОДоходах", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ОППВСведенияОДоходах", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ОПВРСведенияОДоходах", НомераТаблиц.Количество());
	НомераТаблиц.Вставить("ООСМССведенияОДоходах", НомераТаблиц.Количество());

	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	""ИсчисленныеСО"" КАК ВидСтрокиЗапроса,
	|	&Окончание КАК Период,
	|	ЕСТЬNULL(ТаблицаСО.ФизЛицо, РанееИсчисленныеСО.ФизЛицо) КАК ФизЛицо,
	|	ЕСТЬNULL(ТаблицаСО.СтруктурнаяЕдиница, РанееИсчисленныеСО.СтруктурнаяЕдиница) КАК СтруктурнаяЕдиница,
	|	ЕСТЬNULL(ТаблицаСО.ПодразделениеОрганизации, РанееИсчисленныеСО.ПодразделениеОрганизации) КАК ПодразделениеОрганизации,
	|	ЕСТЬNULL(ТаблицаСО.МесяцНалоговогоПериода, РанееИсчисленныеСО.МесяцНалоговогоПериода) КАК МесяцНалоговогоПериода,
	|	СУММА((ЕСТЬNULL(ТаблицаСО.Отчисление, 0) - ЕСТЬNULL(РанееИсчисленныеСО.Отчисление, 0))) КАК Отчисление,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог) КАК ВидПлатежа,
	|	ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление) КАК ВидСтроки
	|ИЗ
	|	ВТ_ДанныеРаспределенияСО КАК ТаблицаСО
	|		
	|	ПОЛНОЕ СОЕДИНЕНИЕ ВТ_РанееИсчисленныеСО КАК РанееИсчисленныеСО
	|		ПО ТаблицаСО.НомерСтроки =  РанееИсчисленныеСО.НомерСтроки
	|			И ТаблицаСО.СтруктурнаяЕдиница =  РанееИсчисленныеСО.СтруктурнаяЕдиница
	|			И ТаблицаСО.ПодразделениеОрганизации =  РанееИсчисленныеСО.ПодразделениеОрганизации
	|
	|ГДЕ
	|	(ЕСТЬNULL(ТаблицаСО.Отчисление, 0) - ЕСТЬNULL(РанееИсчисленныеСО.Отчисление, 0)) <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	ЕСТЬNULL(ТаблицаСО.ФизЛицо, РанееИсчисленныеСО.ФизЛицо),
	|	ЕСТЬNULL(ТаблицаСО.СтруктурнаяЕдиница, РанееИсчисленныеСО.СтруктурнаяЕдиница),
	|	ЕСТЬNULL(ТаблицаСО.ПодразделениеОрганизации, РанееИсчисленныеСО.ПодразделениеОрганизации),
	|	ЕСТЬNULL(ТаблицаСО.МесяцНалоговогоПериода, РанееИсчисленныеСО.МесяцНалоговогоПериода)
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""ИсчисленныйСН"" КАК ВидСтрокиЗапроса,
	|	&Окончание КАК Период,
	|	ЕСТЬNULL(ТаблицаСН.ФизЛицо, РанееИсчисленныйСН.ФизЛицо) КАК ФизЛицо,
	|	ЕСТЬNULL(ТаблицаСН.СтруктурнаяЕдиница, РанееИсчисленныйСН.СтруктурнаяЕдиница) КАК СтруктурнаяЕдиница,
	|	ЕСТЬNULL(ТаблицаСН.ПодразделениеОрганизации, РанееИсчисленныйСН.ПодразделениеОрганизации) КАК ПодразделениеОрганизации,
	|	ЕСТЬNULL(ТаблицаСН.МесяцНалоговогоПериода, РанееИсчисленныйСН.МесяцНалоговогоПериода) КАК МесяцНалоговогоПериода,
	|	СУММА((ЕСТЬNULL(ТаблицаСН.Налог, 0) - ЕСТЬNULL(РанееИсчисленныйСН.Налог, 0))) КАК Налог,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог) КАК ВидПлатежа,
	|	ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление) КАК ВидСтроки
	|ИЗ
	|	ВТ_ДанныеРаспределенияСН КАК ТаблицаСН
	|
	|	ПОЛНОЕ СОЕДИНЕНИЕ ВТ_РанееИсчисленныйСН КАК РанееИсчисленныйСН
	|		ПО ТаблицаСН.НомерСтроки =  РанееИсчисленныйСН.НомерСтроки
	|			И ТаблицаСН.СтруктурнаяЕдиница =  РанееИсчисленныйСН.СтруктурнаяЕдиница
	|			И ТаблицаСН.ПодразделениеОрганизации =  РанееИсчисленныйСН.ПодразделениеОрганизации
	|
	|ГДЕ
	|	(ЕСТЬNULL(ТаблицаСН.Налог, 0) - ЕСТЬNULL(РанееИсчисленныйСН.Налог, 0)) <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	ЕСТЬNULL(ТаблицаСН.ФизЛицо, РанееИсчисленныйСН.ФизЛицо),
	|	ЕСТЬNULL(ТаблицаСН.СтруктурнаяЕдиница, РанееИсчисленныйСН.СтруктурнаяЕдиница),
	|	ЕСТЬNULL(ТаблицаСН.ПодразделениеОрганизации, РанееИсчисленныйСН.ПодразделениеОрганизации),
	|	ЕСТЬNULL(ТаблицаСН.МесяцНалоговогоПериода, РанееИсчисленныйСН.МесяцНалоговогоПериода)
	|;                                                                                
	|//////////////////////////////////////////////////////////////////////////////// 
	|ВЫБРАТЬ
	|	""ИсчисленныйОППВ"" КАК ВидСтрокиЗапроса,
	|	&Окончание КАК Период,
	|	ЕСТЬNULL(ТаблицаОППВ.ФизЛицо, РанееИсчисленныйОППВ.ФизЛицо) КАК ФизЛицо,
	|	ЕСТЬNULL(ТаблицаОППВ.СтруктурнаяЕдиница, РанееИсчисленныйОППВ.СтруктурнаяЕдиница) КАК СтруктурнаяЕдиница,
	|	ЕСТЬNULL(ТаблицаОППВ.ПодразделениеОрганизации, РанееИсчисленныйОППВ.ПодразделениеОрганизации) КАК ПодразделениеОрганизации,
	|	ЕСТЬNULL(ТаблицаОППВ.МесяцНалоговогоПериода, РанееИсчисленныйОППВ.МесяцНалоговогоПериода) КАК МесяцНалоговогоПериода,
	|	СУММА((ЕСТЬNULL(ТаблицаОППВ.Взнос, 0) - ЕСТЬNULL(РанееИсчисленныйОППВ.Взнос, 0))) КАК Взнос,
	|	ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление) КАК ВидСтроки,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог) КАК ВидПлатежа
	|ИЗ
	|	ВТ_ДанныеРаспределенияОППВ КАК ТаблицаОППВ
	|
	|	ПОЛНОЕ СОЕДИНЕНИЕ ВТ_РанееИсчисленныйОППВ КАК РанееИсчисленныйОППВ
	|		ПО ТаблицаОППВ.НомерСтроки =  РанееИсчисленныйОППВ.НомерСтроки
	|			И ТаблицаОППВ.СтруктурнаяЕдиница =  РанееИсчисленныйОППВ.СтруктурнаяЕдиница
	|			И ТаблицаОППВ.ПодразделениеОрганизации =  РанееИсчисленныйОППВ.ПодразделениеОрганизации
	|
	|ГДЕ
	|	(ЕСТЬNULL(ТаблицаОППВ.Взнос, 0) - ЕСТЬNULL(РанееИсчисленныйОППВ.Взнос, 0)) <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	ЕСТЬNULL(ТаблицаОППВ.ФизЛицо, РанееИсчисленныйОППВ.ФизЛицо),
	|	ЕСТЬNULL(ТаблицаОППВ.СтруктурнаяЕдиница, РанееИсчисленныйОППВ.СтруктурнаяЕдиница),
	|	ЕСТЬNULL(ТаблицаОППВ.ПодразделениеОрганизации, РанееИсчисленныйОППВ.ПодразделениеОрганизации),
	|	ЕСТЬNULL(ТаблицаОППВ.МесяцНалоговогоПериода, РанееИсчисленныйОППВ.МесяцНалоговогоПериода)
	|;                                                                                
	|//////////////////////////////////////////////////////////////////////////////// 
	|ВЫБРАТЬ
	|	""ИсчисленныйОПВР"" КАК ВидСтрокиЗапроса,
	|	&Окончание КАК Период,
	|	ЕСТЬNULL(ТаблицаОПВР.ФизЛицо, РанееИсчисленныйОПВР.ФизЛицо) КАК ФизЛицо,
	|	ЕСТЬNULL(ТаблицаОПВР.СтруктурнаяЕдиница, РанееИсчисленныйОПВР.СтруктурнаяЕдиница) КАК СтруктурнаяЕдиница,
	|	ЕСТЬNULL(ТаблицаОПВР.ПодразделениеОрганизации, РанееИсчисленныйОПВР.ПодразделениеОрганизации) КАК ПодразделениеОрганизации,
	|	ЕСТЬNULL(ТаблицаОПВР.МесяцНалоговогоПериода, РанееИсчисленныйОПВР.МесяцНалоговогоПериода) КАК МесяцНалоговогоПериода,
	|	СУММА((ЕСТЬNULL(ТаблицаОПВР.Взнос, 0) - ЕСТЬNULL(РанееИсчисленныйОПВР.Взнос, 0))) КАК Взнос,
	|	ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление) КАК ВидСтроки,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог) КАК ВидПлатежа
	|ИЗ
	|	ВТ_ДанныеРаспределенияОПВР КАК ТаблицаОПВР
	|
	|	ПОЛНОЕ СОЕДИНЕНИЕ ВТ_РанееИсчисленныйОПВР КАК РанееИсчисленныйОПВР
	|		ПО ТаблицаОПВР.НомерСтроки =  РанееИсчисленныйОПВР.НомерСтроки
	|			И ТаблицаОПВР.СтруктурнаяЕдиница =  РанееИсчисленныйОПВР.СтруктурнаяЕдиница
	|			И ТаблицаОПВР.ПодразделениеОрганизации =  РанееИсчисленныйОПВР.ПодразделениеОрганизации
	|
	|ГДЕ
	|	(ЕСТЬNULL(ТаблицаОПВР.Взнос, 0) - ЕСТЬNULL(РанееИсчисленныйОПВР.Взнос, 0)) <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	ЕСТЬNULL(ТаблицаОПВР.ФизЛицо, РанееИсчисленныйОПВР.ФизЛицо),
	|	ЕСТЬNULL(ТаблицаОПВР.СтруктурнаяЕдиница, РанееИсчисленныйОПВР.СтруктурнаяЕдиница),
	|	ЕСТЬNULL(ТаблицаОПВР.ПодразделениеОрганизации, РанееИсчисленныйОПВР.ПодразделениеОрганизации),
	|	ЕСТЬNULL(ТаблицаОПВР.МесяцНалоговогоПериода, РанееИсчисленныйОПВР.МесяцНалоговогоПериода)
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""ИсчисленныеООСМС"" КАК ВидСтрокиЗапроса,
	|	&Окончание КАК Период,
	|	ЕСТЬNULL(ТаблицаООСМС.ФизЛицо, РанееИсчисленныеООСМС.ФизЛицо) КАК ФизЛицо,
	|	ЕСТЬNULL(ТаблицаООСМС.СтруктурнаяЕдиница, РанееИсчисленныеООСМС.СтруктурнаяЕдиница) КАК СтруктурнаяЕдиница,
	|	ЕСТЬNULL(ТаблицаООСМС.ПодразделениеОрганизации, РанееИсчисленныеООСМС.ПодразделениеОрганизации) КАК ПодразделениеОрганизации,
	|	ЕСТЬNULL(ТаблицаООСМС.МесяцНалоговогоПериода, РанееИсчисленныеООСМС.МесяцНалоговогоПериода) КАК МесяцНалоговогоПериода,
	|	СУММА((ЕСТЬNULL(ТаблицаООСМС.Отчисление, 0) - ЕСТЬNULL(РанееИсчисленныеООСМС.Отчисление, 0))) КАК Отчисление,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог) КАК ВидПлатежа,
	|	ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление) КАК ВидСтроки
	|ИЗ
	|	ВТ_ДанныеРаспределенияООСМС КАК ТаблицаООСМС
	|		
	|	ПОЛНОЕ СОЕДИНЕНИЕ ВТ_РанееИсчисленныеООСМС КАК РанееИсчисленныеООСМС
	|		ПО ТаблицаООСМС.НомерСтроки =  РанееИсчисленныеООСМС.НомерСтроки
	|			И ТаблицаООСМС.СтруктурнаяЕдиница =  РанееИсчисленныеООСМС.СтруктурнаяЕдиница
	|			И ТаблицаООСМС.ПодразделениеОрганизации =  РанееИсчисленныеООСМС.ПодразделениеОрганизации
	|
	|ГДЕ
	|	(ЕСТЬNULL(ТаблицаООСМС.Отчисление, 0) - ЕСТЬNULL(РанееИсчисленныеООСМС.Отчисление, 0)) <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	ЕСТЬNULL(ТаблицаООСМС.ФизЛицо, РанееИсчисленныеООСМС.ФизЛицо),
	|	ЕСТЬNULL(ТаблицаООСМС.СтруктурнаяЕдиница, РанееИсчисленныеООСМС.СтруктурнаяЕдиница),
	|	ЕСТЬNULL(ТаблицаООСМС.ПодразделениеОрганизации, РанееИсчисленныеООСМС.ПодразделениеОрганизации),
	|	ЕСТЬNULL(ТаблицаООСМС.МесяцНалоговогоПериода, РанееИсчисленныеООСМС.МесяцНалоговогоПериода)
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""СОСведенияОДоходах"" КАК ВидСтрокиЗапроса,
	|	&Окончание КАК Период,
	|	ЕСТЬNULL(ТаблицаСО.ФизЛицо, РанееИсчисленныеСО.ФизЛицо) КАК ФизЛицо,
	|	ЕСТЬNULL(ТаблицаСО.СтруктурнаяЕдиница, РанееИсчисленныеСО.СтруктурнаяЕдиница) КАК СтруктурнаяЕдиница,
	|	ЕСТЬNULL(ТаблицаСО.ПодразделениеОрганизации, РанееИсчисленныеСО.ПодразделениеОрганизации) КАК ПодразделениеОрганизации,
	|	ЕСТЬNULL(ТаблицаСО.МесяцНалоговогоПериода, РанееИсчисленныеСО.МесяцНалоговогоПериода) КАК МесяцНалоговогоПериода,
	|	СУММА(ЕСТЬNULL(ТаблицаСО.ОблагаемаяБаза, 0) - ЕСТЬNULL(РанееИсчисленныеСО.ОблагаемаяБаза, 0)) КАК ОблагаемаяБаза,
	|	ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.ОблагаетсяЦеликом) КАК ОблагаетсяЦеликом
	|ИЗ
	|	ВТ_ДанныеРаспределенияСО КАК ТаблицаСО
	|		
	|	ПОЛНОЕ СОЕДИНЕНИЕ ВТ_РанееИсчисленныеСО КАК РанееИсчисленныеСО
	|		ПО ТаблицаСО.НомерСтроки =  РанееИсчисленныеСО.НомерСтроки
	|			И ТаблицаСО.СтруктурнаяЕдиница =  РанееИсчисленныеСО.СтруктурнаяЕдиница
	|			И ТаблицаСО.ПодразделениеОрганизации =  РанееИсчисленныеСО.ПодразделениеОрганизации
	|
	|ГДЕ
	|	(ЕСТЬNULL(ТаблицаСО.ОблагаемаяБаза, 0) - ЕСТЬNULL(РанееИсчисленныеСО.ОблагаемаяБаза, 0)) <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	ЕСТЬNULL(ТаблицаСО.ФизЛицо, РанееИсчисленныеСО.ФизЛицо),
	|	ЕСТЬNULL(ТаблицаСО.СтруктурнаяЕдиница, РанееИсчисленныеСО.СтруктурнаяЕдиница),
	|	ЕСТЬNULL(ТаблицаСО.ПодразделениеОрганизации, РанееИсчисленныеСО.ПодразделениеОрганизации),
	|	ЕСТЬNULL(ТаблицаСО.МесяцНалоговогоПериода, РанееИсчисленныеСО.МесяцНалоговогоПериода)
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""СНСведенияОДоходах"" КАК ВидСтрокиЗапроса,
	|	&Окончание КАК Период,
	|	ЕСТЬNULL(ТаблицаСН.ФизЛицо, РанееИсчисленныйСН.ФизЛицо) КАК ФизЛицо,
	|	ЕСТЬNULL(ТаблицаСН.СтруктурнаяЕдиница, РанееИсчисленныйСН.СтруктурнаяЕдиница) КАК СтруктурнаяЕдиница,
	|	ЕСТЬNULL(ТаблицаСН.ПодразделениеОрганизации, РанееИсчисленныйСН.ПодразделениеОрганизации) КАК ПодразделениеОрганизации,
	|	ЕСТЬNULL(ТаблицаСН.МесяцНалоговогоПериода, РанееИсчисленныйСН.МесяцНалоговогоПериода) КАК МесяцНалоговогоПериода,
	|	СУММА((ЕСТЬNULL(ТаблицаСН.ОблагаемаяБаза, 0) - ЕСТЬNULL(РанееИсчисленныйСН.ОблагаемаяБаза, 0))) КАК ОблагаемаяБаза,
	|	ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.ОблагаетсяЦеликом) КАК ОблагаетсяЦеликом,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог) КАК ВидПлатежа,
	|	ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление) КАК ВидСтроки
	|ИЗ
	|	ВТ_ДанныеРаспределенияСН КАК ТаблицаСН
	|
	|	ПОЛНОЕ СОЕДИНЕНИЕ ВТ_РанееИсчисленныйСН КАК РанееИсчисленныйСН
	|		ПО ТаблицаСН.НомерСтроки =  РанееИсчисленныйСН.НомерСтроки
	|			И ТаблицаСН.СтруктурнаяЕдиница =  РанееИсчисленныйСН.СтруктурнаяЕдиница
	|			И ТаблицаСН.ПодразделениеОрганизации =  РанееИсчисленныйСН.ПодразделениеОрганизации
	|
	|ГДЕ
	|	(ЕСТЬNULL(ТаблицаСН.ОблагаемаяБаза, 0) - ЕСТЬNULL(РанееИсчисленныйСН.ОблагаемаяБаза, 0)) <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	ЕСТЬNULL(ТаблицаСН.ФизЛицо, РанееИсчисленныйСН.ФизЛицо),
	|	ЕСТЬNULL(ТаблицаСН.СтруктурнаяЕдиница, РанееИсчисленныйСН.СтруктурнаяЕдиница),
	|	ЕСТЬNULL(ТаблицаСН.ПодразделениеОрганизации, РанееИсчисленныйСН.ПодразделениеОрганизации),
	|	ЕСТЬNULL(ТаблицаСН.МесяцНалоговогоПериода, РанееИсчисленныйСН.МесяцНалоговогоПериода)
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""ОППВСведенияОДоходах"" КАК ВидСтрокиЗапроса,
	|	&Окончание КАК Период,
	|	ЕСТЬNULL(ТаблицаОППВ.ФизЛицо, РанееИсчисленныйОППВ.ФизЛицо) КАК ФизЛицо,
	|	ЕСТЬNULL(ТаблицаОППВ.СтруктурнаяЕдиница, РанееИсчисленныйОППВ.СтруктурнаяЕдиница) КАК СтруктурнаяЕдиница,
	|	ЕСТЬNULL(ТаблицаОППВ.ПодразделениеОрганизации, РанееИсчисленныйОППВ.ПодразделениеОрганизации) КАК ПодразделениеОрганизации,
	|	ЕСТЬNULL(ТаблицаОППВ.МесяцНалоговогоПериода, РанееИсчисленныйОППВ.МесяцНалоговогоПериода) КАК МесяцНалоговогоПериода,
	|	СУММА(ЕСТЬNULL(ТаблицаОППВ.ОблагаемаяБаза, 0) - ЕСТЬNULL(РанееИсчисленныйОППВ.ОблагаемаяБаза, 0)) КАК ОблагаемаяБаза,
	|	ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.ОблагаетсяЦеликом) КАК ОблагаетсяЦеликом,
	|	ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление) КАК ВидСтроки,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог) КАК ВидПлатежа
	|ИЗ
	|	ВТ_ДанныеРаспределенияОППВ КАК ТаблицаОППВ
	|
	|	ПОЛНОЕ СОЕДИНЕНИЕ ВТ_РанееИсчисленныйОППВ КАК РанееИсчисленныйОППВ
	|		ПО ТаблицаОППВ.НомерСтроки =  РанееИсчисленныйОППВ.НомерСтроки
	|			И ТаблицаОППВ.СтруктурнаяЕдиница =  РанееИсчисленныйОППВ.СтруктурнаяЕдиница
	|			И ТаблицаОППВ.ПодразделениеОрганизации =  РанееИсчисленныйОППВ.ПодразделениеОрганизации
	|
	|ГДЕ
	|	(ЕСТЬNULL(ТаблицаОППВ.ОблагаемаяБаза, 0) - ЕСТЬNULL(РанееИсчисленныйОППВ.ОблагаемаяБаза, 0)) <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	ЕСТЬNULL(ТаблицаОППВ.ФизЛицо, РанееИсчисленныйОППВ.ФизЛицо),
	|	ЕСТЬNULL(ТаблицаОППВ.СтруктурнаяЕдиница, РанееИсчисленныйОППВ.СтруктурнаяЕдиница),
	|	ЕСТЬNULL(ТаблицаОППВ.ПодразделениеОрганизации, РанееИсчисленныйОППВ.ПодразделениеОрганизации),
	|	ЕСТЬNULL(ТаблицаОППВ.МесяцНалоговогоПериода, РанееИсчисленныйОППВ.МесяцНалоговогоПериода)
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""ОПВРСведенияОДоходах"" КАК ВидСтрокиЗапроса,
	|	&Окончание КАК Период,
	|	ЕСТЬNULL(ТаблицаОПВР.ФизЛицо, РанееИсчисленныйОПВР.ФизЛицо) КАК ФизЛицо,
	|	ЕСТЬNULL(ТаблицаОПВР.СтруктурнаяЕдиница, РанееИсчисленныйОПВР.СтруктурнаяЕдиница) КАК СтруктурнаяЕдиница,
	|	ЕСТЬNULL(ТаблицаОПВР.ПодразделениеОрганизации, РанееИсчисленныйОПВР.ПодразделениеОрганизации) КАК ПодразделениеОрганизации,
	|	ЕСТЬNULL(ТаблицаОПВР.МесяцНалоговогоПериода, РанееИсчисленныйОПВР.МесяцНалоговогоПериода) КАК МесяцНалоговогоПериода,
	|	СУММА(ЕСТЬNULL(ТаблицаОПВР.ОблагаемаяБаза, 0) - ЕСТЬNULL(РанееИсчисленныйОПВР.ОблагаемаяБаза, 0)) КАК ОблагаемаяБаза,
	|	ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.ОблагаетсяЦеликом) КАК ОблагаетсяЦеликом,
	|	ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление) КАК ВидСтроки,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог) КАК ВидПлатежа
	|ИЗ
	|	ВТ_ДанныеРаспределенияОПВР КАК ТаблицаОПВР
	|
	|	ПОЛНОЕ СОЕДИНЕНИЕ ВТ_РанееИсчисленныйОПВР КАК РанееИсчисленныйОПВР
	|		ПО ТаблицаОПВР.НомерСтроки = РанееИсчисленныйОПВР.НомерСтроки
	|			И ТаблицаОПВР.СтруктурнаяЕдиница =  РанееИсчисленныйОПВР.СтруктурнаяЕдиница
	|			И ТаблицаОПВР.ПодразделениеОрганизации =  РанееИсчисленныйОПВР.ПодразделениеОрганизации
	|
	|ГДЕ
	|	(ЕСТЬNULL(ТаблицаОПВР.ОблагаемаяБаза, 0) - ЕСТЬNULL(РанееИсчисленныйОПВР.ОблагаемаяБаза, 0)) <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	ЕСТЬNULL(ТаблицаОПВР.ФизЛицо, РанееИсчисленныйОПВР.ФизЛицо),
	|	ЕСТЬNULL(ТаблицаОПВР.СтруктурнаяЕдиница, РанееИсчисленныйОПВР.СтруктурнаяЕдиница),
	|	ЕСТЬNULL(ТаблицаОПВР.ПодразделениеОрганизации, РанееИсчисленныйОПВР.ПодразделениеОрганизации),
	|	ЕСТЬNULL(ТаблицаОПВР.МесяцНалоговогоПериода, РанееИсчисленныйОПВР.МесяцНалоговогоПериода)
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	""ООСМССведенияОДоходах"" КАК ВидСтрокиЗапроса,
	|	&Окончание КАК Период,
	|	ЕСТЬNULL(ТаблицаООСМС.ФизЛицо, РанееИсчисленныеООСМС.ФизЛицо) КАК ФизЛицо,
	|	ЕСТЬNULL(ТаблицаООСМС.СтруктурнаяЕдиница, РанееИсчисленныеООСМС.СтруктурнаяЕдиница) КАК СтруктурнаяЕдиница,
	|	ЕСТЬNULL(ТаблицаООСМС.ПодразделениеОрганизации, РанееИсчисленныеООСМС.ПодразделениеОрганизации) КАК ПодразделениеОрганизации,
	|	ЕСТЬNULL(ТаблицаООСМС.МесяцНалоговогоПериода, РанееИсчисленныеООСМС.МесяцНалоговогоПериода) КАК МесяцНалоговогоПериода,
	|	СУММА(ЕСТЬNULL(ТаблицаООСМС.ОблагаемаяБаза, 0) - ЕСТЬNULL(РанееИсчисленныеООСМС.ОблагаемаяБаза, 0)) КАК ОблагаемаяБаза,
	|	ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.ОблагаетсяЦеликом) КАК ОблагаетсяЦеликом
	|ИЗ
	|	ВТ_ДанныеРаспределенияООСМС КАК ТаблицаООСМС
	|		
	|	ПОЛНОЕ СОЕДИНЕНИЕ ВТ_РанееИсчисленныеООСМС КАК РанееИсчисленныеООСМС
	|		ПО ТаблицаООСМС.НомерСтроки =  РанееИсчисленныеООСМС.НомерСтроки
	|			И ТаблицаООСМС.СтруктурнаяЕдиница =  РанееИсчисленныеООСМС.СтруктурнаяЕдиница
	|			И ТаблицаООСМС.ПодразделениеОрганизации =  РанееИсчисленныеООСМС.ПодразделениеОрганизации
	|
	|ГДЕ
	|	(ЕСТЬNULL(ТаблицаООСМС.ОблагаемаяБаза, 0) - ЕСТЬNULL(РанееИсчисленныеООСМС.ОблагаемаяБаза, 0)) <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	ЕСТЬNULL(ТаблицаООСМС.ФизЛицо, РанееИсчисленныеООСМС.ФизЛицо),
	|	ЕСТЬNULL(ТаблицаООСМС.СтруктурнаяЕдиница, РанееИсчисленныеООСМС.СтруктурнаяЕдиница),
	|	ЕСТЬNULL(ТаблицаООСМС.ПодразделениеОрганизации, РанееИсчисленныеООСМС.ПодразделениеОрганизации),
	|	ЕСТЬNULL(ТаблицаООСМС.МесяцНалоговогоПериода, РанееИсчисленныеООСМС.МесяцНалоговогоПериода) 
	| ";
		
	Возврат ТекстЗапроса;
	 
КонецФункции

////////////////////////////////////////////////////////////////////////////////
// Интерфейс для работы с подсистемой Печать.

// Заполняет список команд печати.
// 
// Параметры:
//   КомандыПечати - ТаблицаЗначений - состав полей см. в функции УправлениеПечатью.СоздатьКоллекциюКомандПечати
//
Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
	
КонецПроцедуры

Функция ТекстЗапросаИсчисленныйОПВР(НомераТаблиц, Реквизиты) 
	
	НомераТаблиц.Вставить("ИсчисленныйОПВР", НомераТаблиц.Количество());
	ТекстЗапроса =  
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	&Окончание КАК Период,
		|	ВЫБОР
		|		КОГДА Реквизиты.ОтражениеПоПериодуРегистрации
		|			ТОГДА &Начало
		|		ИНАЧЕ СтрокаИсчисленныйОПВР.МесяцНалоговогоПериода
		|	КОНЕЦ КАК МесяцНалоговогоПериода,
		|	СтрокаИсчисленныйОПВР.ФизЛицо,
		|	СтрокаИсчисленныйОПВР.Взнос,
		|	ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление) КАК ВидСтроки,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог) КАК ВидПлатежа,
		|	СтрокаИсчисленныйОПВР.НомерСтроки,
		|	ВЫБОР
		|		КОГДА Реквизиты.ПоддержкаРаботыСоСтруктурнымиПодразделениями
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ(МестоРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|					ТОГДА МестоРаботы.СтруктурнаяЕдиница
		|				КОГДА НЕ (&СтруктурноеПодразделение = ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка))
		|					ТОГДА &СтруктурноеПодразделение
		|				ИНАЧЕ &ОбособленноеПодразделение
		|			КОНЕЦ
		|		ИНАЧЕ &ОбособленноеПодразделение 
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|	ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК ПодразделениеОрганизации
		|	
		|ИЗ
		|	ВТ_ИсчисленныйОПВР КАК СтрокаИсчисленныйОПВР
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|		ПО ИСТИНА
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестоРаботы
		|		ПО СтрокаИсчисленныйОПВР.ФизЛицо = МестоРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ СтрокаИсчисленныйОПВР.МесяцНалоговогоПериода КОНЕЦ) = МестоРаботы.Период
		|
		|ГДЕ
		|	СтрокаИсчисленныйОПВР.Взнос <> 0
		|
		|УПОРЯДОЧИТЬ ПО 
		|	СтрокаИсчисленныйОПВР.НомерСтроки
		|";

	Возврат ТекстЗапроса + ОбщегоНазначенияБКВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

Функция ТекстЗапросаОПВРСведенияОДоходах(НомераТаблиц, Реквизиты) 
	
	НомераТаблиц.Вставить("ОПВРСведенияОДоходах", НомераТаблиц.Количество());
	ТекстЗапроса =  
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ВЫБОР
		|		КОГДА Реквизиты.ОтражениеПоПериодуРегистрации
		|			ТОГДА &Период
		|		ИНАЧЕ СтрокаИсчисленныйОПВР.МесяцНалоговогоПериода
		|	КОНЕЦ КАК Период,
		|	&Начало КАК ПериодРегистрации,
		|	СтрокаИсчисленныйОПВР.ФизЛицо,
		|	СтрокаИсчисленныйОПВР.ОблагаемаяБаза,
		|	ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.ОблагаетсяЦеликом) КАК ОблагаетсяЦеликом,
		|	СтрокаИсчисленныйОПВР.НомерСтроки,
		|	ВЫБОР
		|		КОГДА Реквизиты.ПоддержкаРаботыСоСтруктурнымиПодразделениями
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ(МестоРаботы.СтруктурнаяЕдиница ЕСТЬ NULL)
		|					ТОГДА МестоРаботы.СтруктурнаяЕдиница
		|				КОГДА НЕ (&СтруктурноеПодразделение = ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка))
		|					ТОГДА &СтруктурноеПодразделение
		|				ИНАЧЕ &ОбособленноеПодразделение
		|			КОНЕЦ
		|		ИНАЧЕ &ОбособленноеПодразделение 
		|	КОНЕЦ КАК СтруктурнаяЕдиница,
		|	ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК ПодразделениеОрганизации
		|	
		|ИЗ
		|	ВТ_ИсчисленныйОПВР КАК СтрокаИсчисленныйОПВР
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Реквизиты КАК Реквизиты
		|		ПО ИСТИНА
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТ_МестоРаботы КАК МестоРаботы
		|		ПО СтрокаИсчисленныйОПВР.ФизЛицо = МестоРаботы.ФизЛицо
		|			И (ВЫБОР КОГДА Реквизиты.ОтражениеПоПериодуРегистрации ТОГДА &Период ИНАЧЕ СтрокаИсчисленныйОПВР.МесяцНалоговогоПериода КОНЕЦ) = МестоРаботы.Период
		|
		|ГДЕ 
		|	СтрокаИсчисленныйОПВР.ОблагаемаяБаза <> 0
		|
		|УПОРЯДОЧИТЬ ПО 
		|	СтрокаИсчисленныйОПВР.НомерСтроки
		|";

	Возврат ТекстЗапроса + ОбщегоНазначенияБКВызовСервера.ТекстРазделителяЗапросовПакета();
	
КонецФункции

#КонецЕсли
