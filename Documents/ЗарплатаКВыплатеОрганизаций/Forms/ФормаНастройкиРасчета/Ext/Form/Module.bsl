////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("РазмерОкругления") И ЗначениеЗаполнено(Параметры.РазмерОкругления) Тогда
		
		Округлять = Параметры.РазмерОкругления <> 1;
		
		Если Параметры.РазмерОкругления <> 1 Тогда
			РазмерОкругления = Параметры.РазмерОкругления;
			Округлять = Истина;
		Иначе
			РазмерОкругления = 1;
			Округлять = Ложь;
		КонецЕсли;
		
	КонецЕсли;
	
	Если  Параметры.Свойство("ПроцентВыплаты") И ЗначениеЗаполнено(Параметры.ПроцентВыплаты) Тогда
		ПроцентВыплаты	        = Параметры.ПроцентВыплаты;
	КонецЕсли;
	
	УправлениеФормой(ЭтаФорма, Параметры.ТолькоПросмотр);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ КОМАНД ФОРМЫ

&НаКлиенте
Процедура ОК(Команда)
	
	ЗаписатьФорму = Истина;
	ПараметрыОповещения = Новый Структура("РазмерОкругления, ПроцентВыплаты, ЗаписатьФорму", РазмерОкругления, ПроцентВыплаты, ЗаписатьФорму);
	Оповестить("НастройкаРасчетаСуммКВыплатеПередатьПараметры", ПараметрыОповещения, ЭтотОбъект);
	Закрыть();
	
КонецПроцедуры

&НаКлиенте
Процедура Рассчитать(Команда)
	
	Если Модифицированность Тогда
		
		ТекстВопроса = НСтр("ru= 'Перед расчетом необходимо сохранить документ. Продолжить?'");
		Режим = РежимДиалогаВопрос.ДаНет;
		Оповещение = Новый ОписаниеОповещения("ПослеЗакрытияВопросаПередРасчетом", ЭтотОбъект);
		ПоказатьВопрос(Оповещение, ТекстВопроса, Режим, 0);
		
	КонецЕсли;
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

&НаКлиенте  
Процедура ПослеЗакрытияВопросаПередРасчетом(Результат, Параметры) Экспорт
	
	Если Результат = КодВозвратаДиалога.Нет Тогда
		Возврат;
	Иначе
		ЗаписатьФорму = Истина;
	КонецЕсли;
	
	ПараметрыОповещения = Новый Структура("РазмерОкругления, ПроцентВыплаты, ЗаписатьФорму", РазмерОкругления, ПроцентВыплаты, ЗаписатьФорму);
	Оповестить("НастройкаРасчетаСуммКВыплате", ПараметрыОповещения, ЭтотОбъект);
	Закрыть();
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура УправлениеФормой(Форма, ТолькоПросмотр)
	
	Элементы = Форма.Элементы;
	
	Элементы.ОК.Доступность = НЕ ТолькоПросмотр;
	Элементы.Рассчитать.Доступность = НЕ ТолькоПросмотр;
	
КонецПроцедуры
