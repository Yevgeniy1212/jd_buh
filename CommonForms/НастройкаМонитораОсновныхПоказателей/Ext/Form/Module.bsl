#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// Получаем настройки
	ЗаполнитьЗначенияСвойств(ЭтаФорма, Параметры, 
	"СписокРазделов, 
	|ВариантОкругления, 
	|СравниватьСПрошлымПериодом,
	|ПоказыватьОборотыЗаТекущийМесяц,
	|ПоказыватьОборотыЗаПрошлыйМесяц,
	|ПоказыватьОборотыСНачалаГодаПоТекущийМесяц,
	|ПоказыватьОборотыСНачалаГодаПоПрошлыйМесяц");
	
	Для Каждого Раздел Из СписокРазделов Цикл
		Раздел.Представление = Раздел.Значение;
	КонецЦикла;
	
	ДополнитьПредставлениеОборотныхРазделов();
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура СохранитьИЗакрыть(Команда)
	
	Если НЕ ПоказыватьОборотыЗаТекущийМесяц
	   И НЕ ПоказыватьОборотыЗаПрошлыйМесяц
	   И НЕ ПоказыватьОборотыСНачалаГодаПоТекущийМесяц
	   И НЕ ПоказыватьОборотыСНачалаГодаПоПрошлыйМесяц Тогда
		
		ТекстОшибки = ОбщегоНазначенияКлиентСервер.ТекстОшибкиЗаполнения(
			"Поле", "Корректность", НСтр("ru='Показывать оброты за период'"),,, 
			НСтр("ru='Должен быть отмечен хотя бы один показатель.'"));
		ОбщегоНазначенияКлиент.СообщитьПользователю(ТекстОшибки,, "ПоказыватьОборотыЗаТекущийМесяц");
		
		Возврат;
	КонецЕсли;
	
	// Сохраняем настройки
	СохранитьНастройкиНаСервере();
	
	Закрыть(Модифицированность);
	
КонецПроцедуры

&НаКлиенте
Процедура Отмена(Команда)
	
	// Просто закрываем форму
	Закрыть(Ложь);
	
КонецПроцедуры

&НаКлиенте
Процедура УстановитьСтандартныеНастройки(Команда)
	
	ЗаполнитьСписокРазделовПоУмолчанию();
	ВариантОкругления 			               = 1000;
	СравниватьСПрошлымПериодом 	               = Ложь;
	Модифицированность 			               = Истина;
	ПоказыватьОборотыЗаТекущийМесяц            = Истина;
	ПоказыватьОборотыЗаПрошлыйМесяц            = Ложь;
	ПоказыватьОборотыСНачалаГодаПоТекущийМесяц = Истина;
	ПоказыватьОборотыСНачалаГодаПоПрошлыйМесяц = Ложь;
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ЗагрузитьСписокРазделов(Список)
	
	СписокРазделов.Очистить();
	
	Для каждого Раздел Из Список Цикл
		
		СписокРазделов.Добавить(Раздел.Значение, Раздел.Представление, Раздел.Пометка);
		
	КонецЦикла;
	
	ДополнитьПредставлениеОборотныхРазделов();
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСписокРазделовПоУмолчанию()
	
	СписокРазделовПоУмолчанию = МониторРуководителя.СписокРазделовМонитораРуководителяПоУмолчанию();
	Для Каждого Раздел Из СписокРазделовПоУмолчанию Цикл
		Раздел.Представление = Раздел.Значение;
	КонецЦикла;
	ЗагрузитьСписокРазделов(СписокРазделовПоУмолчанию);
	
КонецПроцедуры

&НаСервере
Процедура СохранитьНастройкиНаСервере()
	
	// Записываем настройки в хранилище
	Для Каждого Раздел из СписокРазделов Цикл
		Раздел.Представление = ОбщегоНазначения.ИмяЗначенияПеречисления(Раздел.Значение);
	КонецЦикла;
	
	ХранилищеОбщихНастроек.Сохранить("МониторРуководителя", 
		"СписокРазделовМонитораРуководителя", 
		СписокРазделов);
		
	ХранилищеОбщихНастроек.Сохранить("МониторРуководителя", 
		"ВариантОкругленияМонитораРуководителя", 
		ВариантОкругления);
		
	ХранилищеОбщихНастроек.Сохранить("МониторРуководителя", 
		"СравниватьСПрошлымПериодом", 
		СравниватьСПрошлымПериодом);
		
	ХранилищеОбщихНастроек.Сохранить("МониторРуководителя", 
		"ПоказыватьОборотыЗаТекущийМесяц", 
		ПоказыватьОборотыЗаТекущийМесяц);
		
	ХранилищеОбщихНастроек.Сохранить("МониторРуководителя", 
		"ПоказыватьОборотыЗаПрошлыйМесяц",
		ПоказыватьОборотыЗаПрошлыйМесяц);
		
	ХранилищеОбщихНастроек.Сохранить("МониторРуководителя", 
		"ПоказыватьОборотыСНачалаГодаПоТекущийМесяц", 
		ПоказыватьОборотыСНачалаГодаПоТекущийМесяц);
		
	ХранилищеОбщихНастроек.Сохранить("МониторРуководителя", 
		"ПоказыватьОборотыСНачалаГодаПоПрошлыйМесяц", 
		ПоказыватьОборотыСНачалаГодаПоПрошлыйМесяц);
		
	ХранилищеОбщихНастроек.Сохранить("МониторРуководителя", 
		"ПоказыватьУведомлениеОНастройке", 
		Ложь);
	
КонецПроцедуры

&НаСервере
Процедура ДополнитьПредставлениеОборотныхРазделов()
	
	ОборотныеРазделы = Перечисления.РазделыМонитораРуководителя.ОборотныеРазделы();
	
	Для каждого Раздел Из СписокРазделов Цикл
		
		Если ОборотныеРазделы.Найти(Раздел.Значение) <> Неопределено Тогда
			Раздел.Представление = Раздел.Представление + НСтр("ru=' (обороты)'");
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

#КонецОбласти
