
//При провдении платежный документов обработка статусов и добавление движений
//
Процедура ПриПроведенииДокументовОсновнияДляОплатыОбработкаПроведения(Источник, Отказ, РежимПроведения) Экспорт
	// Контротек - разработано 14.08.2010 по ТЗ №5 > >

	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	Если ТипЗнч(Источник) = Тип("ДокументОбъект.ПлатежноеПоручениеИсходящее")
		Или ТипЗнч(Источник) = Тип("ДокументОбъект.РасходныйКассовыйОрдер") Тогда
		
		Движения = Источник.Движения;
		Движения.ОснованияДляОплаты.Записывать = Истина;
		Движения.ОснованияДляОплаты.Очистить();
		// Движения по документам-основаниям
		Для Каждого ТекСтрокаБюджет Из Источник.ДокументОснование.Основание Цикл //заполняем регистр из заявки, для перепроведения документов, потом можно вернуть, ls, 24/09/10
			Если ТекСтрокаБюджет.КОплате тогда 
				Движение = Движения.ОснованияДляОплаты.Добавить();
				Движение.ВидДвижения       = ВидДвиженияНакопления.Расход;
				Движение.Период            = Источник.Дата;
				Движение.Договор           = Источник.ДокументОснование.Договор;
				Движение.ДокументОснование = ТекСтрокаБюджет.Документ;
				Движение.Сумма             = ТекСтрокаБюджет.Сумма;
			КонецЕсли;
		КонецЦикла;
		
	Иначе
		Если Источник.ДоговорКонтрагента.ТипОплатыПоДоговору = Перечисления.ТипыДоговоровПоОплате.ОплатаПоФакту 
			Или Источник.ДоговорКонтрагента.ТипОплатыПоДоговору = Перечисления.ТипыДоговоровПоОплате.ПредоплатноФакторный Тогда
			Движения = Источник.Движения;
			Движения.ОснованияДляОплаты.Записывать = Истина;
			Движения.ОснованияДляОплаты.Очистить();
			Движение = Движения.ОснованияДляОплаты.Добавить();
			Движение.Период            = Источник.Дата;
			Движение.ВидДвижения       = ВидДвиженияНакопления.Приход;
			Движение.Договор           = Источник.ДоговорКонтрагента;
			Движение.ДокументОснование = Источник.Ссылка;
			Движение.Сумма             = Источник.СуммаДокумента;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры
